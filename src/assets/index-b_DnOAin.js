var w=(_,i,e)=>new Promise((v,u)=>{var m=s=>{try{t(e.next(s))}catch(p){u(p)}},r=s=>{try{t(e.throw(s))}catch(p){u(p)}},t=s=>s.done?v(s.value):Promise.resolve(s.value).then(m,r);t((e=e.apply(_,i)).next())});import{_ as R,b as A,d as h,aE as S,z as G,M as U,C as M,o as k,h as T,aG as L,c9 as N,E as B,bu as H,u as F,q as Y,g as z,w as g,H as j,i as D,J as q,P as J,O as K,bf as W}from"./index-DXV2JZ8m.js";import{E as Z,a as $}from"./el-tab-pane-CnQSpZYw.js";import{_ as Q,D as X,T as V,a as ee,b as ae}from"./index-ouaXiLcH.js";import{s as te}from"./index-Bkyccy99.js";/* empty css                   */import{L as ne}from"./LeftRightLayout-BN_jRf-X.js";import"./strings-BZLQ_Urz.js";import"./index-CVZ_8dyu.js";import"./el-table-column-CQePrUUM.js";import"./index-CYGJEehB.js";import"./_Uint8Array-Bj4etxqr.js";import"./_initCloneObject-Dex4nZC8.js";import"./el-checkbox-CDMdhvJE.js";import"./el-col-Dvkq0Vgv.js";const se={class:"dga-graph"},oe={__name:"DgaGraph",props:{params:{type:Object,default:()=>({})}},setup(_,{expose:i}){const e=_,{t:v}=A(),u=h(null),m=h(!1),r=h("");let t=null,s=!1;const p=()=>w(this,null,function*(){var a,n,o;if(!((a=e==null?void 0:e.params)!=null&&a.dev_id)||s)return null;try{s=!0;const f=yield te.getSpectrum({time:(n=e==null?void 0:e.params)==null?void 0:n.time,dev_id:(o=e==null?void 0:e.params)==null?void 0:o.dev_id});return f.result>=0?f.data:null}finally{s=!1}}),d=()=>w(this,null,function*(){var n;if(!((n=e==null?void 0:e.params)!=null&&n.dev_id)){m.value=!0;return}r.value="",m.value=!0;const a=yield p();if(!a)I(),m.value=!0;else{m.value=!1,yield L();const o=c(a);x(o)}}),y=h(!1);S(()=>[e.params.dev_id,e.params.time],(a,n)=>{if(!y.value)return;const o=a[0]!==(n==null?void 0:n[0]),f=a[1]!==(n==null?void 0:n[1]);(o||f)&&d()});const x=a=>{a&&L(()=>{!t&&u.value?(t=H(u.value),t.setOption(a),window.addEventListener("resize",E)):t==null||t.setOption(a)})},c=a=>{if(!a)return;r.value=a.path;let n=a.ch1.channelInfo[0].peakInfo,o=[],f=a.ch1.channelInfo[0].spectrumData,b=[];for(let l=0;l<f.length;l++)b.push(l*a.ch1.xInterval);n.forEach(l=>{let P={name:l.groupName,xAxis:l.peakTime/a.ch1.xInterval,yAxis:l.peakHeight,value:l.groupName+":"+l.peakHeight};o.push(P)});const C={visualMap:{show:!1,type:"continuous",seriesIndex:1,dimension:0,min:0,max:b.length*a.ch1.xInterval},title:[{left:"center"}],tooltip:{trigger:"axis"},xAxis:[{name:v("hisYc.time")+"("+a.ch1.xUnit+")",data:b,axisLabel:{}}],yAxis:{type:"value",name:v("hisYc.voltage")+"("+a.ch1.yUnit+")",axisLabel:{}},series:[{type:"line",showSymbol:!1,data:f,markPoint:{show:!0,symbolSize:10,data:o}}],dataZoom:[{type:"inside",orient:"horizontal",start:0,end:100},{type:"slider",orient:"horizontal",show:!0,start:0,end:100,yAxisIndex:[0],filterMode:"empty"}]};return x(C),C},E=()=>{t&&u.value&&t.resize()},O=()=>{r.value?(r.value=r.value,N(r.value,"谱图数据.dat")):B.error("未获取到谱图数据，无法下载！")},I=()=>{t&&(t.dispose(),t=null,window.removeEventListener("resize",E))};return G(()=>{y.value=!0,d()}),U(()=>{I()}),i({download:O}),(a,n)=>{const o=Q;return k(),M("div",se,[T(o,{ref:"spectrpgram",params:e.params},null,8,["params"])])}}},re=R(oe,[["__scopeId","data-v-2e6bd01d"]]),ie={__name:"index",setup(_){const{t:i}=A(),e=F(),v=Y({dev_id:e.userDevice.guid,devInfo:e.userDevice}),u=h(null),m=h(null),r=p=>{m.value.treeExpand(p)},t=h(1),s=[{key:1,name:i("advanced.davidTriangle"),component:X},{key:2,name:i("advanced.threePerVal"),component:V},{key:3,name:i("advanced.threeD"),component:ee},{key:4,name:i("advanced.td"),component:ae},{key:5,name:i("advanced.chart"),component:re}];return(p,d)=>{const y=$,x=Z;return k(),z(ne,{"show-header":!1,onTreeOper:r},{leftTree:g(()=>d[1]||(d[1]=[])),rightContent:g(()=>[T(x,{modelValue:D(t),"onUpdate:modelValue":d[0]||(d[0]=c=>j(t)?t.value=c:null),class:"advance-tabs"},{default:g(()=>[(k(),M(q,null,J(s,c=>T(y,{key:c.key,label:c.name,name:c.key},{default:g(()=>[c.key===D(t)?(k(),z(W(c.component),{key:0,ref_for:!0,ref_key:"componentRef",ref:u,params:D(v)},null,8,["params"])):K("",!0)]),_:2},1032,["label","name"])),64))]),_:1},8,["modelValue"])]),_:1})}}},we=R(ie,[["__scopeId","data-v-c7aafd4f"]]);export{we as default};
