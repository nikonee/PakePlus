import{_ as q,v as K,d as r,e as O,z as Q,A as h,f as N,C as c,o as n,k as p,h as i,W as X,i as l,H as W,w as u,J as V,P as B,m as w,t as I,l as Y,a4 as Z,g as $,$ as F}from"./index-CTBb4ZkS.js";/* empty css                   */import{a as ee,E as se}from"./el-form-item-CfUEk-Ki.js";/* empty css                  */import{E as te,a as le}from"./el-radio-Bb3pNZIa.js";import{E as ae}from"./el-switch-By721Gye.js";import"./_Uint8Array-DrW7drqq.js";import"./_initCloneObject-BGH32tGU.js";const oe={class:"config-wrapper"},ne={class:"config-body"},ie={class:"config-body-open"},de={class:"config-body-msg"},re={class:"config-body-msg"},ce={class:"config-body-list sy-view"},ue={key:0,ref:"scroller","mouse-wheel":!0,scrollbar:{fade:!1,interactive:!0,scrollbarTrackClickable:!0}},pe={class:"config-body-list__label"},fe={__name:"IPListConfig",props:{title:{type:String,default:"IP黑白名单配置"}},setup(me){const M=[{key:0,value:"白名单"},{key:1,value:"黑名单"}],f={WhiteList:0,BlackList:1},z=K(()=>({ipAddress:[{trigger:"blur",validator:(e,a,d)=>{a===""||!/^((?:(?:[0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}(?:[0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(?:(\/([8]|1[6]|2[4])))?)$/.test(a)?d(new Error("请输入合理的IP地址或网段")):_.value.find(C=>C===a)?d(new Error("当前名单中已存在")):d()}}]})),S=["请在下面输入框中填入你想要添加的IP或网段","当客户端IP不在白名单中时，系统服务将会响应禁止访问的状态码(403);",'网段可以用来描述一个IP区间，含义为︰例如127.0.0.1/24，其中24表示采用子网掩码中的前24位为有效位，即2进制的IP地址中，前32位有效，后8位表达了该网段的范围。故127.0.0.1/24表示IP网段范围是:127.0.0.1~127.0.0.255。目前支持"/8"，"/16"，"/24"三种。'],m=r(0),k=r(!1),o=r(!1),v=r(!0),_=r([]),L=r([]),A=r([]),g=O({ipAddress:""});Q(()=>{P()});const P=()=>{k.value=!0,h.getUserApi("kong/agent/get").then(s=>{s!=null&&s.data&&s.success&&(A.value=s.data.config.allow?s.data.config.allow:[],L.value=s.data.config.deny?s.data.config.deny:[],o.value=s.data.enabled,v.value=!1)}).finally(()=>{R(),k.value=!1})},j=()=>{const s=o.value?"开启":"关闭";o.value=!o.value,h.getUserApi("kong/agent/state",{enabled:!o.value}).then(e=>{e&&e.success&&(o.value=!o.value,F({type:"success",message:"黑白名单过滤"+s+"成功"}))})},y=r(null),D=s=>{switch(s){case"create":{y.value.validate(e=>{if(e){const a={allow:[],deny:[]};let d="";switch(m.value){case f.WhiteList:a.allow.push(g.ipAddress),d="白名单";break;case f.BlackList:a.deny.push(g.ipAddress),d="黑名单";break}h.postUserApi("kong/agent/add",a).then(b=>{b&&b.success&&(F({type:"success",message:d+"新增成功"}),P())}).finally(()=>{g.ipAddress="",y.value.resetFields()})}});break}case"reset":{y.value.resetFields();break}}},G=s=>{const e={allow:[],deny:[]};switch(m.value){case f.WhiteList:e.allow.push(s);break;case f.BlackList:e.deny.push(s);break}h.postUserApi("kong/agent/delete",e).then(a=>{a&&a.success&&(F({type:"success",message:"IP网段已成功删除"}),P())}),y.value.resetFields()},R=()=>{switch(m.value){case f.WhiteList:_.value=A.value?A.value:[];break;case f.BlackList:_.value=L.value?L.value:[];break}};return(s,e)=>{const a=ae,d=te,b=le,C=N("SyInput"),T=ee,E=Y,H=se,U=N("SyEmpty"),J=Z;return n(),c("div",oe,[p("div",ne,[p("div",ie,[e[5]||(e[5]=p("span",null,"是否启用黑白名单过滤",-1)),i(a,{modelValue:l(o),"onUpdate:modelValue":e[0]||(e[0]=t=>W(o)?o.value=t:null),class:"config-body-switch","checked-children":"开启","un-checked-children":"关闭",disabled:l(v),"default-checked":!0,onChange:j},null,8,["modelValue","disabled"])]),i(b,{modelValue:l(m),"onUpdate:modelValue":e[1]||(e[1]=t=>W(m)?m.value=t:null),class:"config-body-radio",disabled:l(v),onChange:R},{default:u(()=>[(n(),c(V,null,B(M,t=>i(d,{key:t.key,"model-value":t.value,value:t.key},{default:u(()=>[w(I(t.value),1)]),_:2},1032,["model-value","value"])),64))]),_:1},8,["modelValue","disabled"]),p("ul",de,[p("li",null,I(S[0]),1)]),i(H,{ref_key:"modalFormRef",ref:y,class:"config-body-form sy-form",model:l(g),rules:l(z)},{default:u(()=>[i(T,{label:"IP网段",prop:"ipAddress"},{default:u(()=>[i(C,{modelValue:l(g).ipAddress,"onUpdate:modelValue":e[2]||(e[2]=t=>l(g).ipAddress=t),placeholder:"请输入合理的IP地址或网段",disabled:l(v),clearable:!0},null,8,["modelValue","disabled"])]),_:1}),i(T,null,{default:u(()=>[i(E,{class:"sy-btn-default",type:"success",icon:"CirclePlus",disabled:l(v),onClick:e[3]||(e[3]=t=>D("create"))},{default:u(()=>e[6]||(e[6]=[w(" 新增 ")])),_:1,__:[6]},8,["disabled"]),i(E,{class:"sy-btn-default",type:"warning",icon:"Refresh",disabled:l(v),onClick:e[4]||(e[4]=t=>D("reset"))},{default:u(()=>e[7]||(e[7]=[w(" 重置 ")])),_:1,__:[7]},8,["disabled"])]),_:1})]),_:1},8,["model","rules"]),p("ul",re,[(n(!0),c(V,null,B(S.slice(1),(t,x)=>(n(),c("li",{key:x},I(t),1))),128))]),X((n(),c("div",ce,[l(_).length>0?(n(),c("ul",ue,[(n(!0),c(V,null,B(l(_),t=>(n(),c("li",{key:t,class:"content-item w-6/6 flex justify-around"},[p("label",pe,I(t),1),i(E,{class:"sy-btn-default",type:"danger",size:"small",onClick:x=>G(t)},{default:u(()=>e[8]||(e[8]=[w(" 删除 ")])),_:2,__:[8]},1032,["onClick"])]))),128))],512)):l(_).length===0&&l(k)?(n(),$(U,{key:1,description:"数据请求中"})):(n(),$(U,{key:2}))])),[[J,l(k)]])])])}}},Ie=q(fe,[["__scopeId","data-v-41b1e32b"]]);export{Ie as default};
