const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/OrganModal-CET3ftnj.js","assets/index-DXV2JZ8m.js","assets/index-DNi7SFJr.css","assets/el-overlay-tl7whmgi.js","assets/index-CYGJEehB.js","assets/el-overlay-D6o2BJTA.css","assets/el-form-item-B5fc7SOt.js","assets/_Uint8Array-Bj4etxqr.js","assets/_initCloneObject-Dex4nZC8.js","assets/el-form-item-gVjeYkRF.css","assets/el-switch-CPF0md_o.js","assets/el-switch-gV3pCP4s.css","assets/el-table-column-CQePrUUM.js","assets/el-checkbox-CDMdhvJE.js","assets/el-checkbox-BY7ulNlP.css","assets/el-table-column-DVAPOjmv.css","assets/el-select-CmbJuaGB.js","assets/token-DI9FKtlJ.js","assets/strings-BZLQ_Urz.js","assets/el-select-D5oppPZA.css","assets/OrganModal-D64WLxqp.css","assets/el-button-0DXH7egA.css"])))=>i.map(i=>d[i]);
var ue=Object.defineProperty,ie=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var Y=(y,v,p)=>v in y?ue(y,v,{enumerable:!0,configurable:!0,writable:!0,value:p}):y[v]=p,T=(y,v)=>{for(var p in v||(v={}))se.call(v,p)&&Y(y,p,v[p]);if(X)for(var p of X(v))pe.call(v,p)&&Y(y,p,v[p]);return y},A=(y,v)=>ie(y,de(v));var z=(y,v,p)=>new Promise((R,M)=>{var m=g=>{try{h(p.next(g))}catch(s){M(s)}},I=g=>{try{h(p.throw(g))}catch(s){M(s)}},h=g=>g.done?R(g.value):Promise.resolve(g.value).then(m,I);h((p=p.apply(y,v)).next())});import{_ as ce,d as N,e as Z,S as P,z as ve,f as me,C as D,o as L,h as i,w as r,i as d,J as U,P as W,g as j,O as w,T as fe,U as be,k as ee,V as ye,t as ge,l as ke,m as F,W as _e,X as he,j as Te,H as Ee,Y as Ce,A as C,Z as c,x as _,$ as H,a0 as Ae,a1 as Le}from"./index-DXV2JZ8m.js";import{E as Ge,a as Se}from"./el-col-Dvkq0Vgv.js";import{E as Ve,a as Ne}from"./el-table-column-CQePrUUM.js";import"./el-checkbox-CDMdhvJE.js";/* empty css                  */import{E as Ie}from"./el-switch-CPF0md_o.js";import{E as xe,a as $e}from"./el-form-item-B5fc7SOt.js";import{E as Be,a as De}from"./el-select-CmbJuaGB.js";import{F as Me}from"./FilterTable-FUrCD4yk.js";import"./index-CYGJEehB.js";import"./_Uint8Array-Bj4etxqr.js";import"./_initCloneObject-Dex4nZC8.js";import"./token-DI9FKtlJ.js";import"./strings-BZLQ_Urz.js";/* empty css                   */const Oe={key:1},Ue={__name:"organ-manage",setup(y){const v=Ce(()=>Le(()=>import("./OrganModal-CET3ftnj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]))),p=[{key:"unit",value:"省公司"},{key:"team",value:"运维班"},{key:"station",value:"场站名称"}],R=[{key:!0,value:"是"},{key:!1,value:"否"}],M=N(null),m=Z({organLevel:void 0,enabled:void 0,organName:""}),I=f=>{switch(f){case"reset":M.value.resetFields(),O();break;case"query":O();break;case"linkage":m.enabled!==void 0&&(m.organLevel="station"),O();break}},h=N(!1),g=N(""),s=P({}),S=P([]),G=N(!1),q=N("create"),x=(f,e)=>z(this,null,function*(){switch(f){case"edit":switch(s.value=T({},e),g.value="编辑组织",e.level){case c.TEAM:S.value=yield C.getBaseApi("unit",{}).then(t=>{var l;return(l=t==null?void 0:t.data)!=null&&l.length?t.data.map(n=>A(T({},n),{treeKey:"unit"+n.guid})):[]}).catch(()=>[]),G.value=!0,s.value.parentGuid=e.parentGuid;break;case c.STATION:S.value=yield C.getBaseApi("team",{}).then(t=>{var l;return(l=t==null?void 0:t.data)!=null&&l.length?t.data.map(n=>A(T({},n),{treeKey:"team"+n.guid})):[]}).catch(()=>[]),G.value=!0,s.value.parentGuid=e.parentGuid;break;default:G.value=!1;break}q.value="update",h.value=!0;break;case"delete":Ae({callback:t=>{if(t==="confirm"){const{id:l,guid:n,level:a}=e;let u="",E="",K={};switch(a){case c.UNIT:{u="unit",E="team";break}case c.TEAM:{u="team",E="station";break}case c.STATION:{u="station",E="area";break}}K[u]=n,C.getBaseApi(`${E}`,K).then(k=>{if((k==null?void 0:k.count)>0){H({type:"error",message:"当前组织存在下级组织，无法删除"});return}return C.postBaseApi(`query/${u}/delete`,{data:[l]})}).then(k=>z(this,null,function*(){k!=null&&k.success&&(Q("delete",[T({},e)]),H({type:"success",message:"组织删除成功！"}),V.value=!0)}))}}});break;case"createEqual":switch(g.value="新增平级组织",s.value.parentGuid=e.parentGuid,s.value.level=e.level,s.value.name="",e.level){case c.UNIT:S.value=[],s.value.parentGuid="";break;case c.TEAM:S.value=yield C.getBaseApi("unit",{}).then(t=>{var l;return(l=t==null?void 0:t.data)!=null&&l.length?t.data:[]}).catch(()=>[]),G.value=!0,s.value.parentGuid=e.parentGuid;break;case c.STATION:s.value.enabled=e.enabled,S.value=yield C.getBaseApi("team",{}).then(t=>{var l;return(l=t==null?void 0:t.data)!=null&&l.length?t.data:[]}).catch(()=>[]),G.value=!0,s.value.parentGuid=e.parentGuid;break;default:G.value=!1;break}q.value="createEqual",h.value=!0;break;case"createSub":g.value="新增下级组织",s.value.parentGuid=e.guid,s.value.level=Number(e.level)+1+"",s.value.name="",S.value=[{guid:e.guid,name:e.name}],G.value=!0,q.value="createSub",h.value=!0;break;case"enable":C.postBaseApi("query/station/update",{data:[{id:e.id,name:e.name,acronym:e.acronym,alias:e.alias,order:e.order,enabled:e.enabled,guid:e.guid}]}).then(t=>{if(!t.success){e.enabled=!e.enabled;return}H({type:"success",message:`${e.name}${e.enabled?"启用":"禁用"}成功！`})}).catch(()=>{e.enabled=!e.enabled});break}}),ae=Z([{prop:"name",label:"组织单位层级",minWidth:200,isShow:!0},{prop:"organLevel",label:"分类",width:100,isShow:!0},{prop:"acronym",label:"组织首字母",isShow:!0},{prop:"order",label:"排序号",isShow:!0},{prop:"enabled",label:"启用状态",noTooltip:!0,isShow:!0},{prop:"detail",label:"备注",minWidth:200,isShow:!0},{prop:"operation",label:"操作",minWidth:200,noTooltip:!0,isShow:!0}]),V=N(!1),$=P([]),J=N(null),O=()=>{const{organLevel:f,search:e,enabled:t}=m;V.value=!0,C.getBaseApi(f||"unit",{name__contains:e}).then(l=>{if(!(l!=null&&l.data.length)){$.value=[];return}let n=l.data;switch(f){case"unit":$.value=n.map(a=>A(T({},a),{acronym:_(a.acronym)?a.acronym:"-",detail:_(a.detail)?a.detail:"-",orgLevel:"省公司",level:c.UNIT,hasChildren:!0,parentGuid:"root",treeKey:"unit"+a.guid}));break;case"team":$.value=n.map(a=>{var u;return A(T({},a),{acronym:_(a.acronym)?a.acronym:"-",detail:_(a.detail)?a.detail:"-",orgLevel:"运维班",level:c.TEAM,hasChildren:!0,parentGuid:"unit"+((u=a.unit)==null?void 0:u.guid),treeKey:"team"+a.guid})});break;case"station":t!==void 0&&(n=n.filter(a=>a.enabled===t)),$.value=n.map(a=>{var u;return A(T({},a),{acronym:_(a.acronym)?a.acronym:"-",detail:_(a.detail)?a.detail:"-",orgLevel:"场站名称",level:c.STATION,hasChildren:!1,parentGuid:"team"+((u=a.team)==null?void 0:u.guid),treeKey:"station"+a.guid})});break;default:$.value=n.map(a=>A(T({},a),{acronym:_(a.acronym)?a.acronym:"-",detail:_(a.detail)?a.detail:"-",orgLevel:"省公司",level:c.UNIT,hasChildren:!0,parentGuid:"root",treeKey:"unit"+a.guid}));break}}).finally(()=>{V.value=!1})},Q=(f,e)=>{const t=m.organLevel?m.organLevel==="unit"?"1":m.organLevel==="team"?"2":"3":void 0;if(e[0].level===c.UNIT||e[0].level===t)return O();const l=J.value.store.states.lazyTreeNodeMap;switch(f){case"add":{const n=l.value[e[0].parentGuid];n?e.forEach(a=>{n.findIndex(E=>E.guid===a.guid)===-1&&n.push(a)}):e.forEach(a=>{l.value[e[0].parentGuid]?l.value[e[0].parentGuid].push(a):l.value[e[0].parentGuid]=[a]})}break;case"update":{const n=l.value[e[0].parentGuid];e.forEach(a=>{const u=n.findIndex(E=>E.treeKey===a.treeKey);n.splice(u,u+1,a)})}break;case"delete":{const n=l.value[e[0].parentGuid],a=n.findIndex(u=>u.guid===e[0].guid);n.splice(a,1)}break}V.value=!1},le=(f,e,t)=>{switch(f.level){case c.UNIT:C.getBaseApi("team",{unit:f.guid}).then(l=>{if(!(l!=null&&l.data.length)){t([]);return}const n=l.data.map(a=>A(T({},a),{acronym:_(a.acronym)?a.acronym:"-",detail:_(a.detail)?a.detail:"-",orgLevel:"运维班",level:c.TEAM,parentGuid:"unit"+f.guid,hasChildren:!0,treeKey:"team"+a.guid}));t(n)});break;case c.TEAM:C.getBaseApi("station",{team:f.guid}).then(l=>{if(!(l!=null&&l.data.length)){t([]);return}const n=l.data.map(a=>A(T({},a),{acronym:_(a.acronym)?a.acronym:"-",detail:_(a.detail)?a.detail:"-",orgLevel:"场站名称",parentGuid:"team"+f.guid,level:c.STATION,hasChildren:!1,treeKey:"station"+a.guid}));t(n)});break;default:t([]);break}};return ve(()=>{O()}),(f,e)=>{const t=Te,l=$e,n=De,a=Be,u=xe,E=me("SyEmpty"),K=Ie,k=ke,te=Ne,ne=Ve,oe=Ge,re=Se;return L(),D(U,null,[i(re,{id:"organ-manage",class:"sy-row role",gutter:10},{default:r(()=>[i(oe,{class:"sy-col-vertical",span:24},{default:r(()=>[i(Me,{"table-name":"组织管理",expand:!0,"table-load":d(V),onChange:e[6]||(e[6]=o=>I("query")),onReset:e[7]||(e[7]=o=>x("reset"))},{filterForm:r(()=>[i(u,{ref_key:"filterFormRef",ref:M,model:d(m),inline:""},{default:r(()=>[i(l,{prop:"organName",label:"组织名称",class:"sy-query-condition__item"},{default:r(()=>[i(t,{modelValue:d(m).name,"onUpdate:modelValue":e[0]||(e[0]=o=>d(m).name=o),placeholder:"请输入组织名称",maxlength:20,clearable:"",onChange:e[1]||(e[1]=o=>I("query"))},null,8,["modelValue"])]),_:1}),i(l,{prop:"organLevel",label:"组织层级",class:"sy-query-condition__item"},{default:r(()=>[i(a,{modelValue:d(m).organLevel,"onUpdate:modelValue":e[2]||(e[2]=o=>d(m).organLevel=o),"popper-class":"sy-popper",placeholder:"请选择组织层级",clearable:"",onChange:e[3]||(e[3]=o=>I("query"))},{default:r(()=>[(L(),D(U,null,W(p,o=>i(n,{key:o.key,label:o.value,value:o.key},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),i(l,{prop:"enabled",label:"启用状态",class:"sy-query-condition__item"},{default:r(()=>[i(a,{modelValue:d(m).enabled,"onUpdate:modelValue":e[4]||(e[4]=o=>d(m).enabled=o),"popper-class":"sy-popper",placeholder:"请选择启用状态",clearable:"",onChange:e[5]||(e[5]=o=>I("linkage"))},{default:r(()=>[(L(),D(U,null,W(R,o=>i(n,{key:o.key,label:o.value,value:o.key},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),i(l,{label:""},{default:r(()=>e[9]||(e[9]=[ee("div",{class:"sy-table-vertical-header__action"},null,-1)])),_:1,__:[9]})]),_:1},8,["model"])]),tableAction:r(()=>e[10]||(e[10]=[])),table:r(()=>[i(ne,{ref_key:"tableRef",ref:J,class:"sy-table-vertical",loading:d(V),data:d($),load:le,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"treeKey",border:"",lazy:""},{empty:r(()=>[_e(i(E,null,null,512),[[he,!d(V)]])]),default:r(()=>[(L(!0),D(U,null,W(d(ae),o=>(L(),D(U,null,[o.isShow?(L(),j(te,fe({key:o.prop},{ref_for:!0},o,{align:o.align||"left","show-overflow-tooltip":!o.noTooltip}),be({_:2},[o.prop==="enabled"?{name:"default",fn:r(({row:b})=>[b.level==="3"?(L(),j(K,{key:0,modelValue:b.enabled,"onUpdate:modelValue":B=>b.enabled=B,"active-text":"启用","inactive-text":"禁用",onChange:B=>x("enable",b)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(L(),D("span",Oe,"-"))]),key:"0"}:o.prop==="organLevel"?{name:"default",fn:r(({row:b})=>[ee("span",{class:ye(`org-tag-${b.level}`)},ge(b.orgLevel),3)]),key:"1"}:o.prop==="operation"?{name:"default",fn:r(({row:b})=>[i(k,{type:"primary",link:"",onClick:B=>x("edit",b)},{default:r(()=>e[11]||(e[11]=[F("编辑 ")])),_:2,__:[11]},1032,["onClick"]),i(k,{type:"danger",link:"",onClick:B=>x("delete",b)},{default:r(()=>e[12]||(e[12]=[F("删除 ")])),_:2,__:[12]},1032,["onClick"]),i(k,{type:"primary",link:"",onClick:B=>x("createEqual",b)},{default:r(()=>e[13]||(e[13]=[F(" 新增平级单位 ")])),_:2,__:[13]},1032,["onClick"]),b.level!=="3"?(L(),j(k,{key:0,type:"primary",link:"",onClick:B=>x("createSub",b)},{default:r(()=>e[14]||(e[14]=[F(" 新增下级单位 ")])),_:2,__:[14]},1032,["onClick"])):w("",!0)]),key:"2"}:void 0]),1040,["align","show-overflow-tooltip"])):w("",!0)],64))),256))]),_:1},8,["loading","data"])]),_:1},8,["table-load"])]),_:1})]),_:1}),i(d(v),{visible:d(h),"onUpdate:visible":e[8]||(e[8]=o=>Ee(h)?h.value=o:null),data:d(s),disabled:d(G),title:d(g),"parent-options":d(S),type:d(q),close:()=>{h.value=!1},onConfirm:Q},null,8,["visible","data","disabled","title","parent-options","type","close"])],64)}}},aa=ce(Ue,[["__scopeId","data-v-9162f998"]]);export{aa as default};
