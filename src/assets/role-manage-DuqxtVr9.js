var Ae=Object.defineProperty,Ve=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var _e=(E,f,m)=>f in E?Ae(E,f,{enumerable:!0,configurable:!0,writable:!0,value:m}):E[f]=m,ae=(E,f)=>{for(var m in f||(f={}))De.call(f,m)&&_e(E,m,f[m]);if(fe)for(var m of fe(f))Re.call(f,m)&&_e(E,m,f[m]);return E},ce=(E,f)=>Ve(E,Se(f));var pe=(E,f,m)=>new Promise(($,F)=>{var S=s=>{try{M(m.next(s))}catch(z){F(z)}},h=s=>{try{M(m.throw(s))}catch(z){F(z)}},M=s=>s.done?$(s.value):Promise.resolve(s.value).then(S,h);M((m=m.apply(E,f)).next())});import{_ as ye,v as oe,a2 as Ue,d as v,e as ne,a3 as x,f as se,g as P,o as d,w as r,h as c,k as _,i as n,C as y,t as O,O as J,J as j,l as ve,m as U,W as me,H as G,P as ee,V as Me,a4 as ge,$ as le,A as K,a5 as $e,a6 as Ie,a7 as ke,K as Ne,a8 as he,a9 as xe,aa as Oe,S as Pe,z as Fe,T as ze,U as Be,X as He,ab as Le,ac as We,ad as Ye,ae as je}from"./index-DXV2JZ8m.js";/* empty css                   */import{a as be,E as Ce}from"./el-col-Dvkq0Vgv.js";import{E as Ee}from"./el-overlay-tl7whmgi.js";import{E as qe}from"./el-pagination-DSW-ILIO.js";import{E as Ge,a as Je}from"./el-table-column-CQePrUUM.js";import"./el-select-CmbJuaGB.js";import{E as Ke,a as Xe}from"./el-checkbox-CDMdhvJE.js";/* empty css                  */import{E as Te,a as we}from"./el-form-item-B5fc7SOt.js";import{F as Qe}from"./FilterTable-FUrCD4yk.js";/* empty css                          */import"./index-CYGJEehB.js";import"./_Uint8Array-Bj4etxqr.js";import"./_initCloneObject-Dex4nZC8.js";import"./token-DI9FKtlJ.js";import"./strings-BZLQ_Urz.js";const Ze={class:"sy-card sy-view"},el={class:"sy-card__body role-msg"},ll={key:1,class:"role-msg__form-text"},tl={key:1,class:"role-msg__form-text"},al={class:"role-msg__action"},ol={class:"sy-card"},nl={class:"sy-card__body"},sl={class:"menu-list__wrapper"},rl={key:0,class:"menu-list"},il={key:0,class:"menu-list__item-all"},ul={class:"menu-list__item-label"},dl={class:"menu-list__item-sub-name"},cl={key:0,class:"menu-list__item-sub-fun"},pl={key:1,class:"menu-list__item-sub-fun text"},ml={class:"menu-list__item-sub-all"},fl={class:"menu-list__item-sub-group"},_l={__name:"RoleEditorModel",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"角色编辑"},mode:{type:String,default:"check"},data:{type:Object,default:()=>{}}},emits:["update:visible","confirm"],setup(E,{emit:f}){const m=E,$=f,F=oe({get(){return m.visible},set(o){$("update:visible",o)}}),S=Ue(),h=v("check"),M=v(null),s=ne({roleName:"",roleDesc:"",type:x.CUSTOMER}),z=oe(()=>s.type!==x.ADMIN&&s.type!==x.AUDITOR),Y=oe(()=>({roleName:[{required:h.value!=="check",trigger:"blur",message:"请输入角色名称"}],roleDesc:[{required:h.value!=="check",trigger:"blur",message:"请输入角色描述"}]})),T=v(!0),X=v(!1),H=v(!1),k=v([]),g=v([]),B=o=>{switch(o){case"manage":F.value=!1;break;case"edit":I(),h.value="edit";break}},Q=()=>{if(!z.value)return le({type:"error",message:"当前角色无法编辑！"});M.value.validate(o=>{if(!o)return;const e=[];if(k.value.forEach(l=>{let i=!1;l.children.forEach(u=>{u.check.length!==0&&(i=!0,u.code&&e.push(u.code),u.children.forEach(D=>{D.uri!=="check"&&u.check.includes(D.uri)&&(i=!0,D.code&&e.push(D.code))}))}),i&&e.push(l.code)}),e.length===0)return le({type:"error",message:"当前角色菜单为空！"});const a=m.data.code?"update":"create";K.postUserApi(`role/role_menu/${a}`,{code:m.data.code,menu_code_list:e,name:s.roleName,description:s.roleDesc,type:s.type}).then(l=>{if(!l.success)return le({type:"error",message:`角色${a==="create"?"新增":"编辑"}失败!`});le({type:"success",message:`角色${a==="create"?"新增":"编辑"}成功!`}),setTimeout(()=>{B("manage")},300),$("confirm")})})},Z=o=>{X.value=!1,k.value.forEach(e=>{o||(e.checkAll=!1,e.isIndeterminate=!1,e.check=[]),e.children.forEach(a=>{o?(a.checkAll=!0,a.isIndeterminate=!1,a.children.forEach(l=>{a.check.push(l.uri)})):(a.checkAll=!1,a.isIndeterminate=!1,a.check=[])})})},I=()=>{let o=!0,e=!1;k.value.forEach(a=>{a.children.forEach(l=>{l.checkAll||(o=!1),l.check.length&&(e=!0)})}),T.value=o,X.value=o?!1:e},re=(o,e)=>{o?(e.isIndeterminate=!1,e.children.forEach(a=>{e.check.push(a.uri)})):e.check=[],I()},ie=(o,e)=>{o.length===0?(e.isIndeterminate=!1,e.checkAll=!1):o.length===e.children.length?(e.isIndeterminate=!1,e.checkAll=!0):(e.isIndeterminate=!0,e.checkAll=!1),I()},N=()=>{H.value=!0;let o;switch(s.type){case x.ADMIN:o=Ie.filter(e=>{var a;return!((a=e.meta)!=null&&a.hidden)});break;case x.AUDITOR:o=$e.filter(e=>{var a;return!((a=e.meta)!=null&&a.hidden)});break;case x.OPERATOR:case x.CUSTOMER:o="";break}if(o!==""){g.value=[];const e=ue(o);V(e,0),k.value=e.sort((a,l)=>a.order_num-l.order_num),I(),H.value=!1;return}K.getUserApi("menu_list",{ordering:"id",offset:0,limit:1e3,enable:!0,app_code:S.appCode}).then(e=>{var l;if(!((l=e.data)!=null&&l.length)){k.value=[];return}const a=ke(e.data.map(i=>ce(ae({},i),{name:i.title})),"code","parent_id").filter(i=>i.app_code.includes(S.appCode)&&i.menu_icon===o);V(a,0),k.value=a.sort((i,u)=>i.order_num-u.order_num),I()}).finally(()=>{H.value=!1})},ue=o=>{const e=Ne.cloneDeep(o).filter(a=>{var l;return!((l=a==null?void 0:a.meta)!=null&&l.base)});return e.forEach(a=>{var l,i;a.title=((l=a.meta)==null?void 0:l.title)||"-",a.uri=a.path||"",a.app_code=S.appCode,a.code=he(),a.order_num=0,a.name=((i=a.meta)==null?void 0:i.title)||"-",g.value.push({code:a.code}),a.children.forEach((u,D)=>{var L,q;u.title=((L=u.meta)==null?void 0:L.title)||"-",u.name=((q=u.meta)==null?void 0:q.title)||"-",u.uri=u.path||"",u.app_code=S.appCode,u.code=he(),u.order_num=D+1,u.children=[],g.value.push({code:u.code})})}),e},V=(o,e=0)=>{var a;for(const l of o){if((a=l==null?void 0:l.children)!=null&&a.length)l.check=[],l.children.forEach(i=>{if(g.value.length===0)l.check.push(i.uri);else{const u=g.value.find(D=>D.code===i.code);u&&l.check.push(u.uri)}}),l.checkAll=l.check.length===l.children.length,l.isIndeterminate=l.check.length!==l.children.length,l.check.length===0&&(l.checkAll=!1,l.isIndeterminate=!1);else if(e===0?l.children=[{name:l.title,uri:"check"}]:l.children=[{name:"查看",uri:"check"}],g.value.length===0)l.checkAll=!0,l.isIndeterminate=!1,l.check=["check"];else{const i=g.value.find(u=>u.code===l.code);l.checkAll=!!i,l.isIndeterminate=!1,l.check=i?["check"]:[]}if(e>2)return o;l.children&&V(l.children,e+1)}},t=()=>pe(this,null,function*(){H.value=!0,yield K.getUserApi("role/role_menu",{code:m.data.code}).then(o=>{var e;if(!((e=o==null?void 0:o.data)!=null&&e.length)){s.roleDesc="",s.roleName="-";return}s.roleDesc=o==null?void 0:o.data[0].description,s.roleName=o==null?void 0:o.data[0].name,s.type=o==null?void 0:o.data[0].type,g.value=(o==null?void 0:o.data[0].menus)||[{code:void 0}]}).finally(()=>{N()})}),w=()=>pe(this,null,function*(){m.mode==="create"?N():yield t(),m.mode!=="check"?h.value="edit":h.value="check",M.value.clearValidate()}),A=()=>{s.roleName="",s.roleDesc="",s.type=x.CUSTOMER,g.value=[],k.value=[]};return(o,e)=>{const a=se("SyInput"),l=we,i=Te,u=ve,D=Ce,L=Ke,q=Xe,de=se("SyEmpty"),p=be,W=Ee,te=ge;return d(),P(W,{modelValue:n(F),"onUpdate:modelValue":e[5]||(e[5]=R=>G(F)?F.value=R:null),class:"sy-dialog sy-dialog--huge",width:"75vw",title:E.title,"close-on-click-modal":!1,"append-to-body":"",center:"",onOpen:w,onClose:A},{default:r(()=>[c(p,{id:"role-editor",gutter:10},{default:r(()=>[c(D,{span:6},{default:r(()=>[_("div",Ze,[e[9]||(e[9]=_("div",{class:"sy-card__header"},[_("span",{class:"sy-card__header__title"},"角色信息")],-1)),_("div",el,[c(i,{ref_key:"roleFormRef",ref:M,class:"sy-form role-msg__form",model:n(s),rules:n(Y),"label-position":"top"},{default:r(()=>[c(l,{label:"角色名称：",prop:"roleName"},{default:r(()=>[n(h)==="edit"?(d(),P(a,{key:0,modelValue:n(s).roleName,"onUpdate:modelValue":e[0]||(e[0]=R=>n(s).roleName=R),placeholder:"请输入角色名称",maxlength:20},null,8,["modelValue"])):(d(),y("div",ll,O(n(s).roleName),1))]),_:1}),c(l,{label:"角色描述：",prop:"roleDesc"},{default:r(()=>[n(h)==="edit"?(d(),P(a,{key:0,modelValue:n(s).roleDesc,"onUpdate:modelValue":e[1]||(e[1]=R=>n(s).roleDesc=R),placeholder:"请输入角色描述",type:"textarea",clearable:""},null,8,["modelValue"])):(d(),y("div",tl,O(n(s).roleDesc||"-"),1))]),_:1})]),_:1},8,["model","rules"]),_("div",al,[n(h)==="edit"?(d(),y(j,{key:0},[c(u,{class:"sy-btn-default",type:"warning",onClick:e[2]||(e[2]=R=>B("manage"))},{default:r(()=>e[6]||(e[6]=[U("取消")])),_:1,__:[6]}),c(u,{class:"sy-btn-default",type:"primary",onClick:Q},{default:r(()=>e[7]||(e[7]=[U("确定")])),_:1,__:[7]})],64)):n(z)?(d(),P(u,{key:1,class:"sy-btn-default",type:"primary",onClick:e[3]||(e[3]=R=>B("edit"))},{default:r(()=>e[8]||(e[8]=[U("编辑")])),_:1,__:[8]})):J("",!0)])])])]),_:1}),c(D,{span:18},{default:r(()=>[_("div",ol,[e[13]||(e[13]=_("div",{class:"sy-card__header"},[_("span",{class:"sy-card__header__title"},"菜单列表")],-1)),me((d(),y("div",nl,[_("div",sl,[n(k).length>0?(d(),y("ul",rl,[n(h)==="edit"?(d(),y("li",il,[e[11]||(e[11]=_("span",{class:"menu-list__item-all-name"},"全部功能",-1)),c(L,{modelValue:n(T),"onUpdate:modelValue":e[4]||(e[4]=R=>G(T)?T.value=R:null),class:"menu-list__item-all-check",indeterminate:n(X),onChange:Z},{default:r(()=>e[10]||(e[10]=[U(" 全选 ")])),_:1,__:[10]},8,["modelValue","indeterminate"])])):J("",!0),(d(!0),y(j,null,ee(n(k),R=>(d(),y("li",{key:R.uri,class:"menu-list__item"},[_("span",ul,O(R.name),1),(d(!0),y(j,null,ee(R.children,b=>(d(),y("div",{key:b.uri,class:"menu-list__item-sub"},[_("span",dl,O(b.name),1),n(h)==="edit"?(d(),y("div",cl,[c(L,{modelValue:b.checkAll,"onUpdate:modelValue":C=>b.checkAll=C,class:"menu-list__item-sub-all",indeterminate:b.isIndeterminate,onChange:C=>re(C,b)},{default:r(()=>e[12]||(e[12]=[U(" 全选 ")])),_:2,__:[12]},1032,["modelValue","onUpdate:modelValue","indeterminate","onChange"]),c(q,{modelValue:b.check,"onUpdate:modelValue":C=>b.check=C,class:"menu-list__item-sub-group",onChange:C=>ie(C,b)},{default:r(()=>[(d(!0),y(j,null,ee(b.children,C=>(d(),P(L,{key:C.uri,value:C.uri},{default:r(()=>[U(O(C.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])):(d(),y("div",pl,[_("div",ml," 共"+O(b.children.length)+"项，启用"+O(b.check.length)+"项 ",1),_("div",fl,[(d(!0),y(j,null,ee(b.children,C=>(d(),y("span",{key:C.uri,class:Me(` menu-list__item-sub-group-item  ${b.check.includes(C.uri)?"active ":""}`)},O(b.children.length>1?C.name:C.name+b.name),3))),128))])]))]))),128))]))),128))])):!n(H)&&n(k).length===0?(d(),P(de,{key:1})):J("",!0)])])),[[te,n(H)]])])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])}}},hl=ye(_l,[["__scopeId","data-v-a9e5c856"]]),yl={class:"sy-table-footer"},vl={class:"role-remove-wrapper"},gl={key:0,class:"role-remove-check"},kl={class:"role-remove-check__message"},bl={class:"el-icon-warning"},Cl={key:1,class:"role-remove-passwd"},El={__name:"role-manage",setup(E){const f=ae({},x),m=xe(Oe.RoleTypes),$=v(""),F=v(""),S=v(!1),h=v(!1),M=v({code:""}),s=(V,t={})=>{switch(F.value=V,V){case"create":$.value="角色新增",M.value.code="",h.value=!0;break;case"check":M.value.code=t.code,$.value="角色查看",h.value=!0;break;case"edit":M.value.code=t.code,$.value="角色编辑",h.value=!0;break;case"delete":T.code=t.code,T.linked=t.linked,T.roleType=t.name,Y.value=!1,$.value="角色删除",S.value=!0;break}},z=v(null),Y=v(!1),T=ne({checkPwd:"",roleType:"",linked:"",code:""}),X=oe(()=>({checkPwd:[{required:!0,message:"请输入密码",trigger:"blur"}]})),H=()=>{Y.value===!1?Y.value=!0:z.value.validate(V=>{if(V&&V){const t=je(T.checkPwd);K.postUserApi("verify/password",{password:t}).then(w=>{if(w!=null&&w.success)return K.postUserApi("role_menu",{code:T.code,type:x.CUSTOMER})}).then(w=>{w!=null&&w.success&&le({type:"success",message:"角色删除成功！"}),N(),z.value.resetFields(),S.value=!1})}})},k=v(!1),g=v(1),B=v(15),Q=v(0),Z=Pe([]),I=ne({roleName:"",userType:""}),re=ne([{type:"index",label:"序号",width:80,align:"center",isShow:!0},{prop:"name",label:"角色名称",isShow:!0},{prop:"roleType",label:"角色类型",isShow:!0},{prop:"description",label:"角色描述",isShow:!0},{prop:"roleMenu",label:"菜单权限",minWidth:250,isShow:!0},{prop:"linked",label:"关联用户",isShow:!0},{prop:"createTime",label:"创建时间",minWidth:100,isShow:!0},{prop:"operation",label:"操作",minWidth:150,isShow:!0}]),ie=V=>{g.value=V,N()},N=V=>{V&&(g.value=1),k.value=!0,K.getUserApi("role/role_menu",{limit:B.value,offset:B.value*(g.value-1),name:I.roleName}).then(t=>{var w;if(!((w=t==null?void 0:t.data)!=null&&w.length)){Z.value=[],Q.value=0;return}Z.value=t.data.map((A,o)=>{let e="支持查看";if(A.menus){const a=A.menus.filter(i=>i.app_code);ke(a,"code","parent_id").forEach(i=>{i.children.length>1||!i.children?e=e+`【${i.title}】`:i.children.length===1&&(e=e+`【${i.children[0].title}】`)})}else e="暂无任何权限";return Le(A.type)&&(e="支持查看【系统管理】"),We(A.type)&&(e="支持查看【审计管理】"),ce(ae({},A),{index:(g.value-1)*B.value+o+1,roleMenu:e==="支持查看"?"-":e,description:A.description||"-",roleType:m[A.type]||"-",createTime:A.type===x.CUSTOMER?Ye(A.create_time).format("YYYY-MM-DD HH:mm:ss"):"-"})}),Q.value=t.count}).finally(()=>{k.value=!1})},ue=()=>{I.roleName="",N(!0)};return Fe(()=>{N()}),(V,t)=>{const w=se("SyInput"),A=we,o=Te,e=ve,a=se("SyEmpty"),l=Je,i=Ge,u=qe,D=Ce,L=Ee,q=be,de=ge;return d(),P(q,{id:"organ-manage",class:"sy-row role",gutter:10},{default:r(()=>[c(D,{class:"sy-col-vertical",span:24},{default:r(()=>[c(Qe,{"table-name":"角色管理",expand:!0,"table-load":n(k),onChange:t[5]||(t[5]=p=>N(!0)),onReset:t[6]||(t[6]=p=>ue())},{filterForm:r(()=>[c(o,{ref:"form",class:"sy-form sy-table-vertical-header__form",model:n(I),"label-position":"left",inline:""},{default:r(()=>[c(A,{prop:"roleName",label:"角色名称"},{default:r(()=>[c(w,{modelValue:n(I).roleName,"onUpdate:modelValue":t[0]||(t[0]=p=>n(I).roleName=p),placeholder:"请输入角色名称",maxlength:20,onChange:t[1]||(t[1]=p=>N(!0))},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),tableAction:r(()=>[c(e,{class:"sy-btn-default",type:"success",onClick:t[2]||(t[2]=p=>s("create"))},{default:r(()=>t[13]||(t[13]=[U("新增 ")])),_:1,__:[13]})]),table:r(()=>[me((d(),P(i,{class:"sy-table-vertical",data:n(Z),border:"",stripe:"","highlight-current-row":""},{empty:r(()=>[me(c(a,null,null,512),[[He,!n(k)]])]),default:r(()=>[(d(!0),y(j,null,ee(n(re),p=>(d(),y(j,null,[p.isShow?(d(),P(l,ze({key:0,ref_for:!0},p,{key:p.prop,align:p.align||"left","show-overflow-tooltip":""}),Be({_:2},[p.prop==="operation"?{name:"default",fn:r(({row:W})=>[c(e,{type:"primary",link:"",onClick:te=>s("check",W)},{default:r(()=>t[14]||(t[14]=[U("查看 ")])),_:2,__:[14]},1032,["onClick"]),W.type===f.CUSTOMER||W.type===f.OPERATOR?(d(),P(e,{key:0,type:"primary",link:"",onClick:te=>s("edit",W)},{default:r(()=>t[15]||(t[15]=[U(" 编辑 ")])),_:2,__:[15]},1032,["onClick"])):J("",!0),W.type===f.CUSTOMER?(d(),P(e,{key:1,type:"danger",link:"",onClick:te=>s("delete",W)},{default:r(()=>t[16]||(t[16]=[U(" 删除 ")])),_:2,__:[16]},1032,["onClick"])):J("",!0)]),key:"0"}:void 0]),1040,["align"])):J("",!0)],64))),256))]),_:1},8,["data"])),[[de,n(k)]]),_("div",yl,[c(u,{"current-page":n(g),"onUpdate:currentPage":t[3]||(t[3]=p=>G(g)?g.value=p:null),"page-size":n(B),"onUpdate:pageSize":t[4]||(t[4]=p=>G(B)?B.value=p:null),class:"sy-pagination",layout:"total,prev,pager,next,jumper","popper-class":"sy-popper",total:n(Q),background:"",onCurrentChange:ie,onSizeChange:N},null,8,["current-page","page-size","total"])])]),_:1},8,["table-load"])]),_:1}),c(L,{modelValue:n(S),"onUpdate:modelValue":t[10]||(t[10]=p=>G(S)?S.value=p:null),class:"sy-dialog sy-dialog--mini role-remove",width:"25vw",title:n($),"close-on-click-modal":!1,"append-to-body":"",center:""},{footer:r(()=>[c(e,{class:"sy-btn-default",type:"warning",onClick:t[8]||(t[8]=p=>S.value=!1)},{default:r(()=>t[18]||(t[18]=[U("取消")])),_:1,__:[18]}),c(e,{class:"sy-btn-default",type:"primary",onClick:t[9]||(t[9]=p=>H())},{default:r(()=>[U(O(n(Y)?"确认":"确认删除"),1)]),_:1})]),default:r(()=>[_("div",vl,[n(Y)?(d(),y("div",Cl,[c(o,{ref_key:"delFormRef",ref:z,class:"sy-form role-remove-passwd__form",model:n(T),rules:n(X)},{default:r(()=>[c(A,{label:"请输入登录密码完成二次确认："}),c(A,{label:"登录密码：",prop:"checkPwd"},{default:r(()=>[c(w,{modelValue:n(T).checkPwd,"onUpdate:modelValue":t[7]||(t[7]=p=>n(T).checkPwd=p),placeholder:"请输入密码进行确认",type:"password","show-password":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])):(d(),y("div",gl,[_("div",kl,[_("span",bl,O(n(T).roleType)+"角色已关联"+O(n(T).linked)+"位用户,",1)]),t[17]||(t[17]=_("div",{class:"role-remove-check__info"},[_("span",null,"删除后将影响用户登录"),U("，你还要继续吗？")],-1))]))])]),_:1},8,["modelValue","title"]),c(hl,{visible:n(h),"onUpdate:visible":t[11]||(t[11]=p=>G(h)?h.value=p:null),title:n($),mode:n(F),data:n(M),onConfirm:t[12]||(t[12]=p=>N(!0))},null,8,["visible","title","mode","data"])]),_:1})}}},Hl=ye(El,[["__scopeId","data-v-1fd1b3e2"]]);export{Hl as default};
