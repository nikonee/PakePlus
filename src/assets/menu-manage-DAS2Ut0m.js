const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./MenuModal-CG4mXMBK.js","./index-CTBb4ZkS.js","./index-DNR-gxQs.css","./el-overlay-D3Gjxykq.js","./index-NZlxnoz3.js","./el-overlay-Dn2unfpf.css","./el-form-item-CfUEk-Ki.js","./_Uint8Array-DrW7drqq.js","./_initCloneObject-BGH32tGU.js","./el-form-item-DMqCpRMi.css","./el-switch-By721Gye.js","./el-switch-Bdy1xwy_.css","./el-table-column-DGusqlFC.js","./el-checkbox-D8hjxyAE.js","./el-checkbox-DU5p5tse.css","./el-table-column-CNZnju-y.css","./el-select-BK9AHEpf.js","./token-DI9FKtlJ.js","./strings-BlQ6dbze.js","./el-select-D-NX6r_n.css","./MenuModal-B3mMhaFA.css","./el-button-DOYVdh79.css"])))=>i.map(i=>d[i]);
var Ee=Object.defineProperty,Te=Object.defineProperties;var $e=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var ae=(E,v,g)=>v in E?Ee(E,v,{enumerable:!0,configurable:!0,writable:!0,value:g}):E[v]=g,N=(E,v)=>{for(var g in v||(v={}))Me.call(v,g)&&ae(E,g,v[g]);if(te)for(var g of te(v))Ue.call(v,g)&&ae(E,g,v[g]);return E},q=(E,v)=>Te(E,$e(v));import{_ as Ve,n as Ae,a2 as Se,u as Re,v as le,a9 as xe,aa as De,d as k,e as ne,S as Le,z as Ie,f as se,g as P,o as R,w as d,h as f,k as K,O as Ne,i,W as oe,C as re,J as ie,P as ue,T as Pe,U as Be,l as Fe,m as B,X as we,a4 as Oe,Y as We,H as Ke,A,a7 as G,b2 as Q,$ as b,a3 as pe,K as z,b4 as de,c as ze,a1 as He,a8 as ce}from"./index-CTBb4ZkS.js";/* empty css                   */import{E as Je,a as Xe}from"./el-col-CqGR1kBo.js";import{E as Ye,a as qe}from"./el-table-column-DGusqlFC.js";import"./el-checkbox-D8hjxyAE.js";import{E as Ge}from"./el-switch-By721Gye.js";/* empty css                  */import{E as Qe,a as Ze}from"./el-form-item-CfUEk-Ki.js";import{E as je,a as et}from"./el-select-BK9AHEpf.js";import{E as tt}from"./el-text-B7ih4AtS.js";import{F as at}from"./FilterTable-Dj7-HX7L.js";import"./index-NZlxnoz3.js";import"./_Uint8Array-DrW7drqq.js";import"./_initCloneObject-BGH32tGU.js";import"./token-DI9FKtlJ.js";import"./strings-BlQ6dbze.js";const lt={class:"sy-card menu-manage-aside"},nt={class:"sy-card__body content"},st=Ae({name:"MenuManage"}),ot=Object.assign(st,{setup(E){const v=We(()=>He(()=>import("./MenuModal-CG4mXMBK.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]),import.meta.url)),g=Se(),O=Re(),Z=le(()=>xe(De.MenuTypes)),D=k(!1),H=k(""),o=ne({code:"",parent_title:"",parent_id:"",title:"",menu_type:"",uri:"",order_num:"",enable:"",name:"",param:""}),L=Le([]),F=k([]),y=ne({title:"",menu_type:"",enable:""}),me=le(()=>[{type:"selection",width:60,align:"center",fixed:"left",noTooltip:!0,isShow:!0},{type:"index",label:"序号",width:80,align:"center"},{prop:"title",label:"菜单名称",minWidth:150},{prop:"parentTitle",label:"上级菜单名称",minWidth:150},{prop:"menuType",label:"菜单类型"},{prop:"uri",label:"路由地址",minWidth:230},{prop:"order_num",label:"排序号",sortable:!0},{prop:"enable",label:"启用状态"},{prop:"operation",label:"操作",minWidth:150}]),I=()=>{const r=W.value.getCurrentNode();h.value=!0,L.value=r.children?r.children.filter(e=>y.title&&!e.title.includes(y.title)||y.menu_type&&+e.menu_type!==y.menu_type?!1:!(y.enable!==""&&e.enable!==y.enable)):[],h.value=!1},fe=()=>{y.title="",y.menu_type="",y.enable="",I()},x=k(!1),$=(r,e)=>{switch(r){case"create":if(H.value="新增菜单",o.code="",o.parentTitle="系统菜单",o.title="",o.menu_type="",o.uri="",o.name="",o.param="",o.order_num="",M.value!=="-1"){const t=W.value.getNode(M.value).data;o.parent_id=M.value,o.parentTitle=t.title,o.parent_title=t.title}o.enable=!0,D.value=!0;break;case"update":{const{code:t,parent_title:a,parent_id:l,title:n,menu_type:_,uri:p,order_num:c,enable:u,name:m,param:C}=e;H.value="编辑菜单",o.code=t,o.parent_title=a,o.parentTitle="系统菜单",M.value!=="-1"&&(o.parentTitle=a,o.parent_title=a),o.parent_id=l,o.title=n,o.param=C,o.menu_type=_,o.uri=p,o.order_num=c,o.enable=u,o.name=m,D.value=!0}break;case"sync":Q("确认同步当前菜单？",{type:"warning",callback:t=>{var a;if(t==="confirm"){const l=_e([...ze.filter(u=>{var m,C;return!((m=u.meta)!=null&&m.base)&&!((C=u.meta)!=null&&C.hidden)})],0),n=G([...l],"code","parent_id","-1"),_=z.cloneDeep((a=U.value[0])==null?void 0:a.children)||[],p=[],c=[];n.forEach(u=>{var C,S;const m=_.find(V=>V.name===u.name);if(m){if(m.children.forEach(V=>{c.push(V.code)}),((C=u.children)==null?void 0:C.length)>0){const V=u.children.map(X=>z.omit(q(N({},X),{parent_id:m.code,parent_title:m.title}),"children"));p.push(...V)}}else((S=u.children)==null?void 0:S.length)>0&&p.push(z.omit(N({},u),"children"),...u.children)}),c.length>0?(h.value=!0,A.postUserApi("menu/remove",{code_list:c}).then(u=>{u!=null&&u.success?p.length>0?$("batchCreate",p):b({type:"success",message:"菜单同步成功！"}):b({type:"error",message:"菜单同步失败！"})}).catch(()=>{h.value=!1})):p.length>0&&$("batchCreate",p)}}});break;case"delete":Q(`确认删除 ${e.title}?`,{type:"warning",callback:t=>{if(t==="confirm"){const a=[];J(e,a),A.postUserApi("menu/remove",{code_list:a}).then(l=>{l!=null&&l.success?(b({type:"success",message:`${e.title}删除成功！`}),h.value=!0,L.value=[],w()):b({type:"error",message:`${e.title}删除失败！`})})}}});break;case"enable":return new Promise((t,a)=>{A.postUserApi("menu/enable",{code:e.code,enable:!0}).then(l=>{l!=null&&l.success?(b({type:"success",message:`${e.title}启用成功！`}),t(!0)):(b({type:"error",message:`${e.title}启用失败！`}),a(!1))}).catch(()=>{b({type:"error",message:`${e.title}启用失败！`}),a(!1)})});case"disable":return new Promise((t,a)=>{A.postUserApi("menu/enable",{code:e.code,enable:!1}).then(l=>{l!=null&&l.success?(b({type:"success",message:`${e.title}禁用成功！`}),t(!0)):(b({type:"error",message:`${e.title}禁用失败！`}),a(!1))}).catch(()=>{b({type:"error",message:`${e.title}禁用失败！`}),a(!1)})});case"updateMenu":if(Ce.value)return;x.value=!0,A.getUserApi("role/role_menu",{offset:0,limit:1e3}).then(t=>{if(!(t!=null&&t.success))return x.value=!1,b({type:"error",message:"获取角色菜单失败！"});const a=t.data.filter(_=>[pe.CUSTOMER,pe.OPERATOR].includes(_.type)),l=z.cloneDeep(U.value[0].children),n=[];if(a.length>0&&a.forEach(_=>{var c;const p=[];if(((c=_.menus)==null?void 0:c.length)>0){const u=G(_.menus,"code","parent_id","-1");l.forEach(m=>{if(u.find(S=>S.name===m.name)){const S=de([m]).map(V=>V.code);p.push(...S)}})}else l.forEach(u=>{const m=de([u]).map(C=>C.code);p.push(...m)});p.length>0&&n.push({code:_.code,menus:p})}),n.length>0){let _=n.length;n.forEach(p=>{A.postUserApi("role/role_menu/update",{code:p.code,menu_code_list:p.menus}).then(c=>{if(!c.success)return x.value=!1,b({type:"error",message:"角色更新失败!"});_--,_===0&&(x.value=!1,b({type:"success",message:"角色更新成功!"}))}).catch(()=>{x.value=!1})})}}).catch(()=>{x.value=!1});break;case"batchCreate":A.postUserApi("menu/bulk_create",[...e]).then(t=>{if(t.success)b({type:"success",message:"菜单同步成功！"}),w(!0);else return h.value=!1,b({type:"error",message:"菜单同步失败！"})}).finally(()=>{h.value=!1});break;case"batchDelete":Q("确认批量删除?",{type:"warning",callback:t=>{var a;if(t==="confirm"){if(!((a=F.value)!=null&&a.length))return b({type:"info",message:"请先选择删除项！"});const l=[];F.value.forEach(n=>{J(n,l)}),A.postUserApi("menu/remove",{code_list:l}).then(n=>{n!=null&&n.success?(b({type:"success",message:"批量删除成功！"}),h.value=!0,L.value=[],w()):b({type:"error",message:"批量删除失败！"})})}}});break}},J=(r,e=[])=>{(r==null?void 0:r.children.length)>0&&(r==null||r.children.forEach(t=>{J(t,e)})),e.push(r.code)},_e=(r,e,t={})=>{let a=[],l=e+1;return r.forEach(n=>{var p;const _=ce();a.push(N({name:n.name,uri:n.path,title:n.meta?n.meta.title:"",parent_title:"",parent_id:"",menu_type:"1",order_num:l++,app_code:g.appCode,code:_,enable:!0,creator_id:O.userId,creator_name:O.username},t)),((p=n.children)==null?void 0:p.length)>0&&n.children.forEach(c=>{var u;a.push(N({name:c.name,uri:c.path.startsWith("/")?`${n.path}${c.path}`:`${n.path}/${c.path}`,title:c.meta?c.meta.title:"",parent_title:n.meta?n.meta.title:"",parent_id:_,menu_type:"1",app_code:g.appCode,code:ce(),enable:!0,order_num:l++,creator_id:O.userId,creator_name:O.username,param:((u=c.meta)==null?void 0:u.param)||void 0},t))})}),a},j=k(["-1"]),M=k("-1"),be=(r,e)=>r?e.title&&e.title.includes(r):!0,ye=r=>{M.value!==r.code&&(M.value=r.code,j.value=["-1",r.code],I())},W=k(null),h=k(!1),ve={label:"title"},U=k([]),w=r=>{h.value=!0,A.getUserApi("menu_list",{ordering:"id",offset:0,limit:1e3,app_code:g.appCode}).then(e=>{if(!(e!=null&&e.data.length)){U.value=[];return}U.value=[{code:"-1",title:"系统菜单",children:G(e.data.filter(t=>t.menu_icon==="").map(t=>q(N({},t),{menuType:Z.value[+t.menu_type]||"-",parentTitle:t.parent_id===""?"系统菜单":t.parent_title})),"code","parent_id")}],r?(L.value=U.value[0].children,setTimeout(()=>{M.value="-1"},200)):(L.value=ee(U.value,M.value).children,setTimeout(()=>{var t;(t=W.value)==null||t.setCurrentKey(M.value)},200))}).finally(()=>{h.value=!1})},ee=(r,e)=>{for(const t of r){if(t.code===e)return t;if(t.children){const a=ee(t.children,e);if(a)return a}}return null},ge=k(""),he=k(""),Ce=k(!1);return Ie(()=>{w(!0)}),(r,e)=>{const t=tt,a=se("SyEmpty"),l=Je,n=se("SyInput"),_=Ze,p=et,c=je,u=Qe,m=Fe,C=Ge,S=qe,V=Ye,X=Xe,ke=Oe;return R(),P(X,{id:"menu-manage",class:"sy-row",gutter:10},{default:d(()=>[f(l,{span:5,class:"sy-col"},{default:d(()=>[K("div",lt,[e[15]||(e[15]=K("div",{class:"sy-card__header"},[K("div",{class:"sy-card__header-title"},"菜单列表")],-1)),K("div",nt,[i(U).length?(R(),P(t,{key:0,ref_key:"treeRef",ref:W,class:"sy-tree menu-manage-aside__tree","node-key":"code",props:ve,data:i(U),"filter-node-method":be,"default-expanded-keys":i(j),"check-strictly":"",accordion:"",onCurrentChange:ye},null,8,["data","default-expanded-keys"])):!i(h)&&i(U).length===0?(R(),P(a,{key:1})):Ne("",!0)])])]),_:1}),f(l,{span:19,class:"sy-col-vertical"},{default:d(()=>[f(at,{"table-name":"菜单管理",expand:!0,"table-load":i(h),onFilter:e[11]||(e[11]=s=>I(!0)),onReset:e[12]||(e[12]=s=>fe())},{filterForm:d(()=>[f(u,{ref:"form",class:"sy-form menu-filter__form",model:i(y),inline:""},{default:d(()=>[f(_,{prop:"title",label:"菜单名称"},{default:d(()=>[f(n,{modelValue:i(y).title,"onUpdate:modelValue":e[0]||(e[0]=s=>i(y).title=s),placeholder:"请输入菜单名称",maxlength:20,onChange:e[1]||(e[1]=s=>I())},null,8,["modelValue"])]),_:1}),f(_,{prop:"menu_type",label:"菜单类型"},{default:d(()=>[f(c,{modelValue:i(y).menu_type,"onUpdate:modelValue":e[2]||(e[2]=s=>i(y).menu_type=s),"popper-class":"sy-popper",placeholder:"请选择菜单类型",clearable:"",onChange:e[3]||(e[3]=s=>I())},{default:d(()=>[(R(!0),re(ie,null,ue(i(Z),(s,T)=>(R(),P(p,{key:T,label:s,value:+T},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),f(_,{prop:"enable",label:"启用状态"},{default:d(()=>[f(c,{modelValue:i(y).enable,"onUpdate:modelValue":e[4]||(e[4]=s=>i(y).enable=s),"popper-class":"sy-popper",placeholder:"请选择启用状态",clearable:"",onChange:e[5]||(e[5]=s=>I())},{default:d(()=>[f(p,{label:"已启用",value:!0}),f(p,{label:"未启用",value:!1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),tableAction:d(()=>[f(m,{class:"sy-btn-default",type:"success",onClick:e[6]||(e[6]=s=>$("create"))},{default:d(()=>e[16]||(e[16]=[B("新增")])),_:1,__:[16]}),f(m,{class:"sy-btn-default",type:"danger",disabled:!i(F)||i(F).length===0,onClick:e[7]||(e[7]=s=>$("batchDelete"))},{default:d(()=>e[17]||(e[17]=[B(" 批量删除 ")])),_:1,__:[17]},8,["disabled"]),f(m,{ref_key:"syncBtnRef",ref:ge,class:"sy-btn-default",type:"success",onClick:e[8]||(e[8]=s=>$("sync"))},{default:d(()=>e[18]||(e[18]=[B(" 同步 ")])),_:1,__:[18]},512),f(m,{ref_key:"updateMenuBtnRef",ref:he,class:"sy-btn-default",type:"primary",loading:i(x),onClick:e[9]||(e[9]=s=>$("updateMenu"))},{default:d(()=>e[19]||(e[19]=[B(" 更新角色菜单 ")])),_:1,__:[19]},8,["loading"])]),table:d(()=>[oe((R(),P(V,{class:"sy-table-vertical menu-manage-table",data:i(L),border:"",stripe:"","highlight-current-row":"",onSelectionChange:e[10]||(e[10]=s=>F.value=s)},{empty:d(()=>[oe(f(a,null,null,512),[[we,!i(h)]])]),default:d(()=>[(R(!0),re(ie,null,ue(i(me),s=>(R(),P(S,Pe({key:s.prop},{ref_for:!0},s,{align:s.align||"left","show-overflow-tooltip":""}),Be({_:2},[s.prop==="operation"?{name:"default",fn:d(({row:T})=>[f(m,{type:"primary",link:"",onClick:Y=>$("update",T)},{default:d(()=>e[20]||(e[20]=[B("编辑")])),_:2,__:[20]},1032,["onClick"]),f(m,{type:"danger",link:"",onClick:Y=>$("delete",T)},{default:d(()=>e[21]||(e[21]=[B("删除")])),_:2,__:[21]},1032,["onClick"])]),key:"0"}:s.prop==="enable"?{name:"default",fn:d(({row:T})=>[f(C,{modelValue:T.enable,"onUpdate:modelValue":Y=>T.enable=Y,class:"sy-switch",width:"55px","inline-prompt":"","before-change":$.bind(this,T.enable?"disable":"enable",T)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),key:"1"}:void 0]),1040,["align"]))),128))]),_:1},8,["data"])),[[ke,i(h)]])]),_:1},8,["table-load"])]),_:1}),f(i(v),{visible:i(D),"onUpdate:visible":e[13]||(e[13]=s=>Ke(D)?D.value=s:null),title:i(H),data:i(o),onConfirm:w,onClose:e[14]||(e[14]=s=>D.value=!1)},null,8,["visible","title","data"])]),_:1})}}}),Tt=Ve(ot,[["__scopeId","data-v-85efe1a9"]]);export{Tt as default};
