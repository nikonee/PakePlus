var O=Object.defineProperty,J=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var k=(s,a,t)=>a in s?O(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,F=(s,a)=>{for(var t in a||(a={}))G.call(a,t)&&k(s,t,a[t]);if(T)for(var t of T(a))K.call(a,t)&&k(s,t,a[t]);return s},$=(s,a)=>J(s,X(a));var q=(s,a,t)=>new Promise((f,i)=>{var b=p=>{try{g(t.next(p))}catch(o){i(o)}},v=p=>{try{g(t.throw(p))}catch(o){i(o)}},g=p=>p.done?f(p.value):Promise.resolve(p.value).then(b,v);g((t=t.apply(s,a)).next())});import{n as Q,v as z,a9 as A,aa as L,d as y,S as Z,e as N,bg as ee,z as te,f as ae,g as P,o as w,w as m,h as c,i as r,k as oe,C as x,J as V,P as ne,O as le,T as se,W as re,X as ie,H as B,ad as Y,A as U}from"./index-B39jV9jF.js";import{E as pe,a as ue}from"./el-col-Bytg58G3.js";import{E as de}from"./el-pagination-Ci021nhQ.js";import{E as me,a as ce}from"./el-table-column-Bv3IDvxf.js";import"./el-select-GiiTkgXP.js";import"./el-checkbox-BKHg6oYz.js";import{E as fe,a as be}from"./el-form-item-DAKEzk2j.js";import{E as ge}from"./el-date-picker-B9D_it1l.js";/* empty css                  */import{F as _e}from"./FilterTable-BoNWDjCu.js";import"./index-BLO7j2E6.js";import"./_Uint8Array-DALx1iGH.js";import"./_initCloneObject-Dv6leNqs.js";import"./token-DI9FKtlJ.js";import"./strings-D1mW6FGG.js";import"./arrays-DWuN4xwz.js";import"./index-B4LtmKnb.js";/* empty css                   */const he={class:"sy-table-footer"},ve=Q({name:"AuditRecord"}),Pe=Object.assign(ve,{setup(s){const a=z(()=>A(L.ActionLevels)),t=z(()=>A(L.StatusTypes)),f=y(!1),i=y(1),b=y(15),v=y(0),g=Z([]),p=y("desc"),o=N({timeRange:void 0,actionLevel:void 0,actionResult:void 0,actionName:"",actionStaff:"",actionContent:""}),W=N([{label:"序号",prop:"index",width:80,align:"center",isShow:!0},{label:"事件类型",prop:"actionName",isShow:!0},{label:"事件内容",prop:"content",isShow:!0},{label:"事件指令",prop:"actionCmd",minWidth:150,isShow:!0},{label:"请求状态",prop:"requestStatus",isShow:!0},{label:"事件结果",prop:"requestResult",isShow:!0},{label:"事件来源",prop:"user_ip",isShow:!0},{label:"操作人员",prop:"user_name",isShow:!0},{label:"操作时间",prop:"time",minWidth:150,isShow:!0},{label:"审计级别",prop:"actionLevel",isShow:!0},{label:"事件备注",prop:"requestDetail",minWidth:150,isShow:!0}]);ee(()=>{});const H=u=>{switch(u){case"reset":o.timeRange=void 0,o.actionLevel=void 0,o.actionResult=void 0,o.actionName="",o.actionStaff="",o.actionContent="",_(!0);break;case"query":_();break}},j=u=>{const{order:e}=u;p.value=e==="ascending"?"asc":"desc",_()},I=()=>{_()},_=u=>{u&&(i.value=1),f.value=!0;const[e,h]=o.timeRange?o.timeRange.map(d=>{if(d)return Y(d).format("YYYY-MM-DD HH:mm:ss")}):[void 0,void 0];U.postHistoryApi("audit_logs",{start_time:e!==void 0?`${e}`:void 0,end_time:h!==void 0?`${h}`:void 0,sort_by:"ts",order:"desc",page:i.value,size:b.value}).then(d=>q(this,null,function*(){if(!d.data.length){g.value=[],v.value=0;return}const C=Y().format("YYYY-MM-DD HH:mm:ss"),D=Y().subtract(1,"year").format("YYYY-MM-DD HH:mm:ss");v.value=yield U.postHistoryApi("audit_logs/count",{start_time:e!==void 0?`${e}`:D.replace(" ","T"),end_time:h!==void 0?`${h}`:C.replace(" ","T")}).then(n=>n.total).catch(()=>d.data.length);let S=[];d.data.forEach((n,E)=>{const R=b.value*(i.value-1)+E+1,M=$(F({},n),{index:R,actionName:n.name,actionCmd:n.method?"["+n.method+"]  "+n.path:n.path,requestStatus:t.value[n.status]||"-",requestResult:n.success?"成功":"失败",requestDetail:n.detail||"-",actionLevel:a.value[n.level]||"-",time:Y(n.time).format("YYYY-MM-DD HH:mm:ss")});S.push(M)}),g.value=S})).finally(()=>{f.value=!1})};return te(()=>{_()}),(u,e)=>{const h=ge,d=be,C=fe,D=ae("SyEmpty"),S=ce,n=me,E=de,R=pe,M=ue;return w(),P(M,{class:"sy-row",gutter:10},{default:m(()=>[c(R,{span:24,class:"sy-col-vertical"},{default:m(()=>[c(_e,{"table-name":"审计记录列表",expand:!0,"table-load":r(f),onFilter:e[4]||(e[4]=l=>H("query")),onReset:e[5]||(e[5]=l=>H("reset"))},{filterForm:m(()=>[c(C,{ref:"tableFormRef",class:"sy-form",model:r(o),"label-position":"left",inline:""},{default:m(()=>[c(d,{label:"时间范围",prop:"timeRange"},{default:m(()=>[c(h,{modelValue:r(o).timeRange,"onUpdate:modelValue":e[0]||(e[0]=l=>r(o).timeRange=l),class:"sy-date-picker",type:"datetimerange","popper-class":"sy-popper",size:"small","range-separator":"至","end-placeholder":"结束时间","start-placeholder":"开始时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss","default-time":u.$defaultTime,"disabled-date":u.$disabledAfterDate,onChange:e[1]||(e[1]=l=>_(!0))},null,8,["modelValue","default-time","disabled-date"])]),_:1})]),_:1},8,["model"])]),table:m(()=>[c(n,{ref:"table",class:"sy-table sy-table-vertical",loading:r(f),data:r(g),border:"",stripe:"","highlight-current-row":"",onSortChange:j},{empty:m(()=>[re(c(D,null,null,512),[[ie,!r(f)]])]),default:m(()=>[(w(!0),x(V,null,ne(r(W),l=>(w(),x(V,null,[l.isShow?(w(),P(S,se({key:0,ref_for:!0},l,{key:l.prop,"header-align":"center",sortable:l.sortable,align:l.align||"left","show-overflow-tooltip":""}),null,16,["sortable","align"])):le("",!0)],64))),256))]),_:1},8,["loading","data"]),oe("div",he,[c(E,{"current-page":r(i),"onUpdate:currentPage":e[2]||(e[2]=l=>B(i)?i.value=l:null),"page-size":r(b),"onUpdate:pageSize":e[3]||(e[3]=l=>B(b)?b.value=l:null),class:"sy-pagination",layout:"total,prev,pager,next,jumper","popper-class":"sy-popper",total:r(v),background:"",onCurrentChange:I,onSizeChange:_},null,8,["current-page","page-size","total"])])]),_:1},8,["table-load"])]),_:1})]),_:1})}}});export{Pe as default};
