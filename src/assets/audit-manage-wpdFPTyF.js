var re=Object.defineProperty,pe=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var H=(f,r,p)=>r in f?re(f,r,{enumerable:!0,configurable:!0,writable:!0,value:p}):f[r]=p,F=(f,r)=>{for(var p in r||(r={}))ie.call(r,p)&&H(f,p,r[p]);if(G)for(var p of G(r))me.call(r,p)&&H(f,p,r[p]);return f},R=(f,r)=>pe(f,de(r));import{_ as fe,n as ce,v as $,aa as J,a9 as be,d as g,e as B,S as ve,z as ye,f as W,g as _,o as i,w as o,h as t,i as a,k as ge,C as T,J as w,P as A,O as _e,T as Ve,U as ke,l as Ce,m as U,W as Ee,X as xe,H as M,A as P,$ as O}from"./index-B39jV9jF.js";import{E as Se,a as Te}from"./el-col-Bytg58G3.js";import{_ as we}from"./ColSetting-BUlMDt2j.js";import{E as Ue}from"./el-overlay-Dn3cFvZe.js";import{E as he}from"./el-pagination-Ci021nhQ.js";import{E as qe,a as Le}from"./el-table-column-Bv3IDvxf.js";import{E as Fe,a as Re}from"./el-select-GiiTkgXP.js";import"./el-checkbox-BKHg6oYz.js";import{E as $e}from"./el-popover-CTzoDydu.js";/* empty css                  */import{E as Ae,a as Me}from"./el-form-item-DAKEzk2j.js";import{F as Pe}from"./FilterTable-BoNWDjCu.js";import"./el-switch-juQbTVDX.js";import"./index-BLO7j2E6.js";import"./_Uint8Array-DALx1iGH.js";import"./_initCloneObject-Dv6leNqs.js";import"./token-DI9FKtlJ.js";import"./strings-D1mW6FGG.js";/* empty css                   */const ze={class:"sy-table-footer"},Ie=ce({name:"AuditManage"}),De=Object.assign(Ie,{setup(f){const r=$(()=>J.ActionLevels),p=$(()=>be(J.ActionLevels)),X=$(()=>[{key:"GET",value:"GET"},{key:"POST",value:"POST"}]),h=g(null),V=g(!1),z=g(!1),d=B({name:"",content:"",path:"",method:void 0,level:void 0}),K=$(()=>({name:[{required:!0,message:"请输入审计类型"}],content:[{required:!0,message:"请输入事件内容"}],method:[{required:!0,message:"请选择事件类型"}],path:[{required:!0,message:"请输入事件路径"}],level:[{required:!0,message:"请选择审计等级"}]})),x=(b,e)=>{switch(b){case"query":c();break;case"reset":n.alarmTime=[],n.modified=void 0,n.alarmLevel=void 0,n.pointStatus=void 0,n.alarmDevice="",c();break;case"enable":{P.postUserApi("audit/enable",{audit_code_list:[e.code],enable:!0}).then(s=>{if(!(s!=null&&s.success))return;O({type:"success",message:"审计项启用成功！"});const u=y.value.findIndex(m=>m.code===e.code);y.value.splice(u,1,R(F({},e),{enable:!0,auditEnable:"已启用"}))});break}case"disable":{P.postUserApi("audit/enable",{audit_code_list:[e.code],enable:!1}).then(s=>{if(!(s!=null&&s.success))return;O({type:"success",message:"审计项禁用成功！"});const u=y.value.findIndex(m=>m.code===e.code);y.value.splice(u,1,R(F({},e),{enable:!1,auditEnable:"未启用"}))});break}case"open":V.value=!0;break}},N=b=>{switch(b){case"cancel":h.value.resetFields(),V.value=!1;break;case"create":{h.value.validate(e=>{if(e){z.value=!0;const{name:s,content:u,path:m,method:E,level:L}=d;P.postUserApi("audit/create",{audit_request_list:[{enable:!1,sub_audit_list:[],name:s,content:u,path:m,method:E,level:L}]}).then(v=>{v!=null&&v.success&&(O({type:"success",message:"审计项新建成功！"}),z.value=!1,V.value=!1,c())}).finally(()=>{z.value=!1})}});break}}},Q=()=>{h.value.resetFields()},S=g(!1),k=g(1),C=g(15),I=g(0),y=ve([]),n=B({actionType:void 0,actionLevel:void 0,auditEnable:void 0,auditRequestType:void 0,actionContent:""}),q=B([{label:"序号",prop:"index",width:80,align:"center",isShow:!0},{label:"审计类型",prop:"name",isShow:!0},{label:"事件内容",prop:"content",isShow:!0},{label:"事件指令",prop:"actionCmd",isShow:!0},{label:"审计级别",prop:"actionLevel",isShow:!0},{label:"是否启用",prop:"auditEnable",isShow:!0},{label:"操作",prop:"operation",width:200,isShow:!0}]),Y=()=>{c()},c=()=>{S.value=!0,P.getUserApi("audit",{name:n.actionType,content:n.actionContent,level:n.actionLevel,enable:n.auditEnable,method:n.auditRequestType,offset:C.value*(k.value-1),limit:C.value}).then(b=>{if(!b||!b.count){y.value=[],k.value=1,I.value=0;return}y.value=b.data.map((e,s)=>{const u=C.value*(k.value-1)+s+1;return R(F({},e),{id:s,index:u,actionLevel:p.value[+e.level],auditEnable:e.enable?"已启用":"未启用",actionCmd:e.method?"["+e.method+"]  "+e.path:e.path})}),I.value=b.count}).finally(()=>{S.value=!1})};return ye(()=>{c()}),(b,e)=>{const s=W("SyInput"),u=Me,m=Re,E=Fe,L=Ae,v=Ce,Z=W("SyEmpty"),j=$e,ee=Le,le=qe,te=he,ae=Se,oe=Ue,ne=we,se=Te;return i(),_(se,{class:"sy-row",gutter:10},{default:o(()=>[t(ae,{span:24,class:"sy-col-vertical"},{default:o(()=>[t(Pe,{"table-name":"审计接口列表",expand:!0,"table-load":a(S),onFilter:e[11]||(e[11]=l=>x("query")),onReset:e[12]||(e[12]=l=>x("reset"))},{filterForm:o(()=>[t(L,{ref:"tableFormRef",class:"sy-form sy-table-vertical-header__form",model:a(n),inline:""},{default:o(()=>[t(u,{label:"审计类型",prop:"actionType"},{default:o(()=>[t(s,{modelValue:a(n).actionType,"onUpdate:modelValue":e[0]||(e[0]=l=>a(n).actionType=l),placeholder:"请输入审计类型",maxlength:20,onChange:e[1]||(e[1]=l=>c(!0))},null,8,["modelValue"])]),_:1}),t(u,{label:"事件内容",prop:"actionContent"},{default:o(()=>[t(s,{modelValue:a(n).actionContent,"onUpdate:modelValue":e[2]||(e[2]=l=>a(n).actionContent=l),placeholder:"请输入事件内容","popper-class":"sy-popper",clearable:"",maxlength:35,onChange:e[3]||(e[3]=l=>c(!0))},null,8,["modelValue"])]),_:1}),t(u,{label:"操作等级",prop:"actionLevel"},{default:o(()=>[t(E,{modelValue:a(n).actionLevel,"onUpdate:modelValue":e[4]||(e[4]=l=>a(n).actionLevel=l),placeholder:"请选择操作等级","popper-class":"sy-popper",clearable:"",onChange:e[5]||(e[5]=l=>c(!0))},{default:o(()=>[(i(!0),T(w,null,A(a(r),l=>(i(),_(m,{key:l.key,label:l.value,value:l.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"启用状态",prop:"auditEnable"},{default:o(()=>[t(E,{modelValue:a(n).auditEnable,"onUpdate:modelValue":e[6]||(e[6]=l=>a(n).auditEnable=l),placeholder:"请选择启用状态","popper-class":"sy-popper",clearable:"",onChange:e[7]||(e[7]=l=>c(!0))},{default:o(()=>[t(m,{label:"已启用",value:1}),t(m,{label:"未启用",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),tableAction:o(()=>[t(v,{class:"sy-btn-default",type:"success",onClick:e[8]||(e[8]=l=>x("open"))},{default:o(()=>e[22]||(e[22]=[U("新增 ")])),_:1,__:[22]})]),table:o(()=>[t(le,{ref:"table",class:"sy-table-vertical",loading:a(S),data:a(y),border:"",stripe:"","highlight-current-row":""},{empty:o(()=>[Ee(t(Z,null,null,512),[[xe,!a(S)]])]),default:o(()=>[(i(!0),T(w,null,A(a(q),l=>(i(),T(w,null,[l.isShow?(i(),_(ee,Ve({key:0,ref_for:!0},l,{key:l.prop,align:l.align||"left","show-overflow-tooltip":""}),ke({_:2},[l.prop==="operation"?{name:"default",fn:o(({row:D})=>[D.enable?(i(),_(j,{key:1,title:"确定禁用该审计项？","popper-class":"sy-popper","cancel-button-type":"text","confirm-button-type":"text",onConfirm:ue=>x("disable",D)},{reference:o(()=>[t(v,{class:"sy-btn-default",type:"danger",size:"small",plain:"",text:""},{default:o(()=>e[24]||(e[24]=[U(" 停用 ")])),_:1,__:[24]})]),_:2},1032,["onConfirm"])):(i(),_(j,{key:0,title:"确定启用该审计项？","popper-class":"sy-popper","cancel-button-type":"text","confirm-button-type":"text",onConfirm:ue=>x("enable",D)},{reference:o(()=>[t(v,{class:"sy-btn-default",type:"success",size:"small",plain:"",text:""},{default:o(()=>e[23]||(e[23]=[U(" 启用 ")])),_:1,__:[23]})]),_:2},1032,["onConfirm"]))]),key:"0"}:void 0]),1040,["align"])):_e("",!0)],64))),256))]),_:1},8,["loading","data"]),ge("div",ze,[t(te,{"current-page":a(k),"onUpdate:currentPage":e[9]||(e[9]=l=>M(k)?k.value=l:null),"page-size":a(C),"onUpdate:pageSize":e[10]||(e[10]=l=>M(C)?C.value=l:null),class:"sy-pagination",layout:"total,prev,pager,next,jumper","popper-class":"sy-popper",total:a(I),background:"",onCurrentChange:Y,onSizeChange:c},null,8,["current-page","page-size","total"])])]),_:1},8,["table-load"])]),_:1}),t(oe,{ref:"auditModalRef",modelValue:a(V),"onUpdate:modelValue":e[20]||(e[20]=l=>M(V)?V.value=l:null),class:"sy-dialog sy-dialog--mini",width:"30vw",title:"新建审计项","close-on-click-modal":!1,"append-to-body":"",center:"",onClosed:Q},{footer:o(()=>[t(v,{class:"sy-btn-default",type:"warning",onClick:e[18]||(e[18]=l=>N("cancel"))},{default:o(()=>e[25]||(e[25]=[U("取消")])),_:1,__:[25]}),t(v,{class:"sy-btn-default",type:"primary",onClick:e[19]||(e[19]=l=>N("create"))},{default:o(()=>e[26]||(e[26]=[U("确定")])),_:1,__:[26]})]),default:o(()=>[t(L,{ref_key:"auditFormRef",ref:h,class:"sy-form audit-form","label-suffix":"：","label-width":"auto","label-position":"left",model:a(d),rules:a(K)},{default:o(()=>[t(u,{prop:"name",label:"审计类型",required:""},{default:o(()=>[t(s,{modelValue:a(d).name,"onUpdate:modelValue":e[13]||(e[13]=l=>a(d).name=l),placeholder:"请输入审计类型",maxlength:20,clearable:""},null,8,["modelValue"])]),_:1}),t(u,{prop:"content",label:"事件内容",required:""},{default:o(()=>[t(s,{modelValue:a(d).content,"onUpdate:modelValue":e[14]||(e[14]=l=>a(d).content=l),placeholder:"请输入事件内容",maxlength:20,clearable:""},null,8,["modelValue"])]),_:1}),t(u,{prop:"method",label:"事件类型",required:""},{default:o(()=>[t(E,{modelValue:a(d).method,"onUpdate:modelValue":e[15]||(e[15]=l=>a(d).method=l),"popper-class":"sy-popper",placeholder:"请选择事件类型",clearable:""},{default:o(()=>[(i(!0),T(w,null,A(a(X),l=>(i(),_(m,{key:l.key,label:l.label,value:l.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{prop:"path",label:"事件路径",required:""},{default:o(()=>[t(s,{modelValue:a(d).path,"onUpdate:modelValue":e[16]||(e[16]=l=>a(d).path=l),placeholder:"请输入事件路径",maxlength:40,clearable:""},null,8,["modelValue"])]),_:1}),t(u,{prop:"level",label:"审计等级",required:""},{default:o(()=>[t(E,{modelValue:a(d).level,"onUpdate:modelValue":e[17]||(e[17]=l=>a(d).level=l),"popper-class":"sy-popper",placeholder:"请选择审计等级",clearable:""},{default:o(()=>[(i(!0),T(w,null,A(a(r),l=>(i(),_(m,{key:l.key,label:l.value,value:l.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(ne,{ref:"colRef","col-setting":a(q),"onUpdate:colSetting":e[21]||(e[21]=l=>M(q)?q.value=l:null)},null,8,["col-setting"])]),_:1})}}}),ul=fe(De,[["__scopeId","data-v-8150c739"]]);export{ul as default};
