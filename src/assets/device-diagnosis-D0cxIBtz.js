var ii=Object.defineProperty,ri=Object.defineProperties;var ai=Object.getOwnPropertyDescriptors;var ft=Object.getOwnPropertySymbols;var ni=Object.prototype.hasOwnProperty,oi=Object.prototype.propertyIsEnumerable;var pt=(e,t,i)=>t in e?ii(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,A=(e,t)=>{for(var i in t||(t={}))ni.call(t,i)&&pt(e,i,t[i]);if(ft)for(var i of ft(t))oi.call(t,i)&&pt(e,i,t[i]);return e},ce=(e,t)=>ri(e,ai(t));var Se=(e,t,i)=>new Promise((r,a)=>{var o=n=>{try{s(i.next(n))}catch(u){a(u)}},l=n=>{try{s(i.throw(n))}catch(u){a(u)}},s=n=>n.done?r(n.value):Promise.resolve(n.value).then(o,l);s((i=i.apply(e,t)).next())});import{ax as si,ay as We,ai as li,n as tt,ah as ui,v as z,cW as ci,cX as hi,aY as di,al as fi,bb as pi,at as gi,bK as gt,C as k,o as E,O as vt,V,i as L,k as b,Q as he,ao as mt,t as N,g as ke,w as Be,bf as vi,am as mi,aM as _i,cY as xe,cZ as pe,c_ as se,c$ as _,d0 as Bt,d1 as De,d2 as Ae,d3 as ge,d4 as yi,d5 as X,d6 as Vt,d7 as Ye,d8 as kt,d9 as xi,da as wi,db as bi,dc as it,dd as Si,de as Ti,df as rt,dg as at,dh as nt,di as Li,dj as Ut,dk as Mi,dl as Pi,dm as Ci,dn as Ht,dp as Qe,dq as Ge,dr as Di,ds as $,dt as Ai,du as _t,dv as ne,dw as Ii,dx as Oi,dy as me,dz as Wt,dA as K,dB as fe,dC as Gi,dD as yt,dE as Ei,dF as xt,dG as wt,dH as Ni,dI as q,dJ as Ne,dK as $e,dL as zi,dM as Ri,dN as bt,dO as $t,dP as jt,bv as U,K as ee,_ as ot,d as W,dQ as _e,aE as Je,z as Zt,bg as Fi,dR as St,aG as qt,dS as R,dT as Bi,dU as Vi,dV as ki,dW as Ui,dX as Hi,dY as Wi,h as de,a9 as $i,f as Tt,W as ji,l as Zi,m as Lt,J as Mt,P as Pt,a4 as qi,E as Xi,aa as Yi}from"./index-DXV2JZ8m.js";/* empty css                   *//* empty css                  */import{a as Qi}from"./dev-tree-CA4MbC4c.js";import{D as Ji}from"./index-CTOVPCyr.js";import{L as Ki}from"./LeftRightLayout-BN_jRf-X.js";import"./el-text-6xWo_nzx.js";import"./token-DI9FKtlJ.js";import"./el-checkbox-CDMdhvJE.js";import"./_Uint8Array-Bj4etxqr.js";import"./el-col-Dvkq0Vgv.js";const er=si({type:{type:String,default:"line",values:["line","circle","dashboard"]},percentage:{type:Number,default:0,validator:e=>e>=0&&e<=100},status:{type:String,default:"",values:["","success","exception","warning"]},indeterminate:Boolean,duration:{type:Number,default:3},strokeWidth:{type:Number,default:6},strokeLinecap:{type:We(String),default:"round"},textInside:Boolean,width:{type:Number,default:126},showText:{type:Boolean,default:!0},color:{type:We([String,Array,Function]),default:""},striped:Boolean,stripedFlow:Boolean,format:{type:We(Function),default:e=>`${e}%`}}),tr=tt({name:"ElProgress"}),ir=tt(ce(A({},tr),{props:er,setup(e){const t=e,i={success:"#13ce66",exception:"#ff4949",warning:"#e6a23c",default:"#20a0ff"},r=ui("progress"),a=z(()=>{const m={width:`${t.percentage}%`,animationDuration:`${t.duration}s`},x=T(t.percentage);return x.includes("gradient")?m.background=x:m.backgroundColor=x,m}),o=z(()=>(t.strokeWidth/t.width*100).toFixed(1)),l=z(()=>["circle","dashboard"].includes(t.type)?Number.parseInt(`${50-Number.parseFloat(o.value)/2}`,10):0),s=z(()=>{const m=l.value,x=t.type==="dashboard";return`
          M 50 50
          m 0 ${x?"":"-"}${m}
          a ${m} ${m} 0 1 1 0 ${x?"-":""}${m*2}
          a ${m} ${m} 0 1 1 0 ${x?"":"-"}${m*2}
          `}),n=z(()=>2*Math.PI*l.value),u=z(()=>t.type==="dashboard"?.75:1),c=z(()=>`${-1*n.value*(1-u.value)/2}px`),h=z(()=>({strokeDasharray:`${n.value*u.value}px, ${n.value}px`,strokeDashoffset:c.value})),d=z(()=>({strokeDasharray:`${n.value*u.value*(t.percentage/100)}px, ${n.value}px`,strokeDashoffset:c.value,transition:"stroke-dasharray 0.6s ease 0s, stroke 0.6s ease, opacity ease 0.6s"})),f=z(()=>{let m;return t.color?m=T(t.percentage):m=i[t.status]||i.default,m}),p=z(()=>t.status==="warning"?ci:t.type==="line"?t.status==="success"?hi:di:t.status==="success"?fi:pi),g=z(()=>t.type==="line"?12+t.strokeWidth*.4:t.width*.111111+2),y=z(()=>t.format(t.percentage));function v(m){const x=100/m.length;return m.map((S,M)=>gt(S)?{color:S,percentage:(M+1)*x}:S).sort((S,M)=>S.percentage-M.percentage)}const T=m=>{var x;const{color:w}=t;if(gi(w))return w(m);if(gt(w))return w;{const S=v(w);for(const M of S)if(M.percentage>m)return M.color;return(x=S[S.length-1])==null?void 0:x.color}};return(m,x)=>(E(),k("div",{class:V([L(r).b(),L(r).m(m.type),L(r).is(m.status),{[L(r).m("without-text")]:!m.showText,[L(r).m("text-inside")]:m.textInside}]),role:"progressbar","aria-valuenow":m.percentage,"aria-valuemin":"0","aria-valuemax":"100"},[m.type==="line"?(E(),k("div",{key:0,class:V(L(r).b("bar"))},[b("div",{class:V(L(r).be("bar","outer")),style:he({height:`${m.strokeWidth}px`})},[b("div",{class:V([L(r).be("bar","inner"),{[L(r).bem("bar","inner","indeterminate")]:m.indeterminate},{[L(r).bem("bar","inner","striped")]:m.striped},{[L(r).bem("bar","inner","striped-flow")]:m.stripedFlow}]),style:he(L(a))},[(m.showText||m.$slots.default)&&m.textInside?(E(),k("div",{key:0,class:V(L(r).be("bar","innerText"))},[mt(m.$slots,"default",{percentage:m.percentage},()=>[b("span",null,N(L(y)),1)])],2)):vt("v-if",!0)],6)],6)],2)):(E(),k("div",{key:1,class:V(L(r).b("circle")),style:he({height:`${m.width}px`,width:`${m.width}px`})},[(E(),k("svg",{viewBox:"0 0 100 100"},[b("path",{class:V(L(r).be("circle","track")),d:L(s),stroke:`var(${L(r).cssVarName("fill-color-light")}, #e5e9f2)`,"stroke-linecap":m.strokeLinecap,"stroke-width":L(o),fill:"none",style:he(L(h))},null,14,["d","stroke","stroke-linecap","stroke-width"]),b("path",{class:V(L(r).be("circle","path")),d:L(s),stroke:L(f),fill:"none",opacity:m.percentage?1:0,"stroke-linecap":m.strokeLinecap,"stroke-width":L(o),style:he(L(d))},null,14,["d","stroke","opacity","stroke-linecap","stroke-width"])]))],6)),(m.showText||m.$slots.default)&&!m.textInside?(E(),k("div",{key:2,class:V(L(r).e("text")),style:he({fontSize:`${L(g)}px`})},[mt(m.$slots,"default",{percentage:m.percentage},()=>[m.status?(E(),ke(L(mi),{key:1},{default:Be(()=>[(E(),ke(vi(L(p))))]),_:1})):(E(),k("span",{key:0},N(L(y)),1))])],6)):vt("v-if",!0)],10,["aria-valuenow"]))}}));var rr=li(ir,[["__file","progress.vue"]]);const ar=_i(rr);var O=xe.vec3,Ct=xe.vec2,J=O.normalize,ze=O.cross,Dt=O.sub,je=O.add,oe=O.create,ie=oe(),Z=oe(),re=oe(),Te=oe(),At=[],It=[];function nr(e,t){Ct.copy(At,e[0]),Ct.copy(It,e[1]);var i=[],r=i[0]=oe(),a=i[1]=oe(),o=i[2]=oe(),l=i[3]=oe();t.dataToPoint(At,r),t.dataToPoint(It,l),J(ie,r),Dt(Z,l,r),J(Z,Z),ze(re,Z,ie),J(re,re),ze(Z,ie,re),je(a,ie,Z),J(a,a),J(ie,l),Dt(Z,r,l),J(Z,Z),ze(re,Z,ie),J(re,re),ze(Z,ie,re),je(o,ie,Z),J(o,o),je(Te,r,l),J(Te,Te);var s=O.dot(r,Te),n=O.dot(Te,a),u=(Math.max(O.len(r),O.len(l))-s)/n*2;return O.scaleAndAdd(a,r,a,u),O.scaleAndAdd(o,l,o,u),i}function or(e,t,i){var r=[],a=r[0]=O.create(),o=r[1]=O.create(),l=r[2]=O.create(),s=r[3]=O.create();t.dataToPoint(e[0],a),t.dataToPoint(e[1],s);var n=O.dist(a,s);return O.lerp(o,a,s,.3),O.lerp(l,a,s,.3),O.scaleAndAdd(o,o,i,Math.min(n*.1,10)),O.scaleAndAdd(l,l,i,Math.min(n*.1,10)),r}function Xt(e,t){for(var i=new Float32Array(e.length*3),r=0,a=[],o=0;o<e.length;o++)t.dataToPoint(e[o],a),i[r++]=a[0],i[r++]=a[1],i[r++]=a[2];return i}function Yt(e){var t=[];return e.each(function(i){var r=e.getItemModel(i),a=r.option instanceof Array?r.option:r.getShallow("coords",!0);t.push(a)}),{coordsList:t}}function sr(e,t){var i=e.getData(),r=e.get("polyline");i.setLayout("lineType",r?"polyline":"cubicBezier");var a=Yt(i);i.each(function(o){var l=a.coordsList[o],s=r?Xt:nr;i.setItemLayout(o,s(l,t))})}function Ot(e,t,i){var r=e.getData(),a=e.get("polyline"),o=Yt(r);r.setLayout("lineType",a?"polyline":"cubicBezier"),r.each(function(l){var s=o.coordsList[l],n=a?Xt(s,t):or(s,t,i);r.setItemLayout(l,n)})}function lr(e,t){e.eachSeriesByType("lines3D",function(i){var r=i.coordinateSystem;r.type==="globe"?sr(i,r):r.type==="geo3D"?Ot(i,r,[0,1,0]):(r.type==="mapbox3D"||r.type==="maptalks3D")&&Ot(i,r,[0,0,1])})}const ur=pe.extend({type:"series.lines3D",dependencies:["globe"],visualStyleAccessPath:"lineStyle",visualDrawType:"stroke",getInitialData:function(e,t){var i=new se(["value"],this);return i.hasItemOption=!1,i.initData(e.data,[],function(r,a,o,l){if(r instanceof Array)return NaN;i.hasItemOption=!0;var s=r.value;if(s!=null)return s instanceof Array?s[l]:s}),i},defaultOption:{coordinateSystem:"globe",globeIndex:0,geo3DIndex:0,zlevel:-10,polyline:!1,effect:{show:!1,period:4,trailWidth:4,trailLength:.2,spotIntensity:6},silent:!0,blendMode:"source-over",lineStyle:{width:1,opacity:.5}}}),cr=`@export ecgl.trail2.vertex
attribute vec3 position: POSITION;
attribute vec3 positionPrev;
attribute vec3 positionNext;
attribute float offset;
attribute float dist;
attribute float distAll;
attribute float start;

attribute vec4 a_Color : COLOR;

uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
uniform vec4 viewport : VIEWPORT;
uniform float near : NEAR;

uniform float speed : 0;
uniform float trailLength: 0.3;
uniform float time;
uniform float period: 1000;

uniform float spotSize: 1;

varying vec4 v_Color;
varying float v_Percent;
varying float v_SpotPercent;

@import ecgl.common.wireframe.vertexHeader

@import ecgl.lines3D.clipNear

void main()
{
 @import ecgl.lines3D.expandLine

 gl_Position = currProj;

 v_Color = a_Color;

 @import ecgl.common.wireframe.vertexMain

#ifdef CONSTANT_SPEED
 float t = mod((speed * time + start) / distAll, 1. + trailLength) - trailLength;
#else
 float t = mod((time + start) / period, 1. + trailLength) - trailLength;
#endif

 float trailLen = distAll * trailLength;

 v_Percent = (dist - t * distAll) / trailLen;

 v_SpotPercent = spotSize / distAll;

 }
@end


@export ecgl.trail2.fragment

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];
uniform float spotIntensity: 5;

varying vec4 v_Color;
varying float v_Percent;
varying float v_SpotPercent;

@import ecgl.common.wireframe.fragmentHeader

@import clay.util.srgb

void main()
{
 if (v_Percent > 1.0 || v_Percent < 0.0) {
 discard;
 }

 float fade = v_Percent;

#ifdef SRGB_DECODE
 gl_FragColor = sRGBToLinear(color * v_Color);
#else
 gl_FragColor = color * v_Color;
#endif

 @import ecgl.common.wireframe.fragmentMain

 if (v_Percent > (1.0 - v_SpotPercent)) {
 gl_FragColor.rgb *= spotIntensity;
 }

 gl_FragColor.a *= fade;
}

@end`;var Gt=xe.vec3;function hr(e){return e>0?1:-1}_.Shader.import(cr);const dr=_.Mesh.extend(function(){var e=new _.Material({shader:new _.Shader(_.Shader.source("ecgl.trail2.vertex"),_.Shader.source("ecgl.trail2.fragment")),transparent:!0,depthMask:!1}),t=new Bt({dynamic:!0});return t.createAttribute("dist","float",1),t.createAttribute("distAll","float",1),t.createAttribute("start","float",1),{geometry:t,material:e,culling:!1,$ignorePicking:!0}},{updateData:function(e,t,i){var r=e.hostModel,a=this.geometry,o=r.getModel("effect"),l=o.get("trailWidth")*t.getDevicePixelRatio(),s=o.get("trailLength"),n=r.get("effect.constantSpeed"),u=r.get("effect.period")*1e3,c=n!=null;c?this.material.set("speed",n/1e3):this.material.set("period",u),this.material[c?"define":"undefine"]("vertex","CONSTANT_SPEED");var h=r.get("polyline");a.trailLength=s,this.material.set("trailLength",s),a.resetOffset(),["position","positionPrev","positionNext"].forEach(function(M){a.attributes[M].value=i.attributes[M].value});var d=["dist","distAll","start","offset","color"];d.forEach(function(M){a.attributes[M].init(a.vertexCount)}),a.indices=i.indices;var f=[],p=o.get("trailColor"),g=o.get("trailOpacity"),y=p!=null,v=g!=null;this.updateWorldTransform();var T=this.worldTransform.x.len(),m=this.worldTransform.y.len(),x=this.worldTransform.z.len(),w=0,S=0;e.each(function(M){var P=e.getItemLayout(M),C=v?g:De(e,M),D=Ae(e,M);C==null&&(C=1),f=_.parseColor(y?p:D,f),f[3]*=C;for(var F=h?i.getPolylineVertexCount(P):i.getCubicCurveVertexCount(P[0],P[1],P[2],P[3]),Y=0,Q=[],be=[],B=w;B<w+F;B++)a.attributes.position.get(B,Q),Q[0]*=T,Q[1]*=m,Q[2]*=x,B>w&&(Y+=Gt.dist(Q,be)),a.attributes.dist.set(B,Y),Gt.copy(be,Q);S=Math.max(S,Y);for(var Ue=Math.random()*(c?Y:u),B=w;B<w+F;B++)a.attributes.distAll.set(B,Y),a.attributes.start.set(B,Ue),a.attributes.offset.set(B,hr(i.attributes.offset.get(B))*l/2),a.attributes.color.set(B,f);w+=F}),this.material.set("spotSize",S*.1*s),this.material.set("spotIntensity",o.get("spotIntensity")),a.dirty()},setAnimationTime:function(e){this.material.set("time",e)}});_.Shader.import(yi);function fr(e){return e.radius!=null?e.radius:e.size!=null?Math.max(e.size[0],e.size[1],e.size[2]):100}const pr=ge.extend({type:"lines3D",__ecgl__:!0,init:function(e,t){this.groupGL=new _.Node,this._meshLinesMaterial=new _.Material({shader:_.createShader("ecgl.meshLines3D"),transparent:!0,depthMask:!1}),this._linesMesh=new _.Mesh({geometry:new Bt,material:this._meshLinesMaterial,$ignorePicking:!0}),this._trailMesh=new dr},render:function(e,t,i){this.groupGL.add(this._linesMesh);var r=e.coordinateSystem,a=e.getData();if(r&&r.viewGL){var o=r.viewGL;o.add(this.groupGL),this._updateLines(e,t,i);var l=r.viewGL.isLinearSpace()?"define":"undefine";this._linesMesh.material[l]("fragment","SRGB_DECODE"),this._trailMesh.material[l]("fragment","SRGB_DECODE")}var s=this._trailMesh;if(s.stopAnimation(),e.get("effect.show")){this.groupGL.add(s),s.updateData(a,i,this._linesMesh.geometry),s.__time=s.__time||0;var n=3600*1e3;this._curveEffectsAnimator=s.animate("",{loop:!0}).when(n,{__time:n}).during(function(){s.setAnimationTime(s.__time)}).start()}else this.groupGL.remove(s),this._curveEffectsAnimator=null;this._linesMesh.material.blend=this._trailMesh.material.blend=e.get("blendMode")==="lighter"?_.additiveBlend:null},pauseEffect:function(){this._curveEffectsAnimator&&this._curveEffectsAnimator.pause()},resumeEffect:function(){this._curveEffectsAnimator&&this._curveEffectsAnimator.resume()},toggleEffect:function(){var e=this._curveEffectsAnimator;e&&(e.isPaused()?e.resume():e.pause())},_updateLines:function(e,t,i){var r=e.getData(),a=e.coordinateSystem,o=this._linesMesh.geometry,l=e.get("polyline");o.expandLine=!0;var s=fr(a);o.segmentScale=s/20;var n="lineStyle.width".split("."),u=i.getDevicePixelRatio();r.each(function(f){var p=r.getItemModel(f),g=p.get(n);g==null&&(g=1),r.setItemVisual(f,"lineWidth",g)}),o.useNativeLine=!1;var c=0,h=0;r.each(function(f){var p=r.getItemLayout(f);l?(c+=o.getPolylineVertexCount(p),h+=o.getPolylineTriangleCount(p)):(c+=o.getCubicCurveVertexCount(p[0],p[1],p[2],p[3]),h+=o.getCubicCurveTriangleCount(p[0],p[1],p[2],p[3]))}),o.setVertexCount(c),o.setTriangleCount(h),o.resetOffset();var d=[];r.each(function(f){var p=r.getItemLayout(f),g=Ae(r,f),y=De(r,f),v=r.getItemVisual(f,"lineWidth")*u;y==null&&(y=1),d=_.parseColor(g,d),d[3]*=y,l?o.addPolyline(p,d,v):o.addCubicCurve(p[0],p[1],p[2],p[3],d,v)}),o.dirty()},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}});function gr(e){e.registerChartView(pr),e.registerSeriesModel(ur),e.registerLayout(lr),e.registerAction({type:"lines3DPauseEffect",event:"lines3deffectpaused",update:"series.lines3D:pauseEffect"},function(){}),e.registerAction({type:"lines3DResumeEffect",event:"lines3deffectresumed",update:"series.lines3D:resumeEffect"},function(){}),e.registerAction({type:"lines3DToggleEffect",event:"lines3deffectchanged",update:"series.lines3D:toggleEffect"},function(){})}function Et(e,t){for(var i=[],r=0;r<t.length;r++)i.push(e.dataToPoint(t[r]));return i}var Qt=pe.extend({type:"series.polygons3D",getRegionModel:function(e){return this.getData().getItemModel(e)},getRegionPolygonCoords:function(e){var t=this.coordinateSystem,i=this.getData().getItemModel(e),r=i.option instanceof Array?i.option:i.getShallow("coords");i.get("multiPolygon")||(r=[r]);for(var a=[],o=0;o<r.length;o++){for(var l=[],s=1;s<r[o].length;s++)l.push(Et(t,r[o][s]));a.push({exterior:Et(t,r[o][0]),interiors:l})}return a},getInitialData:function(e){var t=new se(["value"],this);return t.hasItemOption=!1,t.initData(e.data,[],function(i,r,a,o){if(i instanceof Array)return NaN;t.hasItemOption=!0;var l=i.value;if(l!=null)return l instanceof Array?l[o]:l}),t},defaultOption:{show:!0,data:null,multiPolygon:!1,progressiveThreshold:1e3,progressive:1e3,zlevel:-10,label:{show:!1,distance:2,textStyle:{fontSize:20,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:4}},itemStyle:{color:"#fff",borderWidth:0,borderColor:"#333"},emphasis:{itemStyle:{color:"#639fc0"},label:{show:!0}}}});X(Qt.prototype,Vt);const vr=ge.extend({type:"polygons3D",__ecgl__:!0,init:function(e,t){this.groupGL=new _.Node,this._geo3DBuilderList=[],this._currentStep=0},render:function(e,t,i){this.groupGL.removeAll();var r=e.coordinateSystem;r&&r.viewGL&&r.viewGL.add(this.groupGL);var a=this._geo3DBuilderList[0];a||(a=new Ye(i),a.extrudeY=r.type!=="mapbox3D"&&r.type!=="maptalks3D",this._geo3DBuilderList[0]=a),this._updateShaderDefines(r,a),a.update(e,t,i),this._geo3DBuilderList.length=1,this.groupGL.add(a.rootNode)},incrementalPrepareRender:function(e,t,i){this.groupGL.removeAll();var r=e.coordinateSystem;r&&r.viewGL&&r.viewGL.add(this.groupGL),this._currentStep=0},incrementalRender:function(e,t,i,r){var a=this._geo3DBuilderList[this._currentStep],o=t.coordinateSystem;a||(a=new Ye(r),a.extrudeY=o.type!=="mapbox3D"&&o.type!=="maptalks3D",this._geo3DBuilderList[this._currentStep]=a),a.update(t,i,r,e.start,e.end),this.groupGL.add(a.rootNode),this._updateShaderDefines(o,a),this._currentStep++},_updateShaderDefines:function(e,t){var i=e.viewGL.isLinearSpace()?"define":"undefine";t.rootNode.traverse(function(r){r.material&&(r.material[i]("fragment","SRGB_DECODE"),(e.type==="mapbox3D"||e.type==="maptalks3D")&&(r.material.define("fragment","NORMAL_UP_AXIS",2),r.material.define("fragment","NORMAL_FRONT_AXIS",1)))})},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll(),this._geo3DBuilderList.forEach(function(e){e.dispose()})}});function mr(e){e.registerChartView(vr),e.registerSeriesModel(Qt)}function Nt(e,t){for(var i=[],r=0;r<t.length;r++)i.push(e.dataToPoint(t[r]));return i}var we=pe.extend({type:"series.map3D",layoutMode:"box",coordinateSystem:null,visualStyleAccessPath:"itemStyle",optionUpdated:function(e){var t=this.get("coordinateSystem");t==null||t==="geo3D"||(this.get("groundPlane.show")&&(this.option.groundPlane.show=!1),this._geo=null)},getInitialData:function(e){e.data=this.getFilledRegions(e.data,e.map);var t=it(e.data,{coordDimensions:["value"]}),i=new se(t,this);i.initData(e.data);var r={};return i.each(function(a){var o=i.getName(a),l=i.getItemModel(a);r[o]=l}),this._regionModelMap=r,i},formatTooltip:function(e){return bi(this,e)},getRegionModel:function(e){var t=this.getData().getName(e);return this._regionModelMap[t]||new wi(null,this)},getRegionPolygonCoords:function(e){var t=this.coordinateSystem,i=this.getData().getName(e);if(t.transform){var r=t.getRegion(i);return r?r.geometries:[]}else{this._geo||(this._geo=xi.createGeo3D(this));for(var r=this._geo.getRegion(i),a=[],o=0;o<r.geometries.length;o++){var l=r.geometries[o],s=[],n=Nt(t,l.exterior);if(s&&s.length)for(var u=0;u<l.interiors.length;u++)s.push(Nt(t,s[u]));a.push({interiors:s,exterior:n})}return a}},getFormattedLabel:function(e,t){var i=kt.getFormattedLabel(this,e,t);return i==null&&(i=this.getData().getName(e)),i},defaultOption:{coordinateSystem:"geo3D",data:null}});X(we.prototype,Si);X(we.prototype,Ti);X(we.prototype,rt);X(we.prototype,at);X(we.prototype,Vt);const _r=ge.extend({type:"map3D",__ecgl__:!0,init:function(e,t){this._geo3DBuilder=new Ye(t),this.groupGL=new _.Node},render:function(e,t,i){var r=e.coordinateSystem;if(!(!r||!r.viewGL)){if(this.groupGL.add(this._geo3DBuilder.rootNode),r.viewGL.add(this.groupGL),r.type==="geo3D"){this._sceneHelper||(this._sceneHelper=new nt,this._sceneHelper.initLight(this.groupGL)),this._sceneHelper.setScene(r.viewGL.scene),this._sceneHelper.updateLight(e),r.viewGL.setPostEffect(e.getModel("postEffect"),i),r.viewGL.setTemporalSuperSampling(e.getModel("temporalSuperSampling"));var a=this._control;a||(a=this._control=new Li({zr:i.getZr()}),this._control.init());var o=e.getModel("viewControl");a.setViewGL(r.viewGL),a.setFromViewControlModel(o,0),a.off("update"),a.on("update",function(){i.dispatchAction({type:"map3DChangeCamera",alpha:a.getAlpha(),beta:a.getBeta(),distance:a.getDistance(),from:this.uid,map3DId:e.id})}),this._geo3DBuilder.extrudeY=!0}else this._control&&(this._control.dispose(),this._control=null),this._sceneHelper&&(this._sceneHelper.dispose(),this._sceneHelper=null),e.getData().getLayout("geo3D"),this._geo3DBuilder.extrudeY=!1;this._geo3DBuilder.update(e,t,i,0,e.getData().count());var l=r.viewGL.isLinearSpace()?"define":"undefine";this._geo3DBuilder.rootNode.traverse(function(s){s.material&&s.material[l]("fragment","SRGB_DECODE")})}},afterRender:function(e,t,i,r){var a=r.renderer,o=e.coordinateSystem;o&&o.type==="geo3D"&&(this._sceneHelper.updateAmbientCubemap(a,e,i),this._sceneHelper.updateSkybox(a,e,i))},dispose:function(){this.groupGL.removeAll(),this._control.dispose(),this._geo3DBuilder.dispose()}});function yr(e){Ut(e),e.registerChartView(_r),e.registerSeriesModel(we),e.registerAction({type:"map3DChangeCamera",event:"map3dcamerachanged",update:"series:updateCamera"},function(t,i){i.eachComponent({mainType:"series",subType:"map3D",query:t},function(r){r.setView(t)})})}const xr=pe.extend({type:"series.scatterGL",dependencies:["grid","polar","geo","singleAxis"],visualStyleAccessPath:"itemStyle",hasSymbolVisual:!0,getInitialData:function(){return Mi(this)},defaultOption:{coordinateSystem:"cartesian2d",zlevel:10,progressive:1e5,progressiveThreshold:1e5,large:!1,symbol:"circle",symbolSize:10,zoomScale:0,blendMode:"source-over",itemStyle:{opacity:.8},postEffect:{enable:!1,colorCorrection:{exposure:0,brightness:0,contrast:1,saturation:1,enable:!0}}}});function te(e){this.viewGL=e}te.prototype.reset=function(e,t){this._updateCamera(t.getWidth(),t.getHeight(),t.getDevicePixelRatio()),this._viewTransform=Pi(),this.updateTransform(e,t)};te.prototype.updateTransform=function(e,t){var i=e.coordinateSystem;i.getRoamTransform&&(Ci(this._viewTransform,i.getRoamTransform()),this._setCameraTransform(this._viewTransform),t.getZr().refresh())};te.prototype.dataToPoint=function(e,t,i){i=e.dataToPoint(t,null,i);var r=this._viewTransform;r&&Ht(i,i,r)};te.prototype.removeTransformInPoint=function(e){return this._viewTransform&&Ht(e,e,this._viewTransform),e};te.prototype.getZoom=function(){if(this._viewTransform){var e=this._viewTransform;return 1/Math.max(Math.sqrt(e[0]*e[0]+e[1]*e[1]),Math.sqrt(e[2]*e[2]+e[3]*e[3]))}return 1};te.prototype._setCameraTransform=function(e){var t=this.viewGL.camera;t.position.set(e[4],e[5],0),t.scale.set(Math.sqrt(e[0]*e[0]+e[1]*e[1]),Math.sqrt(e[2]*e[2]+e[3]*e[3]),1)};te.prototype._updateCamera=function(e,t,i){this.viewGL.setViewport(0,0,e,t,i);var r=this.viewGL.camera;r.left=r.top=0,r.bottom=t,r.right=e,r.near=0,r.far=100};const wr=ge.extend({type:"scatterGL",__ecgl__:!0,init:function(e,t){this.groupGL=new _.Node,this.viewGL=new Ge("orthographic"),this.viewGL.add(this.groupGL),this._pointsBuilderList=[],this._currentStep=0,this._sizeScale=1,this._glViewHelper=new te(this.viewGL)},render:function(e,t,i){if(this.groupGL.removeAll(),this._glViewHelper.reset(e,i),!!e.getData().count()){var r=this._pointsBuilderList[0];r||(r=this._pointsBuilderList[0]=new Qe(!0,i)),this._pointsBuilderList.length=1,this.groupGL.add(r.rootNode),this._removeTransformInPoints(e.getData().getLayout("points")),r.update(e,t,i),this.viewGL.setPostEffect(e.getModel("postEffect"),i)}},incrementalPrepareRender:function(e,t,i){this.groupGL.removeAll(),this._glViewHelper.reset(e,i),this._currentStep=0,this.viewGL.setPostEffect(e.getModel("postEffect"),i)},incrementalRender:function(e,t,i,r){if(!(e.end<=e.start)){var a=this._pointsBuilderList[this._currentStep];a||(a=new Qe(!0,r),this._pointsBuilderList[this._currentStep]=a),this.groupGL.add(a.rootNode),this._removeTransformInPoints(t.getData().getLayout("points")),a.setSizeScale(this._sizeScale),a.update(t,i,r,e.start,e.end),r.getZr().refresh(),this._currentStep++}},updateTransform:function(e,t,i){if(e.coordinateSystem.getRoamTransform){this._glViewHelper.updateTransform(e,i);var r=this._glViewHelper.getZoom(),a=Math.max((e.get("zoomScale")||0)*(r-1)+1,0);this._sizeScale=a,this._pointsBuilderList.forEach(function(o){o.setSizeScale(a)})}},_removeTransformInPoints:function(e){if(e)for(var t=[],i=0;i<e.length;i+=2)t[0]=e[i],t[1]=e[i+1],this._glViewHelper.removeTransformInPoint(t),e[i]=t[0],e[i+1]=t[1]},dispose:function(){this.groupGL.removeAll(),this._pointsBuilderList.forEach(function(e){e.dispose()})},remove:function(){this.groupGL.removeAll()}});function br(e){e.registerChartView(wr),e.registerSeriesModel(xr),e.registerLayout({seriesType:"scatterGL",reset:function(t){var i=t.coordinateSystem,r=t.getData(),a;if(i){var o=i.dimensions.map(function(s){return r.mapDimension(s)}).slice(0,2),l=[];o.length===1?a=function(s){for(var n=new Float32Array((s.end-s.start)*2),u=s.start;u<s.end;u++){var c=(u-s.start)*2,h=r.get(o[0],u),d=i.dataToPoint(h);n[c]=d[0],n[c+1]=d[1]}r.setLayout("points",n)}:o.length===2&&(a=function(s){for(var n=new Float32Array((s.end-s.start)*2),u=s.start;u<s.end;u++){var c=(u-s.start)*2,h=r.get(o[0],u),d=r.get(o[1],u);l[0]=h,l[1]=d,l=i.dataToPoint(l),n[c]=l[0],n[c+1]=l[1]}r.setLayout("points",n)})}return{progress:a}}})}function Sr(e,t,i,r,a){for(var o=new Di(r),l=0;l<e.length;l++)o.addNode($.firstNotNull(e[l].id,e[l].name,l),l);for(var s=[],n=[],u=0,l=0;l<t.length;l++){var c=t[l],h=c.source,d=c.target;o.addEdge(h,d,u)&&(n.push(c),s.push($.firstNotNull(c.id,h+" > "+d)),u++)}var f,p=it(e,{coordDimensions:["value"]});f=new se(p,i),f.initData(e);var g=new se(["value"],i);return g.initData(n,s),a&&a(f,g),Ai({mainData:f,struct:o,structAttr:"graph",datas:{node:f,edge:g},datasAttr:{node:"data",edge:"edgeData"}}),o.update(),o}var Me=pe.extend({type:"series.graphGL",visualStyleAccessPath:"itemStyle",hasSymbolVisual:!0,init:function(e){Me.superApply(this,"init",arguments),this.legendDataProvider=function(){return this._categoriesData},this._updateCategoriesData()},mergeOption:function(e){Me.superApply(this,"mergeOption",arguments),this._updateCategoriesData()},getFormattedLabel:function(e,t,i,r){var a=kt.getFormattedLabel(this,e,t,i,r);if(a==null){var o=this.getData(),l=o.dimensions[o.dimensions.length-1];a=o.get(l,e)}return a},getInitialData:function(e,t){var i=e.edges||e.links||[],r=e.data||e.nodes||[],a=this;if(r&&i)return Sr(r,i,this,!0,o).data;function o(l,s){l.wrapMethod("getItemModel",function(h){const d=a._categoriesModels,f=h.getShallow("category"),p=d[f];return p&&(p.parentModel=h.parentModel,h.parentModel=p),h});const n=t.getModel([]).getModel;function u(h,d){const f=n.call(this,h,d);return f.resolveParentPath=c,f}s.wrapMethod("getItemModel",function(h){return h.resolveParentPath=c,h.getModel=u,h});function c(h){if(h&&(h[0]==="label"||h[1]==="label")){const d=h.slice();return h[0]==="label"?d[0]="edgeLabel":h[1]==="label"&&(d[1]="edgeLabel"),d}return h}}},getGraph:function(){return this.getData().graph},getEdgeData:function(){return this.getGraph().edgeData},getCategoriesData:function(){return this._categoriesData},formatTooltip:function(e,t,i){if(i==="edge"){var r=this.getData(),a=this.getDataParams(e,i),o=r.graph.getEdgeByIndex(e),l=r.getName(o.node1.dataIndex),s=r.getName(o.node2.dataIndex),n=[];return l!=null&&n.push(l),s!=null&&n.push(s),n=_t(n.join(" > ")),a.value&&(n+=" : "+_t(a.value)),n}else return Me.superApply(this,"formatTooltip",arguments)},_updateCategoriesData:function(){var e=(this.option.categories||[]).map(function(i){return i.value!=null?i:Object.assign({value:0},i)}),t=new se(["value"],this);t.initData(e),this._categoriesData=t,this._categoriesModels=t.mapArray(function(i){return t.getItemModel(i,!0)})},setView:function(e){e.zoom!=null&&(this.option.zoom=e.zoom),e.offset!=null&&(this.option.offset=e.offset)},setNodePosition:function(e){for(var t=0;t<e.length/2;t++){var i=e[t*2],r=e[t*2+1],a=this.getData().getRawDataItem(t);a.x=i,a.y=r}},isAnimationEnabled:function(){return Me.superCall(this,"isAnimationEnabled")&&!(this.get("layout")==="force"&&this.get("force.layoutAnimation"))},defaultOption:{zlevel:10,z:2,legendHoverLink:!0,layout:"forceAtlas2",forceAtlas2:{initLayout:null,GPU:!0,steps:1,maxSteps:1e3,repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,edgeWeightInfluence:1,edgeWeight:[1,4],nodeWeight:[1,4],preventOverlap:!1,gravityCenter:null},focusNodeAdjacency:!0,focusNodeAdjacencyOn:"mouseover",left:"center",top:"center",symbol:"circle",symbolSize:5,roam:!1,center:null,zoom:1,label:{show:!1,formatter:"{b}",position:"right",distance:5,textStyle:{fontSize:14}},itemStyle:{},lineStyle:{color:"#aaa",width:1,opacity:.5},emphasis:{label:{show:!0}},animation:!1}}),I=xe.vec2,zt=[[0,0],[1,1]],st=ne.extend(function(){return{segmentScale:4,dynamic:!0,useNativeLine:!0,attributes:{position:new ne.Attribute("position","float",2,"POSITION"),normal:new ne.Attribute("normal","float",2),offset:new ne.Attribute("offset","float",1),color:new ne.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0,this._itemVertexOffsets=[]},setVertexCount:function(e){var t=this.attributes;this.vertexCount!==e&&(t.position.init(e),t.color.init(e),this.useNativeLine||(t.offset.init(e),t.normal.init(e)),e>65535?this.indices instanceof Uint16Array&&(this.indices=new Uint32Array(this.indices)):this.indices instanceof Uint32Array&&(this.indices=new Uint16Array(this.indices)))},setTriangleCount:function(e){this.triangleCount!==e&&(e===0?this.indices=null:this.indices=this.vertexCount>65535?new Uint32Array(e*3):new Uint16Array(e*3))},_getCubicCurveApproxStep:function(e,t,i,r){var a=I.dist(e,t)+I.dist(i,t)+I.dist(r,i),o=1/(a+1)*this.segmentScale;return o},getCubicCurveVertexCount:function(e,t,i,r){var a=this._getCubicCurveApproxStep(e,t,i,r),o=Math.ceil(1/a);return this.useNativeLine?o*2:o*2+2},getCubicCurveTriangleCount:function(e,t,i,r){var a=this._getCubicCurveApproxStep(e,t,i,r),o=Math.ceil(1/a);return this.useNativeLine?0:o*2},getLineVertexCount:function(){return this.getPolylineVertexCount(zt)},getLineTriangleCount:function(){return this.getPolylineTriangleCount(zt)},getPolylineVertexCount:function(e){var t;if(typeof e=="number")t=e;else{var i=typeof e[0]!="number";t=i?e.length:e.length/2}return this.useNativeLine?(t-1)*2:(t-1)*2+2},getPolylineTriangleCount:function(e){var t;if(typeof e=="number")t=e;else{var i=typeof e[0]!="number";t=i?e.length:e.length/2}return this.useNativeLine?0:(t-1)*2},addCubicCurve:function(e,t,i,r,a,o){o==null&&(o=1);for(var l=e[0],s=e[1],n=t[0],u=t[1],c=i[0],h=i[1],d=r[0],f=r[1],p=this._getCubicCurveApproxStep(e,t,i,r),g=p*p,y=g*p,v=3*p,T=3*g,m=6*g,x=6*y,w=l-n*2+c,S=s-u*2+h,M=(n-c)*3-l+d,P=(u-h)*3-s+f,C=l,D=s,F=(n-l)*v+w*T+M*y,Y=(u-s)*v+S*T+P*y,Q=w*m+M*x,be=S*m+P*x,B=M*x,Ue=P*x,ct=0,He=0,ht=Math.ceil(1/p),Ee=new Float32Array((ht+1)*3),Ee=[],dt=0,He=0;He<ht+1;He++)Ee[dt++]=C,Ee[dt++]=D,C+=F,D+=Y,F+=Q,Y+=be,Q+=B,be+=Ue,ct+=p,ct>1&&(C=F>0?Math.min(C,d):Math.max(C,d),D=Y>0?Math.min(D,f):Math.max(D,f));this.addPolyline(Ee,a,o)},addLine:function(e,t,i,r){this.addPolyline([e,t],i,r)},addPolyline:function(){var e=I.create(),t=I.create(),i=I.create(),r=I.create(),a=[],o=[],l=[];return function(s,n,u,c,h){if(s.length){var d=typeof s[0]!="number";if(h==null&&(h=d?s.length:s.length/2),!(h<2)){c==null&&(c=0),u==null&&(u=1),this._itemVertexOffsets.push(this._vertexOffset);for(var f=d?typeof n[0]!="number":n.length/4===h,p=this.attributes.position,g=this.attributes.color,y=this.attributes.offset,v=this.attributes.normal,T=this.indices,m=this._vertexOffset,x,w=0;w<h;w++){if(d)a=s[w+c],f?x=n[w+c]:x=n;else{var S=w*2+c;if(a=a||[],a[0]=s[S],a[1]=s[S+1],f){var M=w*4+c;x=x||[],x[0]=n[M],x[1]=n[M+1],x[2]=n[M+2],x[3]=n[M+3]}else x=n}if(this.useNativeLine)w>1&&(p.copy(m,m-1),g.copy(m,m-1),m++);else{var P;if(w<h-1){if(d)I.copy(o,s[w+1]);else{var S=(w+1)*2+c;o=o||[],o[0]=s[S],o[1]=s[S+1]}if(w>0){I.sub(e,a,l),I.sub(t,o,a),I.normalize(e,e),I.normalize(t,t),I.add(r,e,t),I.normalize(r,r);var C=u/2*Math.min(1/I.dot(e,r),2);i[0]=-r[1],i[1]=r[0],P=C}else I.sub(e,o,a),I.normalize(e,e),i[0]=-e[1],i[1]=e[0],P=u/2}else I.sub(e,a,l),I.normalize(e,e),i[0]=-e[1],i[1]=e[0],P=u/2;v.set(m,i),v.set(m+1,i),y.set(m,P),y.set(m+1,-P),I.copy(l,a),p.set(m,a),p.set(m+1,a),g.set(m,x),g.set(m+1,x),m+=2}if(this.useNativeLine)g.set(m,x),p.set(m,a),m++;else if(w>0){var D=this._faceOffset*3,T=this.indices;T[D]=m-4,T[D+1]=m-3,T[D+2]=m-2,T[D+3]=m-3,T[D+4]=m-1,T[D+5]=m-2,this._faceOffset+=2}}this._vertexOffset=m}}}}(),setItemColor:function(e,t){for(var i=this._itemVertexOffsets[e],r=e<this._itemVertexOffsets.length-1?this._itemVertexOffsets[e+1]:this._vertexOffset,a=i;a<r;a++)this.attributes.color.set(a,t);this.dirty("color")}});Ii(st.prototype,Oi);const Tr=`@export ecgl.forceAtlas2.updateNodeRepulsion

#define NODE_COUNT 0

uniform sampler2D positionTex;

uniform vec2 textureSize;
uniform float gravity;
uniform float scaling;
uniform vec2 gravityCenter;

uniform bool strongGravityMode;
uniform bool preventOverlap;

varying vec2 v_Texcoord;

void main() {

 vec4 n0 = texture2D(positionTex, v_Texcoord);

 vec2 force = vec2(0.0);
 for (int i = 0; i < NODE_COUNT; i++) {
 vec2 uv = vec2(
 mod(float(i), textureSize.x) / (textureSize.x - 1.0),
 floor(float(i) / textureSize.x) / (textureSize.y - 1.0)
 );
 vec4 n1 = texture2D(positionTex, uv);

 vec2 dir = n0.xy - n1.xy;
 float d2 = dot(dir, dir);

 if (d2 > 0.0) {
 float factor = 0.0;
 if (preventOverlap) {
 float d = sqrt(d2);
 d = d - n0.w - n1.w;
 if (d > 0.0) {
 factor = scaling * n0.z * n1.z / (d * d);
 }
 else if (d < 0.0) {
 factor = scaling * 100.0 * n0.z * n1.z;
 }
 }
 else {
 factor = scaling * n0.z * n1.z / d2;
 }
 force += dir * factor;
 }
 }

 vec2 dir = gravityCenter - n0.xy;
 float d = 1.0;
 if (!strongGravityMode) {
 d = length(dir);
 }

 force += dir * n0.z * gravity / (d + 1.0);

 gl_FragColor = vec4(force, 0.0, 1.0);
}
@end

@export ecgl.forceAtlas2.updateEdgeAttraction.vertex

attribute vec2 node1;
attribute vec2 node2;
attribute float weight;

uniform sampler2D positionTex;
uniform float edgeWeightInfluence;
uniform bool preventOverlap;
uniform bool linLogMode;

uniform vec2 windowSize: WINDOW_SIZE;

varying vec2 v_Force;

void main() {

 vec4 n0 = texture2D(positionTex, node1);
 vec4 n1 = texture2D(positionTex, node2);

 vec2 dir = n1.xy - n0.xy;
 float d = length(dir);
 float w;
 if (edgeWeightInfluence == 0.0) {
 w = 1.0;
 }
 else if (edgeWeightInfluence == 1.0) {
 w = weight;
 }
 else {
 w = pow(weight, edgeWeightInfluence);
 }
 vec2 offset = vec2(1.0 / windowSize.x, 1.0 / windowSize.y);
 vec2 scale = vec2((windowSize.x - 1.0) / windowSize.x, (windowSize.y - 1.0) / windowSize.y);
 vec2 pos = node1 * scale * 2.0 - 1.0;
 gl_Position = vec4(pos + offset, 0.0, 1.0);
 gl_PointSize = 1.0;

 float factor;
 if (preventOverlap) {
 d = d - n1.w - n0.w;
 }
 if (d <= 0.0) {
 v_Force = vec2(0.0);
 return;
 }

 if (linLogMode) {
 factor = w * log(d) / d;
 }
 else {
 factor = w;
 }
 v_Force = dir * factor;
}
@end

@export ecgl.forceAtlas2.updateEdgeAttraction.fragment

varying vec2 v_Force;

void main() {
 gl_FragColor = vec4(v_Force, 0.0, 0.0);
}
@end

@export ecgl.forceAtlas2.calcWeightedSum.vertex

attribute vec2 node;

varying vec2 v_NodeUv;

void main() {

 v_NodeUv = node;
 gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
 gl_PointSize = 1.0;
}
@end

@export ecgl.forceAtlas2.calcWeightedSum.fragment

varying vec2 v_NodeUv;

uniform sampler2D positionTex;
uniform sampler2D forceTex;
uniform sampler2D forcePrevTex;

void main() {
 vec2 force = texture2D(forceTex, v_NodeUv).rg;
 vec2 forcePrev = texture2D(forcePrevTex, v_NodeUv).rg;

 float mass = texture2D(positionTex, v_NodeUv).z;
 float swing = length(force - forcePrev) * mass;
 float traction = length(force + forcePrev) * 0.5 * mass;

 gl_FragColor = vec4(swing, traction, 0.0, 0.0);
}
@end

@export ecgl.forceAtlas2.calcGlobalSpeed

uniform sampler2D globalSpeedPrevTex;
uniform sampler2D weightedSumTex;
uniform float jitterTolerence;

void main() {
 vec2 weightedSum = texture2D(weightedSumTex, vec2(0.5)).xy;
 float prevGlobalSpeed = texture2D(globalSpeedPrevTex, vec2(0.5)).x;
 float globalSpeed = jitterTolerence * jitterTolerence
 * weightedSum.y / weightedSum.x;
 if (prevGlobalSpeed > 0.0) {
 globalSpeed = min(globalSpeed / prevGlobalSpeed, 1.5) * prevGlobalSpeed;
 }
 gl_FragColor = vec4(globalSpeed, 0.0, 0.0, 1.0);
}
@end

@export ecgl.forceAtlas2.updatePosition

uniform sampler2D forceTex;
uniform sampler2D forcePrevTex;
uniform sampler2D positionTex;
uniform sampler2D globalSpeedTex;

varying vec2 v_Texcoord;

void main() {
 vec2 force = texture2D(forceTex, v_Texcoord).xy;
 vec2 forcePrev = texture2D(forcePrevTex, v_Texcoord).xy;
 vec4 node = texture2D(positionTex, v_Texcoord);

 float globalSpeed = texture2D(globalSpeedTex, vec2(0.5)).r;
 float swing = length(force - forcePrev);
 float speed = 0.1 * globalSpeed / (0.1 + globalSpeed * sqrt(swing));

 float df = length(force);
 if (df > 0.0) {
 speed = min(df * speed, 10.0) / df;

 gl_FragColor = vec4(node.xy + speed * force, node.zw);
 }
 else {
 gl_FragColor = node;
 }
}
@end

@export ecgl.forceAtlas2.edges.vertex
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;

attribute vec2 node;
attribute vec4 a_Color : COLOR;
varying vec4 v_Color;

uniform sampler2D positionTex;

void main()
{
 gl_Position = worldViewProjection * vec4(
 texture2D(positionTex, node).xy, -10.0, 1.0
 );
 v_Color = a_Color;
}
@end

@export ecgl.forceAtlas2.edges.fragment
uniform vec4 color : [1.0, 1.0, 1.0, 1.0];
varying vec4 v_Color;
void main() {
 gl_FragColor = color * v_Color;
}
@end`;_.Shader.import(Tr);var Ze={repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,scaling:1,edgeWeightInfluence:1,jitterTolerence:.1,preventOverlap:!1,dissuadeHubs:!1,gravityCenter:null};function G(e){var t={type:_.Texture.FLOAT,minFilter:_.Texture.NEAREST,magFilter:_.Texture.NEAREST};this._positionSourceTex=new _.Texture2D(t),this._positionSourceTex.flipY=!1,this._positionTex=new _.Texture2D(t),this._positionPrevTex=new _.Texture2D(t),this._forceTex=new _.Texture2D(t),this._forcePrevTex=new _.Texture2D(t),this._weightedSumTex=new _.Texture2D(t),this._weightedSumTex.width=this._weightedSumTex.height=1,this._globalSpeedTex=new _.Texture2D(t),this._globalSpeedPrevTex=new _.Texture2D(t),this._globalSpeedTex.width=this._globalSpeedTex.height=1,this._globalSpeedPrevTex.width=this._globalSpeedPrevTex.height=1,this._nodeRepulsionPass=new me({fragment:_.Shader.source("ecgl.forceAtlas2.updateNodeRepulsion")}),this._positionPass=new me({fragment:_.Shader.source("ecgl.forceAtlas2.updatePosition")}),this._globalSpeedPass=new me({fragment:_.Shader.source("ecgl.forceAtlas2.calcGlobalSpeed")}),this._copyPass=new me({fragment:_.Shader.source("clay.compositor.output")});var i=function(r){r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ONE)};this._edgeForceMesh=new _.Mesh({geometry:new _.Geometry({attributes:{node1:new _.Geometry.Attribute("node1","float",2),node2:new _.Geometry.Attribute("node2","float",2),weight:new _.Geometry.Attribute("weight","float",1)},dynamic:!0,mainAttribute:"node1"}),material:new _.Material({transparent:!0,shader:_.createShader("ecgl.forceAtlas2.updateEdgeAttraction"),blend:i,depthMask:!1,depthText:!1}),mode:_.Mesh.POINTS}),this._weightedSumMesh=new _.Mesh({geometry:new _.Geometry({attributes:{node:new _.Geometry.Attribute("node","float",2)},dynamic:!0,mainAttribute:"node"}),material:new _.Material({transparent:!0,shader:_.createShader("ecgl.forceAtlas2.calcWeightedSum"),blend:i,depthMask:!1,depthText:!1}),mode:_.Mesh.POINTS}),this._framebuffer=new Wt({depthBuffer:!1}),this._dummyCamera=new _.OrthographicCamera({left:-1,right:1,top:1,bottom:-1,near:0,far:100}),this._globalSpeed=0}G.prototype.updateOption=function(e){for(var t in Ze)this[t]=Ze[t];var i=this._nodes.length;if(i>5e4?this.jitterTolerence=10:i>5e3?this.jitterTolerence=1:this.jitterTolerence=.1,i>100?this.scaling=2:this.scaling=10,e)for(var t in Ze)e[t]!=null&&(this[t]=e[t]);if(this.repulsionByDegree)for(var r=this._positionSourceTex.pixels,a=0;a<this._nodes.length;a++)r[a*4+2]=(this._nodes[a].degree||0)+1};G.prototype._updateGravityCenter=function(e){var t=this._nodes,i=this._edges;if(this.gravityCenter)this._gravityCenter=this.gravityCenter;else{for(var r=[1/0,1/0],a=[-1/0,-1/0],o=0;o<t.length;o++)r[0]=Math.min(t[o].x,r[0]),r[1]=Math.min(t[o].y,r[1]),a[0]=Math.max(t[o].x,a[0]),a[1]=Math.max(t[o].y,a[1]);this._gravityCenter=[(r[0]+a[0])*.5,(r[1]+a[1])*.5]}for(var o=0;o<i.length;o++){var l=i[o].node1,s=i[o].node2;t[l].degree=(t[l].degree||0)+1,t[s].degree=(t[s].degree||0)+1}};G.prototype.initData=function(e,t){this._nodes=e,this._edges=t,this._updateGravityCenter();var i=Math.ceil(Math.sqrt(e.length)),r=i,a=new Float32Array(i*r*4);this._resize(i,r);for(var o=0,l=0;l<e.length;l++){var s=e[l];a[o++]=s.x||0,a[o++]=s.y||0,a[o++]=s.mass||1,a[o++]=s.size||1}this._positionSourceTex.pixels=a;var n=this._edgeForceMesh.geometry,u=t.length;n.attributes.node1.init(u*2),n.attributes.node2.init(u*2),n.attributes.weight.init(u*2);for(var c=[],l=0;l<t.length;l++){var h=n.attributes,d=t[l].weight;d==null&&(d=1),h.node1.set(l,this.getNodeUV(t[l].node1,c)),h.node2.set(l,this.getNodeUV(t[l].node2,c)),h.weight.set(l,d),h.node1.set(l+u,this.getNodeUV(t[l].node2,c)),h.node2.set(l+u,this.getNodeUV(t[l].node1,c)),h.weight.set(l+u,d)}var f=this._weightedSumMesh.geometry;f.attributes.node.init(e.length);for(var l=0;l<e.length;l++)f.attributes.node.set(l,this.getNodeUV(l,c));n.dirty(),f.dirty(),this._nodeRepulsionPass.material.define("fragment","NODE_COUNT",e.length),this._nodeRepulsionPass.material.setUniform("textureSize",[i,r]),this._inited=!1,this._frame=0};G.prototype.getNodes=function(){return this._nodes};G.prototype.getEdges=function(){return this._edges};G.prototype.step=function(e){this._inited||(this._initFromSource(e),this._inited=!0),this._frame++,this._framebuffer.attach(this._forceTex),this._framebuffer.bind(e);var t=this._nodeRepulsionPass;t.setUniform("strongGravityMode",this.strongGravityMode),t.setUniform("gravity",this.gravity),t.setUniform("gravityCenter",this._gravityCenter),t.setUniform("scaling",this.scaling),t.setUniform("preventOverlap",this.preventOverlap),t.setUniform("positionTex",this._positionPrevTex),t.render(e);var i=this._edgeForceMesh;i.material.set("linLogMode",this.linLogMode),i.material.set("edgeWeightInfluence",this.edgeWeightInfluence),i.material.set("preventOverlap",this.preventOverlap),i.material.set("positionTex",this._positionPrevTex),e.gl.enable(e.gl.BLEND),e.renderPass([i],this._dummyCamera),this._framebuffer.attach(this._weightedSumTex),e.gl.clearColor(0,0,0,0),e.gl.clear(e.gl.COLOR_BUFFER_BIT),e.gl.enable(e.gl.BLEND);var r=this._weightedSumMesh;r.material.set("positionTex",this._positionPrevTex),r.material.set("forceTex",this._forceTex),r.material.set("forcePrevTex",this._forcePrevTex),e.renderPass([r],this._dummyCamera),this._framebuffer.attach(this._globalSpeedTex);var a=this._globalSpeedPass;a.setUniform("globalSpeedPrevTex",this._globalSpeedPrevTex),a.setUniform("weightedSumTex",this._weightedSumTex),a.setUniform("jitterTolerence",this.jitterTolerence),e.gl.disable(e.gl.BLEND),a.render(e);var o=this._positionPass;this._framebuffer.attach(this._positionTex),o.setUniform("globalSpeedTex",this._globalSpeedTex),o.setUniform("positionTex",this._positionPrevTex),o.setUniform("forceTex",this._forceTex),o.setUniform("forcePrevTex",this._forcePrevTex),o.render(e),this._framebuffer.unbind(e),this._swapTexture()};G.prototype.update=function(e,t,i){t==null&&(t=1),t=Math.max(t,1);for(var r=0;r<t;r++)this.step(e);i&&i()};G.prototype.getNodePositionTexture=function(){return this._inited?this._positionPrevTex:this._positionSourceTex};G.prototype.getNodeUV=function(e,t){t=t||[];var i=this._positionTex.width,r=this._positionTex.height;return t[0]=e%i/(i-1),t[1]=Math.floor(e/i)/(r-1)||0,t};G.prototype.getNodePosition=function(e,t){var i=this._positionArr,r=this._positionTex.width,a=this._positionTex.height,o=r*a;(!i||i.length!==o*4)&&(i=this._positionArr=new Float32Array(o*4)),this._framebuffer.bind(e),this._framebuffer.attach(this._positionPrevTex),e.gl.readPixels(0,0,r,a,e.gl.RGBA,e.gl.FLOAT,i),this._framebuffer.unbind(e),t||(t=new Float32Array(this._nodes.length*2));for(var l=0;l<this._nodes.length;l++)t[l*2]=i[l*4],t[l*2+1]=i[l*4+1];return t};G.prototype.getTextureData=function(e,t){var i=this["_"+t+"Tex"],r=i.width,a=i.height;this._framebuffer.bind(e),this._framebuffer.attach(i);var o=new Float32Array(r*a*4);return e.gl.readPixels(0,0,r,a,e.gl.RGBA,e.gl.FLOAT,o),this._framebuffer.unbind(e),o};G.prototype.getTextureSize=function(){return{width:this._positionTex.width,height:this._positionTex.height}};G.prototype.isFinished=function(e){return this._frame>e};G.prototype._swapTexture=function(){var e=this._positionPrevTex;this._positionPrevTex=this._positionTex,this._positionTex=e;var e=this._forcePrevTex;this._forcePrevTex=this._forceTex,this._forceTex=e;var e=this._globalSpeedPrevTex;this._globalSpeedPrevTex=this._globalSpeedTex,this._globalSpeedTex=e};G.prototype._initFromSource=function(e){this._framebuffer.attach(this._positionPrevTex),this._framebuffer.bind(e),this._copyPass.setUniform("texture",this._positionSourceTex),this._copyPass.render(e),e.gl.clearColor(0,0,0,0),this._framebuffer.attach(this._forcePrevTex),e.gl.clear(e.gl.COLOR_BUFFER_BIT),this._framebuffer.attach(this._globalSpeedPrevTex),e.gl.clear(e.gl.COLOR_BUFFER_BIT),this._framebuffer.unbind(e)};G.prototype._resize=function(e,t){["_positionSourceTex","_positionTex","_positionPrevTex","_forceTex","_forcePrevTex"].forEach(function(i){this[i].width=e,this[i].height=t,this[i].dirty()},this)};G.prototype.dispose=function(e){this._framebuffer.dispose(e),this._copyPass.dispose(e),this._nodeRepulsionPass.dispose(e),this._positionPass.dispose(e),this._globalSpeedPass.dispose(e),this._edgeForceMesh.geometry.dispose(e),this._weightedSumMesh.geometry.dispose(e),this._positionSourceTex.dispose(e),this._positionTex.dispose(e),this._positionPrevTex.dispose(e),this._forceTex.dispose(e),this._forcePrevTex.dispose(e),this._weightedSumTex.dispose(e),this._globalSpeedTex.dispose(e),this._globalSpeedPrevTex.dispose(e)};function Lr(){var e={create:function(){return new Float32Array(2)},dist:function(n,u){var c=u[0]-n[0],h=u[1]-n[1];return Math.sqrt(c*c+h*h)},len:function(n){var u=n[0],c=n[1];return Math.sqrt(u*u+c*c)},scaleAndAdd:function(n,u,c,h){return n[0]=u[0]+c[0]*h,n[1]=u[1]+c[1]*h,n},scale:function(n,u,c){return n[0]=u[0]*c,n[1]=u[1]*c,n},add:function(n,u,c){return n[0]=u[0]+c[0],n[1]=u[1]+c[1],n},sub:function(n,u,c){return n[0]=u[0]-c[0],n[1]=u[1]-c[1],n},normalize:function(n,u){var c=u[0],h=u[1],d=c*c+h*h;return d>0&&(d=1/Math.sqrt(d),n[0]=u[0]*d,n[1]=u[1]*d),n},negate:function(n,u){return n[0]=-u[0],n[1]=-u[1],n},copy:function(n,u){return n[0]=u[0],n[1]=u[1],n},set:function(n,u,c){return n[0]=u,n[1]=c,n}};function t(){this.subRegions=[],this.nSubRegions=0,this.node=null,this.mass=0,this.centerOfMass=null,this.bbox=new Float32Array(4),this.size=0}var i=t.prototype;i.beforeUpdate=function(){for(var n=0;n<this.nSubRegions;n++)this.subRegions[n].beforeUpdate();this.mass=0,this.centerOfMass&&(this.centerOfMass[0]=0,this.centerOfMass[1]=0),this.nSubRegions=0,this.node=null},i.afterUpdate=function(){this.subRegions.length=this.nSubRegions;for(var n=0;n<this.nSubRegions;n++)this.subRegions[n].afterUpdate()},i.addNode=function(n){if(this.nSubRegions===0)if(this.node==null){this.node=n;return}else this._addNodeToSubRegion(this.node),this.node=null;this._addNodeToSubRegion(n),this._updateCenterOfMass(n)},i.findSubRegion=function(n,u){for(var c=0;c<this.nSubRegions;c++){var h=this.subRegions[c];if(h.contain(n,u))return h}},i.contain=function(n,u){return this.bbox[0]<=n&&this.bbox[2]>=n&&this.bbox[1]<=u&&this.bbox[3]>=u},i.setBBox=function(n,u,c,h){this.bbox[0]=n,this.bbox[1]=u,this.bbox[2]=c,this.bbox[3]=h,this.size=(c-n+h-u)/2},i._newSubRegion=function(){var n=this.subRegions[this.nSubRegions];return n||(n=new t,this.subRegions[this.nSubRegions]=n),this.nSubRegions++,n},i._addNodeToSubRegion=function(n){var u=this.findSubRegion(n.position[0],n.position[1]),c=this.bbox;if(!u){var h=(c[0]+c[2])/2,d=(c[1]+c[3])/2,f=(c[2]-c[0])/2,p=(c[3]-c[1])/2,g=n.position[0]>=h?1:0,y=n.position[1]>=d?1:0,u=this._newSubRegion();u.setBBox(g*f+c[0],y*p+c[1],(g+1)*f+c[0],(y+1)*p+c[1])}u.addNode(n)},i._updateCenterOfMass=function(n){this.centerOfMass==null&&(this.centerOfMass=new Float32Array(2));var u=this.centerOfMass[0]*this.mass,c=this.centerOfMass[1]*this.mass;u+=n.position[0]*n.mass,c+=n.position[1]*n.mass,this.mass+=n.mass,this.centerOfMass[0]=u/this.mass,this.centerOfMass[1]=c/this.mass};function r(){this.position=new Float32Array(2),this.force=e.create(),this.forcePrev=e.create(),this.mass=1,this.inDegree=0,this.outDegree=0}function a(n,u){this.source=n,this.target=u,this.weight=1}function o(){this.autoSettings=!0,this.barnesHutOptimize=!0,this.barnesHutTheta=1.5,this.repulsionByDegree=!0,this.linLogMode=!1,this.strongGravityMode=!1,this.gravity=1,this.scaling=1,this.edgeWeightInfluence=1,this.jitterTolerence=.1,this.preventOverlap=!1,this.dissuadeHubs=!1,this.rootRegion=new t,this.rootRegion.centerOfMass=e.create(),this.nodes=[],this.edges=[],this.bbox=new Float32Array(4),this.gravityCenter=null,this._massArr=null,this._swingingArr=null,this._sizeArr=null,this._globalSpeed=0}var l=o.prototype;l.initNodes=function(n,u,c){var h=u.length;this.nodes.length=0;for(var d=typeof c!="undefined",f=0;f<h;f++){var p=new r;p.position[0]=n[f*2],p.position[1]=n[f*2+1],p.mass=u[f],d&&(p.size=c[f]),this.nodes.push(p)}this._massArr=u,this._swingingArr=new Float32Array(h),d&&(this._sizeArr=c)},l.initEdges=function(n,u){var c=n.length/2;this.edges.length=0;for(var h=0;h<c;h++){var d=n[h*2],f=n[h*2+1],p=this.nodes[d],g=this.nodes[f];if(!p||!g){console.error("Node not exists, try initNodes before initEdges");return}p.outDegree++,g.inDegree++;var y=new a(p,g);u&&(y.weight=u[h]),this.edges.push(y)}},l.updateSettings=function(){if(this.repulsionByDegree)for(var n=0;n<this.nodes.length;n++){var u=this.nodes[n];u.mass=u.inDegree+u.outDegree+1}else for(var n=0;n<this.nodes.length;n++){var u=this.nodes[n];u.mass=this._massArr[n]}},l.update=function(){var n=this.nodes.length;if(this.updateSettings(),this.updateBBox(),this.barnesHutOptimize){this.rootRegion.setBBox(this.bbox[0],this.bbox[1],this.bbox[2],this.bbox[3]),this.rootRegion.beforeUpdate();for(var u=0;u<n;u++)this.rootRegion.addNode(this.nodes[u]);this.rootRegion.afterUpdate()}for(var u=0;u<n;u++){var c=this.nodes[u];e.copy(c.forcePrev,c.force),e.set(c.force,0,0)}for(var u=0;u<n;u++){var h=this.nodes[u];if(this.barnesHutOptimize)this.applyRegionToNodeRepulsion(this.rootRegion,h);else for(var d=u+1;d<n;d++){var f=this.nodes[d];this.applyNodeToNodeRepulsion(h,f,!1)}this.gravity>0&&(this.strongGravityMode?this.applyNodeStrongGravity(h):this.applyNodeGravity(h))}for(var u=0;u<this.edges.length;u++)this.applyEdgeAttraction(this.edges[u]);for(var p=0,g=0,y=e.create(),u=0;u<n;u++){var c=this.nodes[u],v=e.dist(c.force,c.forcePrev);p+=v*c.mass,e.add(y,c.force,c.forcePrev);var T=e.len(y)*.5;g+=T*c.mass,this._swingingArr[u]=v}var m=this.jitterTolerence*this.jitterTolerence*g/p;this._globalSpeed>0&&(m=Math.min(m/this._globalSpeed,1.5)*this._globalSpeed),this._globalSpeed=m;for(var u=0;u<n;u++){var c=this.nodes[u],v=this._swingingArr[u],x=.1*m/(1+m*Math.sqrt(v)),w=e.len(c.force);w>0&&(x=Math.min(w*x,10)/w,e.scaleAndAdd(c.position,c.position,c.force,x))}},l.applyRegionToNodeRepulsion=function(){var n=e.create();return function(c,h){if(c.node)this.applyNodeToNodeRepulsion(c.node,h,!0);else{e.sub(n,h.position,c.centerOfMass);var d=n[0]*n[0]+n[1]*n[1];if(d>this.barnesHutTheta*c.size*c.size){var f=this.scaling*h.mass*c.mass/d;e.scaleAndAdd(h.force,h.force,n,f)}else for(var p=0;p<c.nSubRegions;p++)this.applyRegionToNodeRepulsion(c.subRegions[p],h)}}}(),l.applyNodeToNodeRepulsion=function(){var n=e.create();return function(c,h,d){if(c!=h){e.sub(n,c.position,h.position);var f=n[0]*n[0]+n[1]*n[1];if(f!==0){var p;if(this.preventOverlap){var g=Math.sqrt(f);if(g=g-c.size-h.size,g>0)p=this.scaling*c.mass*h.mass/(g*g);else if(g<0)p=this.scaling*100*c.mass*h.mass;else return}else p=this.scaling*c.mass*h.mass/f;e.scaleAndAdd(c.force,c.force,n,p),e.scaleAndAdd(h.force,h.force,n,-p)}}}}(),l.applyEdgeAttraction=function(){var n=e.create();return function(c){var h=c.source,d=c.target;e.sub(n,h.position,d.position);var f=e.len(n),p;this.edgeWeightInfluence===0?p=1:this.edgeWeightInfluence===1?p=c.weight:p=Math.pow(c.weight,this.edgeWeightInfluence);var g;this.preventOverlap&&(f=f-h.size-d.size,f<=0)||(this.linLogMode?g=-p*Math.log(f+1)/(f+1):g=-p,e.scaleAndAdd(h.force,h.force,n,g),e.scaleAndAdd(d.force,d.force,n,-g))}}(),l.applyNodeGravity=function(){var n=e.create();return function(u){e.sub(n,this.gravityCenter,u.position);var c=e.len(n);e.scaleAndAdd(u.force,u.force,n,this.gravity*u.mass/(c+1))}}(),l.applyNodeStrongGravity=function(){var n=e.create();return function(u){e.sub(n,this.gravityCenter,u.position),e.scaleAndAdd(u.force,u.force,n,this.gravity*u.mass)}}(),l.updateBBox=function(){for(var n=1/0,u=1/0,c=-1/0,h=-1/0,d=0;d<this.nodes.length;d++){var f=this.nodes[d].position;n=Math.min(n,f[0]),u=Math.min(u,f[1]),c=Math.max(c,f[0]),h=Math.max(h,f[1])}this.bbox[0]=n,this.bbox[1]=u,this.bbox[2]=c,this.bbox[3]=h},l.getGlobalSpeed=function(){return this._globalSpeed};var s=null;self.onmessage=function(n){switch(n.data.cmd){case"init":s=new o,s.initNodes(n.data.nodesPosition,n.data.nodesMass,n.data.nodesSize),s.initEdges(n.data.edges,n.data.edgesWeight);break;case"updateConfig":if(s)for(var u in n.data.config)s[u]=n.data.config[u];break;case"update":var c=n.data.steps;if(s){for(var h=0;h<c;h++)s.update();for(var d=s.nodes.length,f=new Float32Array(d*2),h=0;h<d;h++){var p=s.nodes[h];f[h*2]=p.position[0],f[h*2+1]=p.position[1]}self.postMessage({buffer:f.buffer,globalSpeed:s.getGlobalSpeed()},[f.buffer])}else{var g=new Float32Array;self.postMessage({buffer:g.buffer,globalSpeed:s.getGlobalSpeed()},[g.buffer])}break}}}var Pe=Lr.toString();Pe=Pe.slice(Pe.indexOf("{")+1,Pe.lastIndexOf("}"));var Ce={barnesHutOptimize:!0,barnesHutTheta:1.5,repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,scaling:1,edgeWeightInfluence:1,jitterTolerence:.1,preventOverlap:!1,dissuadeHubs:!1,gravityCenter:null},j=function(e){for(var t in Ce)this[t]=Ce[t];if(e)for(var t in e)this[t]=e[t];this._nodes=[],this._edges=[],this._disposed=!1,this._positionTex=new K({type:fe.FLOAT,flipY:!1,minFilter:fe.NEAREST,magFilter:fe.NEAREST})};j.prototype.initData=function(e,t){var i=new Blob([Pe]),r=window.URL.createObjectURL(i);this._worker=new Worker(r),this._worker.onmessage=this._$onupdate.bind(this),this._nodes=e,this._edges=t,this._frame=0;for(var a=e.length,o=t.length,l=new Float32Array(a*2),s=new Float32Array(a),n=new Float32Array(a),u=new Float32Array(o*2),c=new Float32Array(o),h=0;h<e.length;h++){var d=e[h];l[h*2]=d.x,l[h*2+1]=d.y,s[h]=d.mass==null?1:d.mass,n[h]=d.size==null?1:d.size}for(var h=0;h<t.length;h++){var f=t[h],p=f.node1,g=f.node2;u[h*2]=p,u[h*2+1]=g,c[h]=f.weight==null?1:f.weight}var y=Math.ceil(Math.sqrt(e.length)),v=y,T=new Float32Array(y*v*4),m=this._positionTex;m.width=y,m.height=v,m.pixels=T,this._worker.postMessage({cmd:"init",nodesPosition:l,nodesMass:s,nodesSize:n,edges:u,edgesWeight:c}),this._globalSpeed=1/0};j.prototype.updateOption=function(e){var t={};for(var i in Ce)t[i]=Ce[i];var r=this._nodes,a=this._edges,o=r.length;if(o>5e4?t.jitterTolerence=10:o>5e3?t.jitterTolerence=1:t.jitterTolerence=.1,o>100?t.scaling=2:t.scaling=10,o>1e3?t.barnesHutOptimize=!0:t.barnesHutOptimize=!1,e)for(var i in Ce)e[i]!=null&&(t[i]=e[i]);if(!t.gravityCenter){for(var l=[1/0,1/0],s=[-1/0,-1/0],n=0;n<r.length;n++)l[0]=Math.min(r[n].x,l[0]),l[1]=Math.min(r[n].y,l[1]),s[0]=Math.max(r[n].x,s[0]),s[1]=Math.max(r[n].y,s[1]);t.gravityCenter=[(l[0]+s[0])*.5,(l[1]+s[1])*.5]}for(var n=0;n<a.length;n++){var u=a[n].node1,c=a[n].node2;r[u].degree=(r[u].degree||0)+1,r[c].degree=(r[c].degree||0)+1}this._worker&&this._worker.postMessage({cmd:"updateConfig",config:t})};j.prototype.update=function(e,t,i){t==null&&(t=1),t=Math.max(t,1),this._frame+=t,this._onupdate=i,this._worker&&this._worker.postMessage({cmd:"update",steps:Math.round(t)})};j.prototype._$onupdate=function(e){if(!this._disposed){var t=new Float32Array(e.data.buffer);this._globalSpeed=e.data.globalSpeed,this._positionArr=t,this._updateTexture(t),this._onupdate&&this._onupdate()}};j.prototype.getNodePositionTexture=function(){return this._positionTex};j.prototype.getNodeUV=function(e,t){t=t||[];var i=this._positionTex.width,r=this._positionTex.height;return t[0]=e%i/(i-1),t[1]=Math.floor(e/i)/(r-1),t};j.prototype.getNodes=function(){return this._nodes};j.prototype.getEdges=function(){return this._edges};j.prototype.isFinished=function(e){return this._frame>e};j.prototype.getNodePosition=function(e,t){if(t||(t=new Float32Array(this._nodes.length*2)),this._positionArr)for(var i=0;i<this._positionArr.length;i++)t[i]=this._positionArr[i];return t};j.prototype._updateTexture=function(e){for(var t=this._positionTex.pixels,i=0,r=0;r<e.length;)t[i++]=e[r++],t[i++]=e[r++],t[i++]=1,t[i++]=1;this._positionTex.dirty()};j.prototype.dispose=function(e){this._disposed=!0,this._worker=null};var Mr=Gi.extend(function(){return{zr:null,viewGL:null,minZoom:.2,maxZoom:5,_needsUpdate:!1,_dx:0,_dy:0,_zoom:1}},function(){this._mouseDownHandler=this._mouseDownHandler.bind(this),this._mouseWheelHandler=this._mouseWheelHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseUpHandler=this._mouseUpHandler.bind(this),this._update=this._update.bind(this)},{init:function(){var e=this.zr;e.on("mousedown",this._mouseDownHandler),e.on("mousewheel",this._mouseWheelHandler),e.on("globalout",this._mouseUpHandler),e.animation.on("frame",this._update)},setTarget:function(e){this._target=e},setZoom:function(e){this._zoom=Math.max(Math.min(e,this.maxZoom),this.minZoom),this._needsUpdate=!0},setOffset:function(e){this._dx=e[0],this._dy=e[1],this._needsUpdate=!0},getZoom:function(){return this._zoom},getOffset:function(){return[this._dx,this._dy]},_update:function(){if(this._target&&this._needsUpdate){var e=this._target,t=this._zoom;e.position.x=this._dx,e.position.y=this._dy,e.scale.set(t,t,t),this.zr.refresh(),this._needsUpdate=!1,this.trigger("update")}},_mouseDownHandler:function(e){if(!e.target){var t=e.offsetX,i=e.offsetY;if(!(this.viewGL&&!this.viewGL.containPoint(t,i))){this.zr.on("mousemove",this._mouseMoveHandler),this.zr.on("mouseup",this._mouseUpHandler);var r=this._convertPos(t,i);this._x=r.x,this._y=r.y}}},_convertPos:function(e,t){var i=this.viewGL.camera,r=this.viewGL.viewport;return{x:(e-r.x)/r.width*(i.right-i.left)+i.left,y:(t-r.y)/r.height*(i.bottom-i.top)+i.top}},_mouseMoveHandler:function(e){var t=this._convertPos(e.offsetX,e.offsetY);this._dx+=t.x-this._x,this._dy+=t.y-this._y,this._x=t.x,this._y=t.y,this._needsUpdate=!0},_mouseUpHandler:function(e){this.zr.off("mousemove",this._mouseMoveHandler),this.zr.off("mouseup",this._mouseUpHandler)},_mouseWheelHandler:function(e){e=e.event;var t=e.wheelDelta||-e.detail;if(t!==0){var i=e.offsetX,r=e.offsetY;if(!(this.viewGL&&!this.viewGL.containPoint(i,r))){var a=t>0?1.1:.9,o=Math.max(Math.min(this._zoom*a,this.maxZoom),this.minZoom);a=o/this._zoom;var l=this._convertPos(i,r),s=(l.x-this._dx)*(a-1),n=(l.y-this._dy)*(a-1);this._dx-=s,this._dy-=n,this._zoom=o,this._needsUpdate=!0}}},dispose:function(){var e=this.zr;e.off("mousedown",this._mouseDownHandler),e.off("mousemove",this._mouseMoveHandler),e.off("mouseup",this._mouseUpHandler),e.off("mousewheel",this._mouseWheelHandler),e.off("globalout",this._mouseUpHandler),e.animation.off("frame",this._update)}});const Pr=`@export ecgl.lines2D.vertex

uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;

attribute vec2 position: POSITION;
attribute vec4 a_Color : COLOR;
varying vec4 v_Color;

#ifdef POSITIONTEXTURE_ENABLED
uniform sampler2D positionTexture;
#endif

void main()
{
 gl_Position = worldViewProjection * vec4(position, -10.0, 1.0);

 v_Color = a_Color;
}

@end

@export ecgl.lines2D.fragment

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];

varying vec4 v_Color;

void main()
{
 gl_FragColor = color * v_Color;
}
@end


@export ecgl.meshLines2D.vertex

attribute vec2 position: POSITION;
attribute vec2 normal;
attribute float offset;
attribute vec4 a_Color : COLOR;

uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
uniform vec4 viewport : VIEWPORT;

varying vec4 v_Color;
varying float v_Miter;

void main()
{
 vec4 p2 = worldViewProjection * vec4(position + normal, -10.0, 1.0);
 gl_Position = worldViewProjection * vec4(position, -10.0, 1.0);

 p2.xy /= p2.w;
 gl_Position.xy /= gl_Position.w;

 vec2 N = normalize(p2.xy - gl_Position.xy);
 gl_Position.xy += N * offset / viewport.zw * 2.0;

 gl_Position.xy *= gl_Position.w;

 v_Color = a_Color;
}
@end


@export ecgl.meshLines2D.fragment

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];

varying vec4 v_Color;
varying float v_Miter;

void main()
{
 gl_FragColor = color * v_Color;
}

@end`;var Re=xe.vec2;_.Shader.import(Pr);var Cr=1;const Dr=ge.extend({type:"graphGL",__ecgl__:!0,init:function(e,t){this.groupGL=new _.Node,this.viewGL=new Ge("orthographic"),this.viewGL.camera.left=this.viewGL.camera.right=0,this.viewGL.add(this.groupGL),this._pointsBuilder=new Qe(!0,t),this._forceEdgesMesh=new _.Mesh({material:new _.Material({shader:_.createShader("ecgl.forceAtlas2.edges"),transparent:!0,depthMask:!1,depthTest:!1}),$ignorePicking:!0,geometry:new _.Geometry({attributes:{node:new _.Geometry.Attribute("node","float",2),color:new _.Geometry.Attribute("color","float",4,"COLOR")},dynamic:!0,mainAttribute:"node"}),renderOrder:-1,mode:_.Mesh.LINES}),this._edgesMesh=new _.Mesh({material:new _.Material({shader:_.createShader("ecgl.meshLines2D"),transparent:!0,depthMask:!1,depthTest:!1}),$ignorePicking:!0,geometry:new st({useNativeLine:!1,dynamic:!0}),renderOrder:-1,culling:!1}),this._layoutId=0,this._control=new Mr({zr:t.getZr(),viewGL:this.viewGL}),this._control.setTarget(this.groupGL),this._control.init(),this._clickHandler=this._clickHandler.bind(this)},render:function(e,t,i){this.groupGL.add(this._pointsBuilder.rootNode),this._model=e,this._api=i,this._initLayout(e,t,i),this._pointsBuilder.update(e,t,i),this._forceLayoutInstance instanceof G||this.groupGL.remove(this._forceEdgesMesh),this._updateCamera(e,i),this._control.off("update"),this._control.on("update",function(){i.dispatchAction({type:"graphGLRoam",seriesId:e.id,zoom:this._control.getZoom(),offset:this._control.getOffset()}),this._pointsBuilder.updateView(this.viewGL.camera)},this),this._control.setZoom($.firstNotNull(e.get("zoom"),1)),this._control.setOffset(e.get("offset")||[0,0]);var r=this._pointsBuilder.getPointsMesh();if(r.off("mousemove",this._mousemoveHandler),r.off("mouseout",this._mouseOutHandler,this),i.getZr().off("click",this._clickHandler),this._pointsBuilder.highlightOnMouseover=!0,e.get("focusNodeAdjacency")){var a=e.get("focusNodeAdjacencyOn");a==="click"?i.getZr().on("click",this._clickHandler):a==="mouseover"&&(r.on("mousemove",this._mousemoveHandler,this),r.on("mouseout",this._mouseOutHandler,this),this._pointsBuilder.highlightOnMouseover=!1)}this._lastMouseOverDataIndex=-1},_clickHandler:function(e){if(!this._layouting){var t=this._pointsBuilder.getPointsMesh().dataIndex;t>=0?this._api.dispatchAction({type:"graphGLFocusNodeAdjacency",seriesId:this._model.id,dataIndex:t}):this._api.dispatchAction({type:"graphGLUnfocusNodeAdjacency",seriesId:this._model.id})}},_mousemoveHandler:function(e){if(!this._layouting){var t=this._pointsBuilder.getPointsMesh().dataIndex;t>=0?t!==this._lastMouseOverDataIndex&&this._api.dispatchAction({type:"graphGLFocusNodeAdjacency",seriesId:this._model.id,dataIndex:t}):this._mouseOutHandler(e),this._lastMouseOverDataIndex=t}},_mouseOutHandler:function(e){this._layouting||(this._api.dispatchAction({type:"graphGLUnfocusNodeAdjacency",seriesId:this._model.id}),this._lastMouseOverDataIndex=-1)},_updateForceEdgesGeometry:function(e,t){var i=this._forceEdgesMesh.geometry,r=t.getEdgeData(),a=0,o=this._forceLayoutInstance,l=r.count()*2;i.attributes.node.init(l),i.attributes.color.init(l),r.each(function(s){var n=e[s];i.attributes.node.set(a,o.getNodeUV(n.node1)),i.attributes.node.set(a+1,o.getNodeUV(n.node2));var u=Ae(r,n.dataIndex),c=_.parseColor(u);c[3]*=$.firstNotNull(De(r,n.dataIndex),1),i.attributes.color.set(a,c),i.attributes.color.set(a+1,c),a+=2}),i.dirty()},_updateMeshLinesGeometry:function(){var t=this._model.getEdgeData(),e=this._edgesMesh.geometry,t=this._model.getEdgeData(),i=this._model.getData().getLayout("points");e.resetOffset(),e.setVertexCount(t.count()*e.getLineVertexCount()),e.setTriangleCount(t.count()*e.getLineTriangleCount());var r=[],a=[],o=["lineStyle","width"];this._originalEdgeColors=new Float32Array(t.count()*4),this._edgeIndicesMap=new Float32Array(t.count()),t.each(function(l){var s=t.graph.getEdgeByIndex(l),n=s.node1.dataIndex*2,u=s.node2.dataIndex*2;r[0]=i[n],r[1]=i[n+1],a[0]=i[u],a[1]=i[u+1];var c=Ae(t,s.dataIndex),h=_.parseColor(c);h[3]*=$.firstNotNull(De(t,s.dataIndex),1);var d=t.getItemModel(s.dataIndex),f=$.firstNotNull(d.get(o),1)*this._api.getDevicePixelRatio();e.addLine(r,a,h,f);for(var p=0;p<4;p++)this._originalEdgeColors[s.dataIndex*4+p]=h[p];this._edgeIndicesMap[s.dataIndex]=l},this),e.dirty()},_updateForceNodesGeometry:function(e){for(var t=this._pointsBuilder.getPointsMesh(),i=[],r=0;r<e.count();r++)this._forceLayoutInstance.getNodeUV(r,i),t.geometry.attributes.position.set(r,i);t.geometry.dirty("position")},_initLayout:function(e,t,i){var r=e.get("layout"),a=e.getGraph(),o=e.getBoxLayoutParams(),l=Ei(o,{width:i.getWidth(),height:i.getHeight()});r==="force"&&(r="forceAtlas2"),this.stopLayout(e,t,i,{beforeLayout:!0});var s=e.getData(),n=e.getData();if(r==="forceAtlas2"){var u=e.getModel("forceAtlas2"),c=this._forceLayoutInstance,h=[],d=[],f=s.getDataExtent("value"),p=n.getDataExtent("value"),g=$.firstNotNull(u.get("edgeWeight"),1),y=$.firstNotNull(u.get("nodeWeight"),1);typeof g=="number"&&(g=[g,g]),typeof y=="number"&&(y=[y,y]);var v=0,T={},m=new Float32Array(s.count()*2);if(a.eachNode(function(w){var S=w.dataIndex,M=s.get("value",S),P,C;if(s.hasItemOption){var D=s.getItemModel(S);P=D.get("x"),C=D.get("y")}P==null&&(P=l.x+Math.random()*l.width,C=l.y+Math.random()*l.height),m[v*2]=P,m[v*2+1]=C,T[w.id]=v++;var F=xt(M,f,y);isNaN(F)&&(isNaN(y[0])?F=1:F=y[0]),h.push({x:P,y:C,mass:F,size:s.getItemVisual(S,"symbolSize")})}),s.setLayout("points",m),a.eachEdge(function(w){var S=w.dataIndex,M=s.get("value",S),P=xt(M,p,g);isNaN(P)&&(isNaN(g[0])?P=1:P=g[0]),d.push({node1:T[w.node1.id],node2:T[w.node2.id],weight:P,dataIndex:S})}),!c){var x=u.get("GPU");this._forceLayoutInstance&&(x&&!(this._forceLayoutInstance instanceof G)||!x&&!(this._forceLayoutInstance instanceof j))&&(this._forceLayoutInstanceToDispose=this._forceLayoutInstance),c=this._forceLayoutInstance=x?new G:new j}c.initData(h,d),c.updateOption(u.option),this._updateForceEdgesGeometry(c.getEdges(),e),this._updatePositionTexture(),i.dispatchAction({type:"graphGLStartLayout",from:this.uid})}else{var m=new Float32Array(s.count()*2),v=0;a.eachNode(function(M){var P=M.dataIndex,C,D;if(s.hasItemOption){var F=s.getItemModel(P);C=F.get("x"),D=F.get("y")}m[v++]=C,m[v++]=D}),s.setLayout("points",m),this._updateAfterLayout(e,t,i)}},_updatePositionTexture:function(){var e=this._forceLayoutInstance.getNodePositionTexture();this._pointsBuilder.setPositionTexture(e),this._forceEdgesMesh.material.set("positionTex",e)},startLayout:function(e,t,o,r){if(!(r&&r.from!=null&&r.from!==this.uid)){var a=this.viewGL,o=this._api,l=this._forceLayoutInstance,s=this._model.getData(),n=this._model.getModel("forceAtlas2");if(l&&(this.groupGL.remove(this._edgesMesh),this.groupGL.add(this._forceEdgesMesh),!!this._forceLayoutInstance)){this._updateForceNodesGeometry(e.getData()),this._pointsBuilder.hideLabels();var u=this,c=this._layoutId=Cr++,h=n.getShallow("maxSteps"),d=n.getShallow("steps"),f=0,p=Math.max(d*2,20),g=function(y){if(y===u._layoutId){if(l.isFinished(h)){o.dispatchAction({type:"graphGLStopLayout",from:u.uid}),o.dispatchAction({type:"graphGLFinishLayout",points:s.getLayout("points"),from:u.uid});return}l.update(a.layer.renderer,d,function(){u._updatePositionTexture(),f+=d,f>=p&&(u._syncNodePosition(e),f=0),o.getZr().refresh(),yt(function(){g(y)})})}};yt(function(){u._forceLayoutInstanceToDispose&&(u._forceLayoutInstanceToDispose.dispose(a.layer.renderer),u._forceLayoutInstanceToDispose=null),g(c)}),this._layouting=!0}}},stopLayout:function(e,t,i,r){r&&r.from!=null&&r.from!==this.uid||(this._layoutId=0,this.groupGL.remove(this._forceEdgesMesh),this.groupGL.add(this._edgesMesh),this._forceLayoutInstance&&this.viewGL.layer&&(r&&r.beforeLayout||(this._syncNodePosition(e),this._updateAfterLayout(e,t,i)),this._api.getZr().refresh(),this._layouting=!1))},_syncNodePosition:function(e){var t=this._forceLayoutInstance.getNodePosition(this.viewGL.layer.renderer);e.getData().setLayout("points",t),e.setNodePosition(t)},_updateAfterLayout:function(e,t,i){this._updateMeshLinesGeometry(),this._pointsBuilder.removePositionTexture(),this._pointsBuilder.updateLayout(e,t,i),this._pointsBuilder.updateView(this.viewGL.camera),this._pointsBuilder.updateLabels(),this._pointsBuilder.showLabels()},focusNodeAdjacency:function(e,t,i,r){var a=this._model.getData();this._downplayAll();var o=r.dataIndex,l=a.graph,s=[],n=l.getNodeByIndex(o);s.push(n),n.edges.forEach(function(c){c.dataIndex<0||(c.node1!==n&&s.push(c.node1),c.node2!==n&&s.push(c.node2))},this),this._pointsBuilder.fadeOutAll(.05),this._fadeOutEdgesAll(.05),s.forEach(function(c){this._pointsBuilder.highlight(a,c.dataIndex)},this),this._pointsBuilder.updateLabels(s.map(function(c){return c.dataIndex}));var u=[];n.edges.forEach(function(c){c.dataIndex>=0&&(this._highlightEdge(c.dataIndex),u.push(c))},this),this._focusNodes=s,this._focusEdges=u},unfocusNodeAdjacency:function(e,t,i,r){this._downplayAll(),this._pointsBuilder.fadeInAll(),this._fadeInEdgesAll(),this._pointsBuilder.updateLabels()},_highlightEdge:function(e){var t=this._model.getEdgeData().getItemModel(e),i=_.parseColor(t.get("emphasis.lineStyle.color")||t.get("lineStyle.color")),r=$.firstNotNull(t.get("emphasis.lineStyle.opacity"),t.get("lineStyle.opacity"),1);i[3]*=r,this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[e],i)},_downplayAll:function(){this._focusNodes&&this._focusNodes.forEach(function(e){this._pointsBuilder.downplay(this._model.getData(),e.dataIndex)},this),this._focusEdges&&this._focusEdges.forEach(function(e){this._downplayEdge(e.dataIndex)},this)},_downplayEdge:function(e){var t=this._getColor(e,[]);this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[e],t)},_setEdgeFade:function(){var e=[];return function(t,i){this._getColor(t,e),e[3]*=i,this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[t],e)}}(),_getColor:function(e,t){for(var i=0;i<4;i++)t[i]=this._originalEdgeColors[e*4+i];return t},_fadeOutEdgesAll:function(e){var t=this._model.getData().graph;t.eachEdge(function(i){this._setEdgeFade(i.dataIndex,e)},this)},_fadeInEdgesAll:function(){this._fadeOutEdgesAll(1)},_updateCamera:function(e,t){this.viewGL.setViewport(0,0,t.getWidth(),t.getHeight(),t.getDevicePixelRatio());for(var i=this.viewGL.camera,r=e.getData(),a=r.getLayout("points"),o=Re.create(1/0,1/0),l=Re.create(-1/0,-1/0),s=[],n=0;n<a.length;)s[0]=a[n++],s[1]=a[n++],Re.min(o,o,s),Re.max(l,l,s);var u=(l[1]+o[1])/2,c=(l[0]+o[0])/2;if(!(c>i.left&&c<i.right&&u<i.bottom&&u>i.top)){var h=Math.max(l[0]-o[0],10),d=h/t.getWidth()*t.getHeight();h*=1.4,d*=1.4,o[0]-=h*.2,i.left=o[0],i.top=u-d/2,i.bottom=u+d/2,i.right=h+o[0],i.near=0,i.far=100}},dispose:function(){var e=this.viewGL.layer.renderer;this._forceLayoutInstance&&this._forceLayoutInstance.dispose(e),this.groupGL.removeAll(),this._layoutId=-1,this._pointsBuilder.dispose()},remove:function(){this.groupGL.removeAll(),this._control.dispose()}});function Fe(e){return e instanceof Array||(e=[e,e]),e}function Ar(e){e.registerChartView(Dr),e.registerSeriesModel(Me),e.registerVisual(function(i){const r={};i.eachSeriesByType("graphGL",function(a){var o=a.getCategoriesData(),l=a.getData(),s={};o.each(function(n){var u=o.getName(n);s["ec-"+u]=n;var c=o.getItemModel(n),h=c.getModel("itemStyle").getItemStyle();h.fill||(h.fill=a.getColorFromPalette(u,r)),o.setItemVisual(n,"style",h);var d=["symbol","symbolSize","symbolKeepAspect"];for(let p=0;p<d.length;p++){var f=c.getShallow(d[p],!0);f!=null&&o.setItemVisual(n,d[p],f)}}),o.count()&&l.each(function(n){var u=l.getItemModel(n);let c=u.getShallow("category");if(c!=null){typeof c=="string"&&(c=s["ec-"+c]);var h=o.getItemVisual(c,"style"),d=l.ensureUniqueItemVisual(n,"style");wt(d,h);var f=["symbol","symbolSize","symbolKeepAspect"];for(let p=0;p<f.length;p++)l.setItemVisual(n,f[p],o.getItemVisual(c,f[p]))}})})}),e.registerVisual(function(i){i.eachSeriesByType("graphGL",function(r){var a=r.getGraph(),o=r.getEdgeData(),l=Fe(r.get("edgeSymbol")),s=Fe(r.get("edgeSymbolSize"));o.setVisual("drawType","stroke"),o.setVisual("fromSymbol",l&&l[0]),o.setVisual("toSymbol",l&&l[1]),o.setVisual("fromSymbolSize",s&&s[0]),o.setVisual("toSymbolSize",s&&s[1]),o.setVisual("style",r.getModel("lineStyle").getLineStyle()),o.each(function(n){var u=o.getItemModel(n),c=a.getEdgeByIndex(n),h=Fe(u.getShallow("symbol",!0)),d=Fe(u.getShallow("symbolSize",!0)),f=u.getModel("lineStyle").getLineStyle(),p=o.ensureUniqueItemVisual(n,"style");switch(wt(p,f),p.stroke){case"source":{var g=c.node1.getVisual("style");p.stroke=g&&g.fill;break}case"target":{var g=c.node2.getVisual("style");p.stroke=g&&g.fill;break}}h[0]&&c.setVisual("fromSymbol",h[0]),h[1]&&c.setVisual("toSymbol",h[1]),d[0]&&c.setVisual("fromSymbolSize",d[0]),d[1]&&c.setVisual("toSymbolSize",d[1])})})}),e.registerAction({type:"graphGLRoam",event:"graphglroam",update:"series.graphGL:roam"},function(i,r){r.eachComponent({mainType:"series",query:i},function(a){a.setView(i)})});function t(){}e.registerAction({type:"graphGLStartLayout",event:"graphgllayoutstarted",update:"series.graphGL:startLayout"},t),e.registerAction({type:"graphGLStopLayout",event:"graphgllayoutstopped",update:"series.graphGL:stopLayout"},t),e.registerAction({type:"graphGLFocusNodeAdjacency",event:"graphGLFocusNodeAdjacency",update:"series.graphGL:focusNodeAdjacency"},t),e.registerAction({type:"graphGLUnfocusNodeAdjacency",event:"graphGLUnfocusNodeAdjacency",update:"series.graphGL:unfocusNodeAdjacency"},t)}const Ir=pe.extend({type:"series.flowGL",dependencies:["geo","grid","bmap"],visualStyleAccessPath:"itemStyle",getInitialData:function(e,t){var i=this.get("coordinateSystem"),r=i==="geo"?["lng","lat"]:Ni(i)||["x","y"];r.push("vx","vy");var a=it(this.getSource(),{coordDimensions:r,encodeDefine:this.get("encode"),dimensionsDefine:this.get("dimensions")}),o=new se(a,this);return o.initData(this.getSource()),o},defaultOption:{coordinateSystem:"cartesian2d",zlevel:10,supersampling:1,particleType:"point",particleDensity:128,particleSize:1,particleSpeed:1,particleTrail:2,colorTexture:null,gridWidth:"auto",gridHeight:"auto",itemStyle:{color:"#fff",opacity:.8}}});var Or=ne.extend(function(){return{dynamic:!0,attributes:{position:new ne.Attribute("position","float",3,"POSITION")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0},setLineCount:function(e){var t=this.attributes,i=4*e,r=2*e;this.vertexCount!==i&&t.position.init(i),this.triangleCount!==r&&(r===0?this.indices=null:this.indices=this.vertexCount>65535?new Uint32Array(r*3):new Uint16Array(r*3))},addLine:function(e){var t=this._vertexOffset;this.attributes.position.set(t,[e[0],e[1],1]),this.attributes.position.set(t+1,[e[0],e[1],-1]),this.attributes.position.set(t+2,[e[0],e[1],2]),this.attributes.position.set(t+3,[e[0],e[1],-2]),this.setTriangleIndices(this._faceOffset++,[t,t+1,t+2]),this.setTriangleIndices(this._faceOffset++,[t+1,t+2,t+3]),this._vertexOffset+=4}});const Gr=`@export ecgl.vfParticle.particle.fragment

uniform sampler2D particleTexture;
uniform sampler2D spawnTexture;
uniform sampler2D velocityTexture;

uniform float deltaTime;
uniform float elapsedTime;

uniform float speedScaling : 1.0;

uniform vec2 textureSize;
uniform vec4 region : [0, 0, 1, 1];
uniform float firstFrameTime;

varying vec2 v_Texcoord;


void main()
{
 vec4 p = texture2D(particleTexture, v_Texcoord);
 bool spawn = false;
 if (p.w <= 0.0) {
 p = texture2D(spawnTexture, fract(v_Texcoord + elapsedTime / 10.0));
 p.w -= firstFrameTime;
 spawn = true;
 }
 vec2 v = texture2D(velocityTexture, fract(p.xy * region.zw + region.xy)).xy;
 v = (v - 0.5) * 2.0;
 p.z = length(v);
 p.xy += v * deltaTime / 10.0 * speedScaling;
 p.w -= deltaTime;

 if (spawn || p.xy != fract(p.xy)) {
 p.z = 0.0;
 }
 p.xy = fract(p.xy);

 gl_FragColor = p;
}
@end

@export ecgl.vfParticle.renderPoints.vertex

#define PI 3.1415926

attribute vec2 texcoord : TEXCOORD_0;

uniform sampler2D particleTexture;
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;

uniform float size : 1.0;

varying float v_Mag;
varying vec2 v_Uv;

void main()
{
 vec4 p = texture2D(particleTexture, texcoord);

 if (p.w > 0.0 && p.z > 1e-5) {
 gl_Position = worldViewProjection * vec4(p.xy * 2.0 - 1.0, 0.0, 1.0);
 }
 else {
 gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);
 }

 v_Mag = p.z;
 v_Uv = p.xy;

 gl_PointSize = size;
}

@end

@export ecgl.vfParticle.renderPoints.fragment

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];
uniform sampler2D gradientTexture;
uniform sampler2D colorTexture;
uniform sampler2D spriteTexture;

varying float v_Mag;
varying vec2 v_Uv;

void main()
{
 gl_FragColor = color;
#ifdef SPRITETEXTURE_ENABLED
 gl_FragColor *= texture2D(spriteTexture, gl_PointCoord);
 if (color.a == 0.0) {
 discard;
 }
#endif
#ifdef GRADIENTTEXTURE_ENABLED
 gl_FragColor *= texture2D(gradientTexture, vec2(v_Mag, 0.5));
#endif
#ifdef COLORTEXTURE_ENABLED
 gl_FragColor *= texture2D(colorTexture, v_Uv);
#endif
}

@end

@export ecgl.vfParticle.renderLines.vertex

#define PI 3.1415926

attribute vec3 position : POSITION;

uniform sampler2D particleTexture;
uniform sampler2D prevParticleTexture;

uniform float size : 1.0;
uniform vec4 vp: VIEWPORT;
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;

varying float v_Mag;
varying vec2 v_Uv;

@import clay.util.rand

void main()
{
 vec4 p = texture2D(particleTexture, position.xy);
 vec4 p2 = texture2D(prevParticleTexture, position.xy);

 p.xy = p.xy * 2.0 - 1.0;
 p2.xy = p2.xy * 2.0 - 1.0;

 if (p.w > 0.0 && p.z > 1e-5) {
 vec2 dir = normalize(p.xy - p2.xy);
 vec2 norm = vec2(dir.y / vp.z, -dir.x / vp.w) * sign(position.z) * size;
 if (abs(position.z) == 2.0) {
 gl_Position = vec4(p.xy + norm, 0.0, 1.0);
 v_Uv = p.xy;
 v_Mag = p.z;
 }
 else {
 gl_Position = vec4(p2.xy + norm, 0.0, 1.0);
 v_Mag = p2.z;
 v_Uv = p2.xy;
 }
 gl_Position = worldViewProjection * gl_Position;
 }
 else {
 gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);
 }
}

@end

@export ecgl.vfParticle.renderLines.fragment

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];
uniform sampler2D gradientTexture;
uniform sampler2D colorTexture;

varying float v_Mag;
varying vec2 v_Uv;

void main()
{
 gl_FragColor = color;
 #ifdef GRADIENTTEXTURE_ENABLED
 gl_FragColor *= texture2D(gradientTexture, vec2(v_Mag, 0.5));
#endif
#ifdef COLORTEXTURE_ENABLED
 gl_FragColor *= texture2D(colorTexture, v_Uv);
#endif
}

@end
`;q.import(Gr);function Er(e){var t=document.createElement("canvas");t.width=t.height=e;var i=t.getContext("2d");return i.fillStyle="#fff",i.arc(e/2,e/2,e/2,0,Math.PI*2),i.fill(),t}var Ke=function(){this.motionBlurFactor=.99,this.vectorFieldTexture=new K({type:fe.FLOAT,flipY:!1}),this.particleLife=[5,20],this._particleType="point",this._particleSize=1,this.particleColor=[1,1,1,1],this.particleSpeedScaling=1,this._thisFrameTexture=null,this._particlePass=null,this._spawnTexture=null,this._particleTexture0=null,this._particleTexture1=null,this._particlePointsMesh=null,this._surfaceFrameBuffer=null,this._elapsedTime=0,this._scene=null,this._camera=null,this._lastFrameTexture=null,this._supersampling=1,this._downsampleTextures=[],this._width=512,this._height=512,this.init()};Ke.prototype={constructor:Ke,init:function(){var e={type:fe.FLOAT,minFilter:fe.NEAREST,magFilter:fe.NEAREST,useMipmap:!1};this._spawnTexture=new K(e),this._particleTexture0=new K(e),this._particleTexture1=new K(e),this._frameBuffer=new Wt({depthBuffer:!1}),this._particlePass=new me({fragment:q.source("ecgl.vfParticle.particle.fragment")}),this._particlePass.setUniform("velocityTexture",this.vectorFieldTexture),this._particlePass.setUniform("spawnTexture",this._spawnTexture),this._downsamplePass=new me({fragment:q.source("clay.compositor.downsample")});var t=new Ne({renderOrder:10,material:new $e({shader:new q(q.source("ecgl.vfParticle.renderPoints.vertex"),q.source("ecgl.vfParticle.renderPoints.fragment"))}),mode:Ne.POINTS,geometry:new ne({dynamic:!0,mainAttribute:"texcoord0"})}),i=new Ne({renderOrder:10,material:new $e({shader:new q(q.source("ecgl.vfParticle.renderLines.vertex"),q.source("ecgl.vfParticle.renderLines.fragment"))}),geometry:new Or,culling:!1}),r=new Ne({material:new $e({shader:new q(q.source("ecgl.color.vertex"),q.source("ecgl.color.fragment"))}),geometry:new zi});r.material.enableTexture("diffuseMap"),this._particlePointsMesh=t,this._particleLinesMesh=i,this._lastFrameFullQuadMesh=r,this._camera=new Ri,this._thisFrameTexture=new K,this._lastFrameTexture=new K},setParticleDensity:function(e,t){for(var i=e*t,r=new Float32Array(i*4),a=0,o=this.particleLife,l=0;l<e;l++)for(var s=0;s<t;s++,a++){r[a*4]=Math.random(),r[a*4+1]=Math.random(),r[a*4+2]=Math.random();var n=(o[1]-o[0])*Math.random()+o[0];r[a*4+3]=n}this._particleType==="line"?this._setLineGeometry(e,t):this._setPointsGeometry(e,t),this._spawnTexture.width=e,this._spawnTexture.height=t,this._spawnTexture.pixels=r,this._particleTexture0.width=this._particleTexture1.width=e,this._particleTexture0.height=this._particleTexture1.height=t,this._particlePass.setUniform("textureSize",[e,t])},_setPointsGeometry:function(e,t){var i=e*t,r=this._particlePointsMesh.geometry,a=r.attributes;a.texcoord0.init(i);for(var o=0,l=0;l<e;l++)for(var s=0;s<t;s++,o++)a.texcoord0.value[o*2]=l/e,a.texcoord0.value[o*2+1]=s/t;r.dirty()},_setLineGeometry:function(e,t){var i=e*t,r=this._getParticleMesh().geometry;r.setLineCount(i),r.resetOffset();for(var a=0;a<e;a++)for(var o=0;o<t;o++)r.addLine([a/e,o/t]);r.dirty()},_getParticleMesh:function(){return this._particleType==="line"?this._particleLinesMesh:this._particlePointsMesh},update:function(e,t,i,r){var a=this._getParticleMesh(),o=this._frameBuffer,l=this._particlePass;r&&this._updateDownsampleTextures(e,t),a.material.set("size",this._particleSize*this._supersampling),a.material.set("color",this.particleColor),l.setUniform("speedScaling",this.particleSpeedScaling),o.attach(this._particleTexture1),l.setUniform("firstFrameTime",r?(this.particleLife[1]+this.particleLife[0])/2:0),l.setUniform("particleTexture",this._particleTexture0),l.setUniform("deltaTime",i),l.setUniform("elapsedTime",this._elapsedTime),l.render(e,o),a.material.set("particleTexture",this._particleTexture1),a.material.set("prevParticleTexture",this._particleTexture0),o.attach(this._thisFrameTexture),o.bind(e),e.gl.clear(e.gl.DEPTH_BUFFER_BIT|e.gl.COLOR_BUFFER_BIT);var s=this._lastFrameFullQuadMesh;s.material.set("diffuseMap",this._lastFrameTexture),s.material.set("color",[1,1,1,this.motionBlurFactor]),this._camera.update(!0),e.renderPass([s,a],this._camera),o.unbind(e),this._downsample(e),this._swapTexture(),this._elapsedTime+=i},_downsample:function(e){var t=this._downsampleTextures;if(t.length!==0)for(var i=0,r=this._thisFrameTexture,a=t[i];a;)this._frameBuffer.attach(a),this._downsamplePass.setUniform("texture",r),this._downsamplePass.setUniform("textureSize",[r.width,r.height]),this._downsamplePass.render(e,this._frameBuffer),r=a,a=t[++i]},getSurfaceTexture:function(){var e=this._downsampleTextures;return e.length>0?e[e.length-1]:this._lastFrameTexture},setRegion:function(e){this._particlePass.setUniform("region",e)},resize:function(e,t){this._lastFrameTexture.width=e*this._supersampling,this._lastFrameTexture.height=t*this._supersampling,this._thisFrameTexture.width=e*this._supersampling,this._thisFrameTexture.height=t*this._supersampling,this._width=e,this._height=t},setParticleSize:function(e){var t=this._getParticleMesh();if(e<=2){t.material.disableTexture("spriteTexture"),t.material.transparent=!1;return}this._spriteTexture||(this._spriteTexture=new K),(!this._spriteTexture.image||this._spriteTexture.image.width!==e)&&(this._spriteTexture.image=Er(e),this._spriteTexture.dirty()),t.material.transparent=!0,t.material.enableTexture("spriteTexture"),t.material.set("spriteTexture",this._spriteTexture),this._particleSize=e},setGradientTexture:function(e){var t=this._getParticleMesh().material;t[e?"enableTexture":"disableTexture"]("gradientTexture"),t.setUniform("gradientTexture",e)},setColorTextureImage:function(e,t){var i=this._getParticleMesh().material;i.setTextureImage("colorTexture",e,t,{flipY:!0})},setParticleType:function(e){this._particleType=e},clearFrame:function(e){var t=this._frameBuffer;t.attach(this._lastFrameTexture),t.bind(e),e.gl.clear(e.gl.DEPTH_BUFFER_BIT|e.gl.COLOR_BUFFER_BIT),t.unbind(e)},setSupersampling:function(e){this._supersampling=e,this.resize(this._width,this._height)},_updateDownsampleTextures:function(e,t){for(var i=this._downsampleTextures,r=Math.max(Math.floor(Math.log(this._supersampling/t.getDevicePixelRatio())/Math.log(2)),0),a=2,o=this._width*this._supersampling,l=this._height*this._supersampling,s=0;s<r;s++)i[s]=i[s]||new K,i[s].width=o/a,i[s].height=l/a,a*=2;for(;s<i.length;s++)i[s].dispose(e);i.length=r},_swapTexture:function(){var e=this._particleTexture0;this._particleTexture0=this._particleTexture1,this._particleTexture1=e;var e=this._thisFrameTexture;this._thisFrameTexture=this._lastFrameTexture,this._lastFrameTexture=e},dispose:function(e){e.disposeFrameBuffer(this._frameBuffer),e.disposeTexture(this.vectorFieldTexture),e.disposeTexture(this._spawnTexture),e.disposeTexture(this._particleTexture0),e.disposeTexture(this._particleTexture1),e.disposeTexture(this._thisFrameTexture),e.disposeTexture(this._lastFrameTexture),e.disposeGeometry(this._particleLinesMesh.geometry),e.disposeGeometry(this._particlePointsMesh.geometry),e.disposeGeometry(this._lastFrameFullQuadMesh.geometry),this._spriteTexture&&e.disposeTexture(this._spriteTexture),this._particlePass.dispose(e),this._downsamplePass.dispose(e),this._downsampleTextures.forEach(function(t){t.dispose(e)})}};const Nr=ge.extend({type:"flowGL",__ecgl__:!0,init:function(e,t){this.viewGL=new Ge("orthographic"),this.groupGL=new _.Node,this.viewGL.add(this.groupGL),this._particleSurface=new Ke;var i=new _.Mesh({geometry:new _.PlaneGeometry,material:new _.Material({shader:new _.Shader({vertex:_.Shader.source("ecgl.color.vertex"),fragment:_.Shader.source("ecgl.color.fragment")}),transparent:!0})});i.material.enableTexture("diffuseMap"),this.groupGL.add(i),this._planeMesh=i},render:function(e,t,i){var r=this._particleSurface;r.setParticleType(e.get("particleType")),r.setSupersampling(e.get("supersampling")),this._updateData(e,i),this._updateCamera(i.getWidth(),i.getHeight(),i.getDevicePixelRatio());var a=$.firstNotNull(e.get("particleDensity"),128);r.setParticleDensity(a,a);var o=this._planeMesh,l=+new Date,s=this,n=!0;o.__percent=0,o.stopAnimation(),o.animate("",{loop:!0}).when(1e5,{__percent:1}).during(function(){var h=+new Date,d=Math.min(h-l,20);l=l+d,s._renderer&&(r.update(s._renderer,i,d/1e3,n),o.material.set("diffuseMap",r.getSurfaceTexture())),n=!1}).start();var u=e.getModel("itemStyle"),c=_.parseColor(u.get("color"));c[3]*=$.firstNotNull(u.get("opacity"),1),o.material.set("color",c),r.setColorTextureImage(e.get("colorTexture"),i),r.setParticleSize(e.get("particleSize")),r.particleSpeedScaling=e.get("particleSpeed"),r.motionBlurFactor=1-Math.pow(.1,e.get("particleTrail"))},updateTransform:function(e,t,i){this._updateData(e,i)},afterRender:function(e,t,i,r){var a=r.renderer;this._renderer=a},_updateData:function(e,t){var i=e.coordinateSystem,r=i.dimensions.map(function(T){return e.coordDimToDataDim(T)[0]}),a=e.getData(),o=a.getDataExtent(r[0]),l=a.getDataExtent(r[1]),s=e.get("gridWidth"),n=e.get("gridHeight");if(s==null||s==="auto"){var u=(o[1]-o[0])/(l[1]-l[0]);s=Math.round(Math.sqrt(u*a.count()))}(n==null||n==="auto")&&(n=Math.ceil(a.count()/s));var c=this._particleSurface.vectorFieldTexture,h=c.pixels;if(!h||h.length!==n*s*4)h=c.pixels=new Float32Array(s*n*4);else for(var d=0;d<h.length;d++)h[d]=0;var f=0,p=1/0,g=new Float32Array(a.count()*2),y=0,v=[[1/0,1/0],[-1/0,-1/0]];a.each([r[0],r[1],"vx","vy"],function(T,m,x,w){var S=i.dataToPoint([T,m]);g[y++]=S[0],g[y++]=S[1],v[0][0]=Math.min(S[0],v[0][0]),v[0][1]=Math.min(S[1],v[0][1]),v[1][0]=Math.max(S[0],v[1][0]),v[1][1]=Math.max(S[1],v[1][1]);var M=Math.sqrt(x*x+w*w);f=Math.max(f,M),p=Math.min(p,M)}),a.each(["vx","vy"],function(T,m,x){var w=Math.round((g[x*2]-v[0][0])/(v[1][0]-v[0][0])*(s-1)),S=n-1-Math.round((g[x*2+1]-v[0][1])/(v[1][1]-v[0][1])*(n-1)),M=(S*s+w)*4;h[M]=T/f*.5+.5,h[M+1]=m/f*.5+.5,h[M+3]=1}),c.width=s,c.height=n,e.get("coordinateSystem")==="bmap"&&this._fillEmptyPixels(c),c.dirty(),this._updatePlanePosition(v[0],v[1],e,t),this._updateGradientTexture(a.getVisual("visualMeta"),[p,f])},_fillEmptyPixels:function(e){var t=e.pixels,i=e.width,r=e.height;function a(g,y,v){g=Math.max(Math.min(g,i-1),0),y=Math.max(Math.min(y,r-1),0);var T=(y*(i-1)+g)*4;return t[T+3]===0?!1:(v[0]=t[T],v[1]=t[T+1],!0)}function o(g,y,v){v[0]=g[0]+y[0],v[1]=g[1]+y[1]}for(var l=[],s=[],n=[],u=[],c=[],h=0,d=0;d<r;d++)for(var f=0;f<i;f++){var p=(d*(i-1)+f)*4;t[p+3]===0&&(h=l[0]=l[1]=0,a(f-1,d,s)&&(h++,o(s,l,l)),a(f+1,d,n)&&(h++,o(n,l,l)),a(f,d-1,u)&&(h++,o(u,l,l)),a(f,d+1,c)&&(h++,o(c,l,l)),l[0]/=h,l[1]/=h,t[p]=l[0],t[p+1]=l[1]),t[p+3]=1}},_updateGradientTexture:function(e,t){if(!e||!e.length){this._particleSurface.setGradientTexture(null);return}this._gradientTexture=this._gradientTexture||new _.Texture2D({image:document.createElement("canvas")});var i=this._gradientTexture,r=i.image;r.width=200,r.height=1;var a=r.getContext("2d"),o=a.createLinearGradient(0,.5,r.width,.5);e[0].stops.forEach(function(l){var s;t[1]===t[0]?s=0:(s=l.value/t[1],s=Math.min(Math.max(s,0),1)),o.addColorStop(s,l.color)}),a.fillStyle=o,a.fillRect(0,0,r.width,r.height),i.dirty(),this._particleSurface.setGradientTexture(this._gradientTexture)},_updatePlanePosition:function(e,t,i,r){var a=this._limitInViewportAndFullFill(e,t,i,r);e=a.leftTop,t=a.rightBottom,this._particleSurface.setRegion(a.region),this._planeMesh.position.set((e[0]+t[0])/2,r.getHeight()-(e[1]+t[1])/2,0);var o=t[0]-e[0],l=t[1]-e[1];this._planeMesh.scale.set(o/2,l/2,1),this._particleSurface.resize(Math.max(Math.min(o,2048),1),Math.max(Math.min(l,2048),1)),this._renderer&&this._particleSurface.clearFrame(this._renderer)},_limitInViewportAndFullFill:function(e,t,i,r){var a=[Math.max(e[0],0),Math.max(e[1],0)],o=[Math.min(t[0],r.getWidth()),Math.min(t[1],r.getHeight())];if(i.get("coordinateSystem")==="bmap"){var l=i.getData().getDataExtent(i.coordDimToDataDim("lng")[0]),s=Math.floor(l[1]-l[0])>=359;s&&(a[0]>0&&(a[0]=0),o[0]<r.getWidth()&&(o[0]=r.getWidth()))}var n=t[0]-e[0],u=t[1]-e[1],c=o[0]-a[0],h=o[1]-a[1],d=[(a[0]-e[0])/n,1-h/u-(a[1]-e[1])/u,c/n,h/u];return{leftTop:a,rightBottom:o,region:d}},_updateCamera:function(e,t,i){this.viewGL.setViewport(0,0,e,t,i);var r=this.viewGL.camera;r.left=r.bottom=0,r.top=t,r.right=e,r.near=0,r.far=100,r.position.z=10},remove:function(){this._planeMesh.stopAnimation(),this.groupGL.removeAll()},dispose:function(){this._renderer&&this._particleSurface.dispose(this._renderer),this.groupGL.removeAll()}});function zr(e){e.registerChartView(Nr),e.registerSeriesModel(Ir)}var et=pe.extend({type:"series.linesGL",dependencies:["grid","geo"],visualStyleAccessPath:"lineStyle",visualDrawType:"stroke",streamEnabled:!0,init:function(e){var t=this._processFlatCoordsArray(e.data);this._flatCoords=t.flatCoords,this._flatCoordsOffset=t.flatCoordsOffset,t.flatCoords&&(e.data=new Float32Array(t.count)),et.superApply(this,"init",arguments)},mergeOption:function(e){var t=this._processFlatCoordsArray(e.data);this._flatCoords=t.flatCoords,this._flatCoordsOffset=t.flatCoordsOffset,t.flatCoords&&(e.data=new Float32Array(t.count)),et.superApply(this,"mergeOption",arguments)},appendData:function(e){var t=this._processFlatCoordsArray(e.data);t.flatCoords&&(this._flatCoords?(this._flatCoords=bt(this._flatCoords,t.flatCoords),this._flatCoordsOffset=bt(this._flatCoordsOffset,t.flatCoordsOffset)):(this._flatCoords=t.flatCoords,this._flatCoordsOffset=t.flatCoordsOffset),e.data=new Float32Array(t.count)),this.getRawData().appendData(e.data)},_getCoordsFromItemModel:function(e){var t=this.getData().getItemModel(e),i=t.option instanceof Array?t.option:t.getShallow("coords");return i},getLineCoordsCount:function(e){return this._flatCoordsOffset?this._flatCoordsOffset[e*2+1]:this._getCoordsFromItemModel(e).length},getLineCoords:function(e,t){if(this._flatCoordsOffset){for(var i=this._flatCoordsOffset[e*2],r=this._flatCoordsOffset[e*2+1],a=0;a<r;a++)t[a]=t[a]||[],t[a][0]=this._flatCoords[i+a*2],t[a][1]=this._flatCoords[i+a*2+1];return r}else{for(var o=this._getCoordsFromItemModel(e),a=0;a<o.length;a++)t[a]=t[a]||[],t[a][0]=o[a][0],t[a][1]=o[a][1];return o.length}},_processFlatCoordsArray:function(e){var t=0;if(this._flatCoords&&(t=this._flatCoords.length),typeof e[0]=="number"){for(var i=e.length,r=new Uint32Array(i),a=new Float64Array(i),o=0,l=0,s=0,n=0;n<i;){s++;var u=e[n++];r[l++]=o+t,r[l++]=u;for(var c=0;c<u;c++){var h=e[n++],d=e[n++];a[o++]=h,a[o++]=d}}return{flatCoordsOffset:new Uint32Array(r.buffer,0,l),flatCoords:a,count:s}}return{flatCoordsOffset:null,flatCoords:null,count:e.length}},getInitialData:function(e,t){var i=new se(["value"],this);return i.hasItemOption=!1,i.initData(e.data,[],function(r,a,o,l){if(r instanceof Array)return NaN;i.hasItemOption=!0;var s=r.value;if(s!=null)return s instanceof Array?s[l]:s}),i},defaultOption:{coordinateSystem:"geo",zlevel:10,progressive:1e4,progressiveThreshold:5e4,blendMode:"source-over",lineStyle:{opacity:.8},postEffect:{enable:!1,colorCorrection:{exposure:0,brightness:0,contrast:1,saturation:1,enable:!0}}}});const Rr=ge.extend({type:"linesGL",__ecgl__:!0,init:function(e,t){this.groupGL=new _.Node,this.viewGL=new Ge("orthographic"),this.viewGL.add(this.groupGL),this._glViewHelper=new te(this.viewGL),this._nativeLinesShader=_.createShader("ecgl.lines3D"),this._meshLinesShader=_.createShader("ecgl.meshLines3D"),this._linesMeshes=[],this._currentStep=0},render:function(e,t,i){this.groupGL.removeAll(),this._glViewHelper.reset(e,i);var r=this._linesMeshes[0];r||(r=this._linesMeshes[0]=this._createLinesMesh(e)),this._linesMeshes.length=1,this.groupGL.add(r),this._updateLinesMesh(e,r,0,e.getData().count()),this.viewGL.setPostEffect(e.getModel("postEffect"),i)},incrementalPrepareRender:function(e,t,i){this.groupGL.removeAll(),this._glViewHelper.reset(e,i),this._currentStep=0,this.viewGL.setPostEffect(e.getModel("postEffect"),i)},incrementalRender:function(e,t,i,r){var a=this._linesMeshes[this._currentStep];a||(a=this._createLinesMesh(t),this._linesMeshes[this._currentStep]=a),this._updateLinesMesh(t,a,e.start,e.end),this.groupGL.add(a),r.getZr().refresh(),this._currentStep++},updateTransform:function(e,t,i){e.coordinateSystem.getRoamTransform&&this._glViewHelper.updateTransform(e,i)},_createLinesMesh:function(e){var t=new _.Mesh({$ignorePicking:!0,material:new _.Material({shader:_.createShader("ecgl.lines3D"),transparent:!0,depthMask:!1,depthTest:!1}),geometry:new st({segmentScale:10,useNativeLine:!0,dynamic:!1}),mode:_.Mesh.LINES,culling:!1});return t},_updateLinesMesh:function(e,t,i,r){var a=e.getData();t.material.blend=e.get("blendMode")==="lighter"?_.additiveBlend:null;var o=e.get("lineStyle.curveness")||0,l=e.get("polyline"),s=t.geometry,n=e.coordinateSystem,u=$.firstNotNull(e.get("lineStyle.width"),1);u>1?(t.material.shader!==this._meshLinesShader&&t.material.attachShader(this._meshLinesShader),t.mode=_.Mesh.TRIANGLES):(t.material.shader!==this._nativeLinesShader&&t.material.attachShader(this._nativeLinesShader),t.mode=_.Mesh.LINES),i=i||0,r=r||a.count(),s.resetOffset();var c=0,h=0,d=[],f=[],p=[],g=[],y=[],v=.3,T=.7;function m(){f[0]=d[0]*T+g[0]*v-(d[1]-g[1])*o,f[1]=d[1]*T+g[1]*v-(g[0]-d[0])*o,p[0]=d[0]*v+g[0]*T-(d[1]-g[1])*o,p[1]=d[1]*v+g[1]*T-(g[0]-d[0])*o}if(l||o!==0)for(var x=i;x<r;x++)if(l){var w=e.getLineCoordsCount(x);c+=s.getPolylineVertexCount(w),h+=s.getPolylineTriangleCount(w)}else e.getLineCoords(x,y),this._glViewHelper.dataToPoint(n,y[0],d),this._glViewHelper.dataToPoint(n,y[1],g),m(),c+=s.getCubicCurveVertexCount(d,f,p,g),h+=s.getCubicCurveTriangleCount(d,f,p,g);else{var S=r-i;c+=S*s.getLineVertexCount(),h+=S*s.getLineVertexCount()}s.setVertexCount(c),s.setTriangleCount(h);for(var M=i,P=[],x=i;x<r;x++){_.parseColor(Ae(a,M),P);var C=$.firstNotNull(De(a,M),1);P[3]*=C;for(var w=e.getLineCoords(x,y),D=0;D<w;D++)this._glViewHelper.dataToPoint(n,y[D],y[D]);l?s.addPolyline(y,P,u,0,w):o!==0?(d=y[0],g=y[1],m(),s.addCubicCurve(d,f,p,g,P,u)):s.addPolyline(y,P,u,0,2),M++}},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}});function Fr(e){e.registerChartView(Rr),e.registerSeriesModel(et)}var Rt=["zoom","center","pitch","bearing"],lt=$t.extend({type:"mapbox3D",layoutMode:"box",coordinateSystem:null,defaultOption:{zlevel:-10,style:"mapbox://styles/mapbox/light-v9",center:[0,0],zoom:0,pitch:0,bearing:0,light:{main:{alpha:20,beta:30}},altitudeScale:1,boxHeight:"auto"},getMapboxCameraOption:function(){var e=this;return Rt.reduce(function(t,i){return t[i]=e.get(i),t},{})},setMapboxCameraOption:function(e){e!=null&&Rt.forEach(function(t){e[t]!=null&&(this.option[t]=e[t])},this)},getMapbox:function(){return this._mapbox},setMapbox:function(e){this._mapbox=e}});X(lt.prototype,rt);X(lt.prototype,at);function le(e,t){if(this.id=e,this.zr=t,this.dom=document.createElement("div"),this.dom.style.cssText="position:absolute;left:0;right:0;top:0;bottom:0;",!mapboxgl)throw new Error("Mapbox GL library must be included. See https://www.mapbox.com/mapbox-gl-js/api/");this._mapbox=new mapboxgl.Map({container:this.dom}),this._initEvents()}le.prototype.setUnpainted=function(){};le.prototype.resize=function(){this._mapbox.resize()};le.prototype.getMapbox=function(){return this._mapbox};le.prototype.clear=function(){};le.prototype.refresh=function(){this._mapbox.resize()};var Jt=["mousedown","mouseup","click","dblclick","mousemove","mousewheel","wheel","touchstart","touchend","touchmove","touchcancel"];le.prototype._initEvents=function(){var e=this._mapbox.getCanvasContainer();this._handlers=this._handlers||{contextmenu:function(t){return t.preventDefault(),!1}},Jt.forEach(function(t){this._handlers[t]=function(i){var r={};for(var a in i)r[a]=i[a];r.bubbles=!1;var o=new i.constructor(i.type,r);e.dispatchEvent(o)},this.zr.dom.addEventListener(t,this._handlers[t])},this),this.zr.dom.addEventListener("contextmenu",this._handlers.contextmenu)};le.prototype.dispose=function(){Jt.forEach(function(e){this.zr.dom.removeEventListener(e,this._handlers[e])},this)};const Kt=`
@export ecgl.displayShadow.vertex

@import ecgl.common.transformUniforms

@import ecgl.common.uv.header

@import ecgl.common.attributes

varying vec3 v_WorldPosition;

varying vec3 v_Normal;

void main()
{
 @import ecgl.common.uv.main
 v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);

 v_WorldPosition = (world * vec4(position, 1.0)).xyz;
 gl_Position = worldViewProjection * vec4(position, 1.0);
}

@end


@export ecgl.displayShadow.fragment

@import ecgl.common.uv.fragmentHeader

varying vec3 v_Normal;
varying vec3 v_WorldPosition;

uniform float roughness: 0.2;

#ifdef DIRECTIONAL_LIGHT_COUNT
@import clay.header.directional_light
#endif

@import ecgl.common.ssaoMap.header

@import clay.plugin.compute_shadow_map

void main()
{
 float shadow = 1.0;

 @import ecgl.common.ssaoMap.main

#if defined(DIRECTIONAL_LIGHT_COUNT) && defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)
 float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];
 if(shadowEnabled)
 {
 computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);
 }
 for (int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++) {
 shadow = min(shadow, shadowContribsDir[i] * 0.5 + 0.5);
 }
#endif

 shadow *= 0.5 + ao * 0.5;
 shadow = clamp(shadow, 0.0, 1.0);

 gl_FragColor = vec4(vec3(0.0), 1.0 - shadow);
}

@end`;_.Shader.import(Kt);const Br=jt.extend({type:"mapbox3D",__ecgl__:!0,init:function(e,t){var i=t.getZr();this._zrLayer=new le("mapbox3D",i),i.painter.insertLayer(-1e3,this._zrLayer),this._lightRoot=new _.Node,this._sceneHelper=new nt(this._lightRoot),this._sceneHelper.initLight(this._lightRoot);var r=this._zrLayer.getMapbox(),a=this._dispatchInteractAction.bind(this,t,r);["zoom","rotate","drag","pitch","rotate","move"].forEach(function(o){r.on(o,a)}),this._groundMesh=new _.Mesh({geometry:new _.PlaneGeometry,material:new _.Material({shader:new _.Shader({vertex:_.Shader.source("ecgl.displayShadow.vertex"),fragment:_.Shader.source("ecgl.displayShadow.fragment")}),depthMask:!1}),renderOrder:-100,culling:!1,castShadow:!1,$ignorePicking:!0,renderNormal:!0})},render:function(e,t,i){var r=this._zrLayer.getMapbox(),a=e.get("style"),o=JSON.stringify(a);o!==this._oldStyleStr&&a&&r.setStyle(a),this._oldStyleStr=o,r.setCenter(e.get("center")),r.setZoom(e.get("zoom")),r.setPitch(e.get("pitch")),r.setBearing(e.get("bearing")),e.setMapbox(r);var l=e.coordinateSystem;l.viewGL.scene.add(this._lightRoot),l.viewGL.add(this._groundMesh),this._updateGroundMesh(),this._sceneHelper.setScene(l.viewGL.scene),this._sceneHelper.updateLight(e),l.viewGL.setPostEffect(e.getModel("postEffect"),i),l.viewGL.setTemporalSuperSampling(e.getModel("temporalSuperSampling")),this._mapbox3DModel=e},afterRender:function(e,t,i,r){var a=r.renderer;this._sceneHelper.updateAmbientCubemap(a,e,i),this._sceneHelper.updateSkybox(a,e,i),e.coordinateSystem.viewGL.scene.traverse(function(o){o.material&&(o.material.define("fragment","NORMAL_UP_AXIS",2),o.material.define("fragment","NORMAL_FRONT_AXIS",1))})},updateCamera:function(e,t,i,r){e.coordinateSystem.setCameraOption(r),this._updateGroundMesh(),i.getZr().refresh()},_dispatchInteractAction:function(e,t,i){e.dispatchAction({type:"mapbox3DChangeCamera",pitch:t.getPitch(),zoom:t.getZoom(),center:t.getCenter().toArray(),bearing:t.getBearing(),mapbox3DId:this._mapbox3DModel&&this._mapbox3DModel.id})},_updateGroundMesh:function(){if(this._mapbox3DModel){var e=this._mapbox3DModel.coordinateSystem,t=e.dataToPoint(e.center);this._groundMesh.position.set(t[0],t[1],-.001);var i=new _.Plane(new _.Vector3(0,0,1),0),r=e.viewGL.camera.castRay(new _.Vector2(-1,-1)),a=e.viewGL.camera.castRay(new _.Vector2(1,1)),o=r.intersectPlane(i),l=a.intersectPlane(i),s=o.dist(l)/e.viewGL.rootNode.scale.x;this._groundMesh.scale.set(s,s,1)}},dispose:function(e,t){this._zrLayer&&this._zrLayer.dispose(),t.getZr().painter.delLayer(-1e3)}});var ae=xe.mat4,Le=512,qe=.6435011087932844,H=Math.PI,ve=1/10;function ye(){this.width=0,this.height=0,this.altitudeScale=1,this.boxHeight="auto",this.altitudeExtent,this.bearing=0,this.pitch=0,this.center=[0,0],this._origin,this.zoom=0,this._initialZoom,this.maxPitch=60,this.zoomOffset=0}ye.prototype={constructor:ye,dimensions:["lng","lat","alt"],containPoint:function(){},setCameraOption:function(e){this.bearing=e.bearing,this.pitch=e.pitch,this.center=e.center,this.zoom=e.zoom,this._origin||(this._origin=this.projectOnTileWithScale(this.center,Le)),this._initialZoom==null&&(this._initialZoom=this.zoom),this.updateTransform()},updateTransform:function(){if(this.height){var e=.5/Math.tan(qe/2)*this.height*ve,t=Math.max(Math.min(this.pitch,this.maxPitch),0)/180*Math.PI,i=qe/2,r=Math.PI/2+t,a=Math.sin(i)*e/Math.sin(Math.PI-r-i),o=Math.cos(Math.PI/2-t)*a+e,l=o*1.1;this.pitch>50&&(l=1e3);var s=[];ae.perspective(s,qe,this.width/this.height,1,l),this.viewGL.camera.projectionMatrix.setArray(s),this.viewGL.camera.decomposeProjectionMatrix();var s=ae.identity([]),n=this.dataToPoint(this.center);ae.scale(s,s,[1,-1,1]),ae.translate(s,s,[0,0,-e]),ae.rotateX(s,s,t),ae.rotateZ(s,s,-this.bearing/180*Math.PI),ae.translate(s,s,[-n[0]*this.getScale()*ve,-n[1]*this.getScale()*ve,0]),this.viewGL.camera.viewMatrix.array=s;var u=[];ae.invert(u,s),this.viewGL.camera.worldTransform.array=u,this.viewGL.camera.decomposeWorldTransform();var c=Le*this.getScale(),h;if(this.altitudeExtent&&!isNaN(this.boxHeight)){var d=this.altitudeExtent[1]-this.altitudeExtent[0];h=this.boxHeight/d*this.getScale()/Math.pow(2,this._initialZoom-this.zoomOffset)}else h=c/(2*Math.PI*6378e3*Math.abs(Math.cos(this.center[1]*(Math.PI/180))))*this.altitudeScale*ve;this.viewGL.rootNode.scale.set(this.getScale()*ve,this.getScale()*ve,h)}},getScale:function(){return Math.pow(2,this.zoom-this.zoomOffset)},projectOnTile:function(e,t){return this.projectOnTileWithScale(e,this.getScale()*Le,t)},projectOnTileWithScale:function(e,t,i){var r=e[0],a=e[1],o=r*H/180,l=a*H/180,s=t*(o+H)/(2*H),n=t*(H-Math.log(Math.tan(H/4+l*.5)))/(2*H);return i=i||[],i[0]=s,i[1]=n,i},unprojectFromTile:function(e,t){return this.unprojectOnTileWithScale(e,this.getScale()*Le,t)},unprojectOnTileWithScale:function(e,t,i){var r=e[0],a=e[1],o=r/t*(2*H)-H,l=2*(Math.atan(Math.exp(H-a/t*(2*H)))-H/4);return i=i||[],i[0]=o*180/H,i[1]=l*180/H,i},dataToPoint:function(e,t){return t=this.projectOnTileWithScale(e,Le,t),t[0]-=this._origin[0],t[1]-=this._origin[1],t[2]=isNaN(e[2])?0:e[2],isNaN(e[2])||(t[2]=e[2],this.altitudeExtent&&(t[2]-=this.altitudeExtent[0])),t}};function Ie(){ye.apply(this,arguments)}Ie.prototype=new ye;Ie.prototype.constructor=Ie;Ie.prototype.type="mapbox3D";function ei(e,t,i){function r(o,l){var s=l.getWidth(),n=l.getHeight(),u=l.getDevicePixelRatio();this.viewGL.setViewport(0,0,s,n,u),this.width=s,this.height=n,this.altitudeScale=o.get("altitudeScale"),this.boxHeight=o.get("boxHeight")}function a(o,l){if(this.model.get("boxHeight")!=="auto"){var s=[1/0,-1/0];o.eachSeries(function(n){if(n.coordinateSystem===this){var u=n.getData(),c=n.coordDimToDataDim("alt")[0];if(c){var h=u.getDataExtent(c,!0);s[0]=Math.min(s[0],h[0]),s[1]=Math.max(s[1],h[1])}}},this),s&&isFinite(s[1]-s[0])&&(this.altitudeExtent=s)}}return{dimensions:t.prototype.dimensions,create:function(o,l){var s=[];return o.eachComponent(e,function(n){var u=n.__viewGL;u||(u=n.__viewGL=new Ge,u.setRootNode(new _.Node));var c=new t;c.viewGL=n.__viewGL,c.resize=r,c.resize(n,l),s.push(c),n.coordinateSystem=c,c.model=n,c.update=a}),o.eachSeries(function(n){if(n.get("coordinateSystem")===e){var u=n.getReferringComponents(e).models[0];if(u||(u=o.getComponent(e)),!u)throw new Error(e+' "'+$.firstNotNull(n.get(e+"Index"),n.get(e+"Id"),0)+'" not found');n.coordinateSystem=u.coordinateSystem}}),i&&i(s,o,l),s}}}var Vr=ei("mapbox3D",Ie,function(e){e.forEach(function(t){t.setCameraOption(t.model.getMapboxCameraOption())})});function kr(e){e.registerComponentModel(lt),e.registerComponentView(Br),e.registerCoordinateSystem("mapbox3D",Vr),e.registerAction({type:"mapbox3DChangeCamera",event:"mapbox3dcamerachanged",update:"mapbox3D:updateCamera"},function(t,i){i.eachComponent({mainType:"mapbox3D",query:t},function(r){r.setMapboxCameraOption(t)})})}var Ft=["zoom","center","pitch","bearing"],ut=$t.extend({type:"maptalks3D",layoutMode:"box",coordinateSystem:null,defaultOption:{zlevel:-10,urlTemplate:"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/">CARTO</a>',center:[0,0],zoom:0,pitch:0,bearing:0,light:{main:{alpha:20,beta:30}},altitudeScale:1,boxHeight:"auto"},getMaptalksCameraOption:function(){var e=this;return Ft.reduce(function(t,i){return t[i]=e.get(i),t},{})},setMaptalksCameraOption:function(e){e!=null&&Ft.forEach(function(t){e[t]!=null&&(this.option[t]=e[t])},this)},getMaptalks:function(){return this._maptalks},setMaptalks:function(e){this._maptalks=e}});X(ut.prototype,rt);X(ut.prototype,at);function ue(e,t,i,r){if(this.id=e,this.zr=t,this.dom=document.createElement("div"),this.dom.style.cssText="position:absolute;left:0;right:0;top:0;bottom:0;",!maptalks)throw new Error("Maptalks library must be included. See https://maptalks.org");this._maptalks=new maptalks.Map(this.dom,{center:i,zoom:r,doubleClickZoom:!1,fog:!1}),this._initEvents()}ue.prototype.setUnpainted=function(){};ue.prototype.resize=function(){this._maptalks.checkSize()};ue.prototype.getMaptalks=function(){return this._maptalks};ue.prototype.clear=function(){};ue.prototype.refresh=function(){this._maptalks.checkSize()};var ti=["mousedown","mouseup","click","dblclick","mousemove","mousewheel","DOMMouseScroll","touchstart","touchend","touchmove","touchcancel"];ue.prototype._initEvents=function(){var e=this.dom;this._handlers=this._handlers||{contextmenu:function(t){return t.preventDefault(),!1}},ti.forEach(function(t){this._handlers[t]=function(i){var r={};for(var a in i)r[a]=i[a];r.bubbles=!1;var o=new i.constructor(i.type,r);t==="mousewheel"||t==="DOMMouseScroll"?e.dispatchEvent(o):e.firstElementChild.dispatchEvent(o)},this.zr.dom.addEventListener(t,this._handlers[t])},this),this.zr.dom.addEventListener("contextmenu",this._handlers.contextmenu)};ue.prototype.dispose=function(){ti.forEach(function(e){this.zr.dom.removeEventListener(e,this._handlers[e])},this),this._maptalks.remove()};_.Shader.import(Kt);const Ur=jt.extend({type:"maptalks3D",__ecgl__:!0,init:function(e,t){this._groundMesh=new _.Mesh({geometry:new _.PlaneGeometry,material:new _.Material({shader:new _.Shader({vertex:_.Shader.source("ecgl.displayShadow.vertex"),fragment:_.Shader.source("ecgl.displayShadow.fragment")}),depthMask:!1}),renderOrder:-100,culling:!1,castShadow:!1,$ignorePicking:!0,renderNormal:!0})},_initMaptalksLayer:function(e,t){var i=t.getZr();this._zrLayer=new ue("maptalks3D",i,e.get("center"),e.get("zoom")),i.painter.insertLayer(-1e3,this._zrLayer),this._lightRoot=new _.Node,this._sceneHelper=new nt(this._lightRoot),this._sceneHelper.initLight(this._lightRoot);var r=this._zrLayer.getMaptalks(),a=this._dispatchInteractAction.bind(this,t,r);["zoomend","zooming","zoomstart","dragrotating","pitch","pitchend","movestart","moving","moveend","resize","touchstart","touchmove","touchend","animating"].forEach(function(o){r.on(o,a)})},render:function(e,t,i){this._zrLayer||this._initMaptalksLayer(e,i);var r=this._zrLayer.getMaptalks(),a=e.get("urlTemplate"),o=r.getBaseLayer();a!==this._oldUrlTemplate&&(o?o.setOptions({urlTemplate:a,attribution:e.get("attribution")}):(o=new maptalks.TileLayer("maptalks-echarts-gl-baselayer",{urlTemplate:a,subdomains:["a","b","c"],attribution:e.get("attribution")}),r.setBaseLayer(o))),this._oldUrlTemplate=a,r.setCenter(e.get("center")),r.setZoom(e.get("zoom"),{animation:!1}),r.setPitch(e.get("pitch")),r.setBearing(e.get("bearing")),e.setMaptalks(r);var l=e.coordinateSystem;l.viewGL.scene.add(this._lightRoot),l.viewGL.add(this._groundMesh),this._updateGroundMesh(),this._sceneHelper.setScene(l.viewGL.scene),this._sceneHelper.updateLight(e),l.viewGL.setPostEffect(e.getModel("postEffect"),i),l.viewGL.setTemporalSuperSampling(e.getModel("temporalSuperSampling")),this._maptalks3DModel=e},afterRender:function(e,t,i,r){var a=r.renderer;this._sceneHelper.updateAmbientCubemap(a,e,i),this._sceneHelper.updateSkybox(a,e,i),e.coordinateSystem.viewGL.scene.traverse(function(o){o.material&&(o.material.define("fragment","NORMAL_UP_AXIS",2),o.material.define("fragment","NORMAL_FRONT_AXIS",1))})},updateCamera:function(e,t,i,r){e.coordinateSystem.setCameraOption(r),this._updateGroundMesh(),i.getZr().refresh()},_dispatchInteractAction:function(e,t,i){e.dispatchAction({type:"maptalks3DChangeCamera",pitch:t.getPitch(),zoom:Wr(t.getResolution())+1,center:t.getCenter().toArray(),bearing:t.getBearing(),maptalks3DId:this._maptalks3DModel&&this._maptalks3DModel.id})},_updateGroundMesh:function(){if(this._maptalks3DModel){var e=this._maptalks3DModel.coordinateSystem,t=e.dataToPoint(e.center);this._groundMesh.position.set(t[0],t[1],-.001);var i=new _.Plane(new _.Vector3(0,0,1),0),r=e.viewGL.camera.castRay(new _.Vector2(-1,-1)),a=e.viewGL.camera.castRay(new _.Vector2(1,1)),o=r.intersectPlane(i),l=a.intersectPlane(i),s=o.dist(l)/e.viewGL.rootNode.scale.x;this._groundMesh.scale.set(s,s,1)}},dispose:function(e,t){this._zrLayer&&this._zrLayer.dispose(),t.getZr().painter.delLayer(-1e3)}}),Hr=2*6378137*Math.PI/(256*Math.pow(2,20));function Wr(e){return 19-Math.log(e/Hr)/Math.LN2}function Oe(){ye.apply(this,arguments),this.maxPitch=85,this.zoomOffset=1}Oe.prototype=new ye;Oe.prototype.constructor=Oe;Oe.prototype.type="maptalks3D";var $r=ei("maptalks3D",Oe,function(e){e.forEach(function(t){t.setCameraOption(t.model.getMaptalksCameraOption())})});function jr(e){e.registerComponentModel(ut),e.registerComponentView(Ur),e.registerCoordinateSystem("maptalks3D",$r),e.registerAction({type:"maptalks3DChangeCamera",event:"maptalks3dcamerachanged",update:"maptalks3D:updateCamera"},function(t,i){i.eachComponent({mainType:"maptalks3D",query:t},function(r){r.setMaptalksCameraOption(t)})})}const Zr={getDeviceById(e){return U.post("/single/queryPrimaryDeviceBySubstationId",e)},getPhaseByDev(e){return U.post("/single/queryDeviceNameByPrimaryId",e)},getDevDetail(e){return U.post("/yc/queryHistoryYcData2",e)},getDevStatus(e){return U.post("/trom/statistics/status",e)},getDevTypes(e){return U.post("/trom/statistics/types",e)},getDevInfo(e){return U.post("/trom/statistics/details",e)},getSubClassify(e){return U.post("/trom/statistics/classify",e)},getStatus(e){return U.post("/trom/advance/twins/oilData",e)},diagonstic(e){return U.post("/apolloMes/query",e)},getDevStatusByDev(e){return U.get("/trom/rt/getDeviceState",{params:e})},getAnalysis(e){return U.post(`trom/diagnostic/spectrumanalysis?device_id=${e}`)},getDiagnosis(e){return U.post("apolloMes/query",e)},uploadDiagnosis(e){return U.post("/trom/diagnostic/gasupload",e)},downloadDiagnosis(){return U.get("/trom/diagnostic/exportDataCompare")}},Xe=["#1dd4e7","#fcfd01","#d88d1f","#ff4026","#127ca0","#4992ff"];function qr(e){if(e.data.length===0)return;let t=0,i=0,r=0,a=1,o=[],l=[],s=e.ratio!==void 0?ee.round((1-e.ratio)/(1+e.ratio),3):1/3;for(let c=0;c<e.data.length;c++){const h=e.data[c];r+=h.value;const d={type:"surface",name:h.name||`series${c}`,parametric:!0,wireframe:{show:!1},_name:name,_data:ce(A({},h),{factor:s,hovered:!1,selected:!1})};h.itemStyle&&(d.itemStyle={color:h.itemStyle.color||e.colors[c],opacity:h.itemStyle.opacity||e.opacity}),o.push(d)}r===0&&(a=ee.round(1/e.data.length,2));for(let c=0;c<o.length;c++){const h=o[c];i=t+h._data.value,h._data.startRatio=r?ee.round(t/r,2):a*c,h._data.endRatio=r?ee.round(i/r,2):c===o.length?1:a*(c+1);const d=e.nightingale?h._data.value:e.height;h.parametricEquation=Ve({factor:s,height:d,endRatio:h._data.endRatio,startRatio:h._data.startRatio,isHovered:!1,isSelected:!1}),t=i,l.push({name:h.name,value:ee.round(h._data.value/r,2)})}const n=ee.maxBy(o,"_data.value"),u=e.nightingale?n._data.value:e.height;return{grid3D:A({show:!1,boxHeight:u,viewControl:A({autoRotate:!1,panSensitivity:0,zoomSensitivity:0,rotateSensitivity:0},e.viewControl),postEffect:A({enable:!1},e.postEffect)},e.grid),xAxis3D:{min:-1,max:1},yAxis3D:{min:-1,max:1},zAxis3D:{min:-1,max:1},label:e.label,labelLine:e.labelLine,legend:ce(A({},e.legend),{data:l}),tooltip:{trigger:"item",textStyle:{color:"#fff",fontSize:12},formatter:c=>{const{color:h,seriesType:d,seriesName:f,seriesIndex:p}=c;if(d==="surface"){const{_data:g}=o[p];return`<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color: ${h};"></span> ${f}   ${g.value}`}}},series:o}}function Ve({factor:e,height:t,endRatio:i=1,startRatio:r=0,isHovered:a=!1,isSelected:o=!1}){const l=(r+i)/2,s=r*Math.PI*2,n=i*Math.PI*2,u=l*Math.PI*2;r===0&&i===1&&(o=!1),e=e!==void 0?e:1/3;const c=o?Math.cos(u)*.1:0,h=o?Math.sin(u)*.1:0,d=a?1.05:1;return{u:{min:-Math.PI,max:Math.PI*3,step:Math.PI/32},v:{min:0,max:Math.PI*2,step:Math.PI/20},x:(f,p)=>f<s?c+Math.cos(s)*(1+Math.cos(p)*e)*d:f>n?c+Math.cos(n)*(1+Math.cos(p)*e)*d:c+Math.cos(f)*(1+Math.cos(p)*e)*d,y:(f,p)=>f<s?h+Math.sin(s)*(1+Math.cos(p)*e)*d:f>n?h+Math.sin(n)*(1+Math.cos(p)*e)*d:h+Math.sin(f)*(1+Math.cos(p)*e)*d,z:(f,p)=>f<-Math.PI*.5?Math.sin(f):f>Math.PI*2.5?Math.sin(f)*t*.1:Math.sin(p)>0?1*t*.1:-1}}const Xr={__name:"Chart2D",props:{type:{type:String,default:"bar"},group:{type:String,default:"default"},theme:{type:String,default:"light"},option:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1},autoresize:{type:Boolean,default:!0},manualUpdate:{type:Boolean,default:!1},initOptions:{type:Object,default:()=>({})},updateOptions:{type:Object,default:()=>({notMerge:!1,lazyUpdate:!1,silent:!1,replaceMerge:[]})},loadingOptions:{type:Object,default:()=>({text:"加载中...",color:"#00cbff",fontSize:14,textColor:"#b7cffc",maskColor:"rgba(0,0,0,0.5)"})},delayInit:{type:Number,default:0}},emits:["initialized","click","dblclick","mouseup","mouseout","mousedown","mousemove","mouseover","globalout","zrclick"],setup(e,{expose:t,emit:i}){const r=i,a=e,o=W(null),l=["initialized","click","dblclick","mouseup","mouseout","mousedown","mousemove","mouseover","globalout","zrclick"];let s=null,n=null,u=null;const c={pie:{legend:{show:!0,top:"top",left:"center",itemGap:20,itemWidth:10,itemHeight:10,icon:"circle"},tooltip:{show:!0,trigger:"item",borderWidth:1,borderColor:"#0a5982",backgroundColor:"rgba(10,89,130,0.5)",extraCssText:"z-index: 1000"},series:[]},bar:{grid:{top:"15%",left:"3%",right:"3%",bottom:"3%",containLabel:!0},xAxis:{type:"category",axisLine:{show:!0},axisTick:{show:!1},splitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},yAxis:{type:"value",axisLine:{show:!0},axisTick:{show:!1},splitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},legend:{show:!0,top:"top",left:"right",itemGap:20,itemWidth:10,itemHeight:10,icon:"roundRect",textStyle:{fontSize:14}},tooltip:{show:!0,trigger:"axis",axisPointer:{type:"shadow"},borderWidth:1,borderColor:"#0a5982",backgroundColor:"rgba(10,89,130,0.5)",extraCssText:"z-index: 1000"},series:[]},line:{grid:{top:"15%",left:"3%",right:"3%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,axisLine:{show:!0},axisTick:{show:!1},splitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},yAxis:{type:"value",axisLine:{show:!0},axisTick:{show:!1},splitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},legend:{show:!0,top:"top",left:"right",itemGap:20,itemWidth:10,itemHeight:10,icon:"circle",textStyle:{fontSize:14}},tooltip:{show:!0,trigger:"axis",axisPointer:{type:"line",lineStyle:{type:"dashed"}},borderWidth:1,borderColor:"#0a5982",backgroundColor:"rgba(10,89,130,0.5)",extraCssText:"z-index: 1000"},series:[]},funnel:{tooltip:{show:!0,trigger:"item",borderWidth:1,borderColor:"#0a5982",backgroundColor:"rgba(10,89,130,0.5)",extraCssText:"z-index: 1000"},legend:{show:!1},series:[]},scatter:{grid:{top:"15%",left:"3%",right:"3%",bottom:"3%",containLabel:!0},xAxis:{type:"value",axisLine:{show:!0},axisTick:{show:!1},axisLabel:{interval:0,fontSize:14},splitLine:{show:!0,lineStyle:{type:"dashed",opacity:.5}}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!0,fontSize:14},splitLine:{show:!0,lineStyle:{type:"dashed",opacity:.5}}},tooltip:{show:!0,trigger:"item",borderWidth:1,borderColor:"#0a5982",backgroundColor:"rgba(10,89,130,0.5)",extraCssText:"z-index: 1000"},series:[{type:"scatter",symbolSize:4,large:!0,largeThreshold:2e3}]},radar:{grid:{top:"5%",left:"3%",right:"3%",bottom:"1%",containLabel:!0},radar:{radius:"75%",axisName:{width:100,fontSize:14,overflow:"breakAll"},splitLine:{show:!0},axisLine:{show:!0},splitArea:{show:!0}},legend:{show:!0,bottom:0}}},h=z(()=>{const x=c[a.type]||{},w=JSON.parse(JSON.stringify(x));return Object.keys(a.option).forEach(S=>{w[S]&&_e(w[S])==="Object"&&_e(a.option[S])==="Object"?w[S]=A(A({},w[S]),a.option[S]):w[S]=a.option[S]}),w});function d(){!o.value||s||(s=St.init(o.value,a.theme,a.initOptions),a.group&&St.connect(a.group),s.setOption(h.value),f(),a.loading&&s.showLoading(a.loadingOptions),r("initialized",{chart:s,option:h.value}))}function f(){l.forEach(x=>{x!=="initialized"&&s.on(x,w=>r(x,w))})}function p(){l.forEach(x=>{x!=="initialized"&&s.off(x)})}function g(){s&&s.resize()}function y(){s&&(p(),s.dispose(),s=null)}function v(){return Se(this,null,function*(){y(),yield qt(),d()})}function T(){if(!o.value)return!1;const{offsetWidth:x,offsetHeight:w}=o.value;return x>0&&w>0}function m(){return Se(this,null,function*(){T()?d():(yield new Promise(x=>setTimeout(x,50)),m())})}return Je(()=>a.option,()=>{!s||a.manualUpdate||s.setOption(h.value,a.updateOptions)},{deep:!0}),Je(()=>a.loading,x=>{s&&(x?s.showLoading(a.loadingOptions):s.hideLoading())}),Zt(()=>{a.delayInit>0?u=setTimeout(()=>{m()},a.delayInit):m(),a.autoresize&&window.ResizeObserver&&(n=new ResizeObserver(()=>{s?g():!s&&T()&&d()}),o.value&&n.observe(o.value)),window.addEventListener("resize",g)}),Fi(()=>{u&&(clearTimeout(u),u=null),n&&(n.disconnect(),n=null),window.removeEventListener("resize",g),y()}),t({getInstance:()=>s,resize:g,refresh:v}),(x,w)=>(E(),k("div",{ref_key:"chartRef",ref:o,class:"sy-chart"},null,512))}},Yr=ot(Xr,[["__scopeId","data-v-7b9548f5"]]);R(Bi);R(Ut);R(Vi);R(kr);R(jr);R(ki);R(Ui);R(Hi);R(gr);R(mr);R(Wi);R(yr);R(br);R(Ar);R(zr);R(Fr);const Qr={class:"sy-chart-container"},Jr=tt({name:"Pie3D"}),Kr=Object.assign(Jr,{props:{data:{type:Array,default:()=>[]},legend:{type:Object,default:()=>({show:!0})},option:{type:Object,default:()=>({})},background:{type:Object,default:()=>({})}},emits:["onClick"],setup(e,{emit:t}){const i=t,r=e,a=W(null),o=W({}),l=W(0),s=z(()=>{let g=100,y=100;if(Array.isArray(r.option.center)){const v=r.option.center;f(v[0])&&(g=ee.round(parseFloat(v[0])*2),g=_e(v[0])==="String"?`${g}%`:g),f(v[1])&&(y=ee.round(parseFloat(v[1])*2),y=_e(v[1])==="String"?`${y}%`:y)}return{top:"0%",left:"0%",right:"0%",bottom:"0%",width:g,height:y}}),n=z(()=>{let g="50%",y="50%";if(Array.isArray(r.option.center)){const v=r.option.center;f(v[0])&&(y=r.option.center[0]),f(v[1])&&(g=r.option.center[1])}return A({top:g,left:y,width:"50%",height:"50%"},r.background)}),u=z(()=>{let g=!1,y=["0%","50%"];return Array.isArray(r.option.radius)?(y=r.option.radius,g=y[0]!=="0%"&&y[0]!==0):f(r.option.radius)&&(y=["0%",r.option.radius],g=!1),A({color:Xe,name:"pie3d",ratio:0,height:15,annular:g,opacity:1,startAngle:-45,nightingale:!1,center:["50%","50%"],radius:y,grid:s.value,label:{show:!1},labelLine:{show:!1},postEffect:{},viewControl:A({alpha:30,beta:0,distance:300,maxDistance:400,minDistance:200},r.option.viewControl),legend:A({show:!0,orient:"vertical",top:"middle",left:"auto",right:"1%",icon:"circle",itemGap:10,itemWidth:20,itemHeight:10},r.legend)},r.option)});Je(()=>r.data,g=>{const y=ee.cloneDeep(g);p(y);const{center:v,radius:T,label:m,labelLine:x,startAngle:w}=L(u),S=qr(A({data:y,colors:Xe},u.value));g.length>0&&m.show&&S.series.push({type:"pie",name:"pie2d",center:v,radius:T,silent:!0,clockwise:!1,startAngle:w,backgroundColor:"transparent",label:A({show:!0,position:"outer",alignTo:"labelLine",opacity:1},m),labelLine:A({show:!0,showAbove:!1,smooth:!0,length:20,length2:10},x),itemStyle:{opacity:0},data:y}),o.value=A(A({},S),r.option)},{immediate:!0});const c=g=>{i("onClick",g)},h=g=>{const{seriesType:y,seriesIndex:v}=g;if(y!=="surface")return;let T,m,x,w,S;const{height:M,nightingale:P}=u.value;if(l.value!==v){if(l.value!==void 0){const C=o.value.series[l.value],D=P?C._data.value:M;m=!1,x=C._data.selected,w=C._data.startRatio,S=C._data.endRatio,T=C._data.factor,C.parametricEquation=Ve({center:u.value.center,factor:T,height:D,endRatio:S,startRatio:w,isHovered:m,isSelected:x}),C._data.hovered=m,l.value=void 0}if(y==="surface"){const C=o.value.series[v],D=P?C._data.value:M;m=!0,x=C._data.selected,w=C._data.startRatio,S=C._data.endRatio,T=C._data.factor,C.parametricEquation=Ve({center:u.value.center,factor:T,height:D+1,endRatio:S,startRatio:w,isHovered:m,isSelected:x}),C._data.hovered=m,l.value=v}}},d=()=>{let g,y,v,T,m;const x=o.value.series[l.value];if(l.value!==void 0){const{height:w,nightingale:S}=u.value,M=S?x._data.value:w;y=!1,v=x._data.selected,T=x._data.startRatio,m=x._data.endRatio,g=x._data.factor,x.parametricEquation=Ve({center:u.value.center,factor:g,height:M,endRatio:m,startRatio:T,isHovered:y,isSelected:v}),x._data.hovered=y,l.value=void 0}};function f(g){return _e(g)==="Number"||_e(g)==="String"&&g.includes("%")}function p(g){g.forEach((y,v)=>{const T=Xe[v];y.label={show:!0,color:T,position:"outside",formatter:"{b} {c}",rich:{}},y.labelLine={lineStyle:{color:T}},y.itemStyle={color:T}})}return(g,y)=>(E(),k("div",Qr,[de(Yr,{ref_key:"chartRef",ref:a,class:"sy-chart",type:"pie",option:L(o),onClick:c,onMouseover:h,onGlobalout:d},null,8,["option"]),b("div",{class:"sy-chart-background",style:he(L(n))},null,4)]))}}),ea=ot(Kr,[["__scopeId","data-v-c4c9c75a"]]),ta={class:"diagnosis-main"},ia={class:"diagnosis-main__title"},ra={class:"diagnosis-main__title-statis"},aa={class:"item"},na={class:"item"},oa={class:"success"},sa={class:"item"},la={class:"primary"},ua={class:"diagnosis-main__content"},ca={class:"row"},ha={class:"item"},da={class:"content"},fa={class:"base"},pa={class:"item"},ga={class:"content"},va={class:"item"},ma={class:"content"},_a={key:0,class:"sugg"},ya={class:"row"},xa={class:"item",style:{flex:"2.05"}},wa={class:"content"},ba={class:"analysis"},Sa={class:"analysis-title"},Ta={class:"analysis-content"},La={class:"analysis-title"},Ma={class:"analysis-content"},Pa={class:"analysis-title"},Ca={class:"analysis-content"},Da={class:"item"},Aa={class:"content"},Ia={class:"result"},Oa={__name:"device-diagnosis",setup(e){const t=$i(Yi.AlarmLevels,"key","value"),i=W(!0),r=W([{label:"设备名称：",value:"-"},{label:"投运型号：",value:"-"},{label:"投运日期：",value:"-"},{label:"诊断时间：",value:"-"}]),a=W({dataQuality:0,healthIndex:0,status:"",content:"",llm:"正常"}),o={0:"轻微",1:"中度",2:"严重",3:"危急"},l={0:"success",1:"info",2:"warning",3:"danger"},s=W([]),n=W({degassingUnit:"无",detectionUnit:"无",gasSourceUnit:"无"}),u=W([{name:"预警",value:0},{name:"一般",value:0},{name:"严重",value:0},{name:"危急",value:0}]),c=W({ratio:0,center:["30%","50%"],showLabel:!1,viewControl:{alpha:30,beta:0,distance:330,maxDistance:400,minDistance:200}}),h=W(null),d=W([]),f=W(""),p=()=>Se(this,null,function*(){const{success:y,data:v,message:T}=yield Qi();if(y){const{treeData:m,firstLeaf:x}=v;d.value=m,qt(()=>{var w;x&&((w=h.value)==null||w.setCurrentKey(x.guid))})}else Xi.error(T)}),g=y=>Se(this,null,function*(){var w;i.value=!0,f.value=y.guid;const{success:v,data:T}=yield Zr.getDiagnosis({from:0,index:"deviceAnalysis",match:{deviceId:f.value},order:{diagTime:"desc"},orderFields:{0:"diagTime"},size:1});if(i.value=!1,!v||!T.length){s.value=[],a.value={dataQuality:0,healthIndex:0,status:"",content:"",llm:"正常"},n.value={degassingUnit:"无",detectionUnit:"无",gasSourceUnit:"无"};return}const m={0:"低",1:"中",2:"高"};s.value=(w=T[0].maintenanceSuggestions)==null?void 0:w.map(S=>ce(A({},S),{priority:m[S.level]}));const x=Object.values(T[0].deviceStatus.modules).find(S=>S.state===1)>-1?"故障":"正常";a.value=ce(A({},T[0].deviceStatus.overall),{llm:x,dataQuality:T[0].dataQuality*100}),n.value=T[0].deviceStatus.modules,u.value=T[0].llmDeviceInfo.alarmStastics.map(S=>ce(A({},S),{name:t[+S.alarmLevel],value:S.alarmCount})).sort((S,M)=>S.alarmLevel-M.alarmLevel),r.value[0].value=T[0].llmDeviceInfo.name,r.value[1].value=T[0].llmDeviceInfo.model,r.value[2].value=T[0].llmDeviceInfo.runDate,r.value[3].value=T[0].diagTime});return Zt(()=>{p()}),(y,v)=>{const T=Tt("SyIcon"),m=Zi,x=Tt("SyEmpty"),w=ar,S=qi;return E(),ke(Ki,{class:"diagnosis"},{leftTree:Be(()=>[de(Ji,{ref:"devTree","default-key":y.defaultSeleceKey,onTreeSelect:g},null,8,["default-key"])]),rightContent:Be(()=>[ji((E(),k("div",ta,[b("div",ia,[b("div",ra,[b("div",aa,[de(T,{name:"wave",class:"prefix"}),v[0]||(v[0]=b("label",null,"LLM诊断",-1)),b("span",{class:V(`${L(a).llm==="正常"?"success":""}`)},N(L(a).llm),3)]),v[3]||(v[3]=b("div",{class:"line"},null,-1)),b("div",na,[v[1]||(v[1]=b("label",null,"数据可靠性：",-1)),b("span",oa,N(L(a).dataQuality/100||0),1)]),v[4]||(v[4]=b("div",{class:"line"},null,-1)),b("div",sa,[v[2]||(v[2]=b("label",null,"健康指数：",-1)),b("span",la,N(L(a).healthIndex/100||0),1)])]),b("div",null,[de(m,{type:"primary"},{default:Be(()=>v[5]||(v[5]=[Lt("装置诊断")])),_:1,__:[5]})])]),b("div",ua,[b("div",ca,[b("div",ha,[v[6]||(v[6]=b("div",{class:"title"},"基本信息",-1)),b("div",da,[b("ul",fa,[(E(!0),k(Mt,null,Pt(L(r),M=>(E(),k("li",{key:M.label},[b("label",null,N(M.label),1),b("span",null,N(M.value),1)]))),128))])])]),b("div",pa,[v[7]||(v[7]=b("div",{class:"title"},"告警分析",-1)),b("div",ga,[de(ea,{data:L(u),option:L(c),"show-label":!1,legend:{show:!0,orient:"vertical",top:"40%",left:"auto",right:"20%",icon:"circle",itemGap:10,itemWidth:20,itemHeight:10}},null,8,["data","option"])])]),b("div",va,[v[9]||(v[9]=b("div",{class:"title"},"维护建议",-1)),b("div",ma,[L(s).length?(E(),k("ul",_a,[(E(!0),k(Mt,null,Pt(L(s),(M,P)=>(E(),k("li",{key:M.label},[b("label",null,N(`${P+1}.${M.suggestion}`),1),b("span",null,[v[8]||(v[8]=Lt(" 优先级 ")),b("p",{class:V([M.level===2?"":M.level===1?"warning":"success"])},N(M.priority),3)])]))),128))])):(E(),ke(x,{key:1}))])])]),b("div",ya,[b("div",xa,[v[16]||(v[16]=b("div",{class:"title"},"数据分析",-1)),b("div",wa,[b("ul",ba,[b("li",null,[b("div",Sa,[v[10]||(v[10]=b("span",null,"气源单元",-1)),b("label",{class:V(`${L(n).gasSourceState===0?"":"danger"}`)},N(L(n).gasSourceState===0?"正常":"告警"),3)]),b("div",Ta,N(L(n).gasSourceUnit),1),v[11]||(v[11]=b("div",{class:"analysis-img gas"},null,-1))]),b("li",null,[b("div",La,[v[12]||(v[12]=b("span",null,"脱气单元",-1)),b("label",{class:V(`${L(n).degassingState===0?"":"danger"}`)},N(L(n).degassingState===0?"正常":"告警"),3)]),b("div",Ma,N(L(n).degassingUnit),1),v[13]||(v[13]=b("div",{class:"analysis-img decarbonization"},null,-1))]),b("li",null,[b("div",Pa,[v[14]||(v[14]=b("span",null,"检测单元",-1)),b("label",{class:V(`${L(n).detectionState===0?"":"danger"}`)},N(L(n).detectionState===0?"正常":"告警"),3)]),b("div",Ca,N(L(n).detectionUnit),1),v[15]||(v[15]=b("div",{class:"analysis-img check"},null,-1))])])])]),b("div",Da,[v[21]||(v[21]=b("div",{class:"title"},"诊断结论",-1)),b("div",Aa,[b("ul",Ia,[b("li",null,[v[17]||(v[17]=b("label",null,"诊断结论：",-1)),b("span",{class:V(`${l[L(a).status]}`)},N(o[L(a).status]||"-"),3)]),b("li",null,[v[18]||(v[18]=b("label",null,"故障描述：",-1)),b("span",null,N(L(a).conclusion||"-"),1)]),b("li",null,[v[19]||(v[19]=b("label",null,"数据可靠性：",-1)),b("span",null,[de(w,{type:"circle",width:80,percentage:L(a).dataQuality||0,"stroke-width":12,color:"#01cd63",format:()=>L(a).dataQuality||0},null,8,["percentage","format"])])]),b("li",null,[v[20]||(v[20]=b("label",null,"装置健康指数：",-1)),b("span",null,[de(w,{type:"circle",width:80,percentage:L(a).healthIndex,"stroke-width":12,color:"#2c73d4",format:()=>L(a).healthIndex},null,8,["percentage","format"])])])])])])])])])),[[S,L(i)]])]),_:1})}}},$a=ot(Oa,[["__scopeId","data-v-a8925014"]]);export{$a as default};
