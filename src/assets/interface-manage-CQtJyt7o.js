var O=Object.defineProperty,G=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var k=(a,e,o)=>e in a?O(a,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[e]=o,C=(a,e)=>{for(var o in e||(e={}))W.call(e,o)&&k(a,o,e[o]);if(v)for(var o of v(e))j.call(e,o)&&k(a,o,e[o]);return a},E=(a,e)=>G(a,N(e));var D=(a,e,o)=>new Promise((c,l)=>{var i=s=>{try{d(o.next(s))}catch(f){l(f)}},u=s=>{try{d(o.throw(s))}catch(f){l(f)}},d=s=>s.done?c(s.value):Promise.resolve(s.value).then(i,u);d((o=o.apply(a,e)).next())});import{_ as J,f as _,g as m,o as p,w as r,h as n,W as S,C as h,J as g,P as y,T as X,U as H,l as K,m as T,X as Q,a4 as Y,a9 as Z,aa as V,a3 as $}from"./index-B39jV9jF.js";/* empty css                   */import{E as ee,a as te}from"./el-col-Bytg58G3.js";import{E as le}from"./el-overlay-Dn3cFvZe.js";import{E as ae}from"./el-pagination-Ci021nhQ.js";import{E as oe,a as re}from"./el-table-column-Bv3IDvxf.js";import{E as ne,a as ie}from"./el-select-GiiTkgXP.js";import"./el-checkbox-BKHg6oYz.js";import{E as se}from"./el-popover-CTzoDydu.js";/* empty css                  */import{E as pe,a as de}from"./el-form-item-DAKEzk2j.js";import{F as me}from"./FilterTable-BoNWDjCu.js";import"./index-BLO7j2E6.js";import"./_Uint8Array-DALx1iGH.js";import"./_initCloneObject-Dv6leNqs.js";import"./token-DI9FKtlJ.js";import"./strings-D1mW6FGG.js";const ue={name:"InterfaceManage",components:{FilterTable:me},data(){return{interfaceModal:!1,interfaceTitle:"",roleAction:"",interfaceForm:{id:void 0,path:void 0,roleType:void 0,method:void 0},tableLoad:!1,tablePage:1,tableSize:20,tableTotal:0,tableData:[],tableForm:{path:void 0,roleType:void 0,method:void 0}}},computed:{roleType(){return $},roleTypes(){return V.RoleTypes.filter(a=>a.key!==4)},roleTypeMap(){return Z(V.RoleTypes)},requestMethods(){return[{key:"GET",value:"GET"},{key:"POST",value:"POST"}]},interfaceRules(){return{path:[{required:!0,message:"请输入请求路径",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"blur"}],roleType:[{required:!0,message:"请选择角色类型",trigger:"blur"}]}},tableColumns(){return[{type:"index",label:"序号",width:80,align:"center"},{prop:"path",label:"接口路径"},{prop:"method",label:"请求方法"},{prop:"roleType",label:"角色类型"},{prop:"operation",label:"操作",minWidth:150}]}},created(){this.getTableData()},methods:{handleTableAction(a,e={}){switch(this.roleAction=a,a){case"create":this.interfaceForm={id:void 0,path:void 0,roleType:void 0,method:void 0},this.interfaceTitle="接口新增",this.interfaceModal=!0;break;case"edit":this.interfaceForm.id=e.ID,this.interfaceForm.path=e.path,this.interfaceForm.method=e.method,this.interfaceForm.roleType=+e.role,this.interfaceTitle="接口编辑",this.interfaceModal=!0;break;case"delete":this.$api.postUserApi("permission/access/remove",{id_list:[e.ID.toString()]}).then(o=>{o!=null&&o.success&&(this.$message({type:"success",message:"接口删除成功！"}),this.getTableData())});break}},handleModalAction(){this.$refs.interfaceForm.validate(a=>D(this,null,function*(){if(a)switch(this.roleAction){case"create":{this.$api.postUserApi("permission/access/create",{role:this.interfaceForm.roleType.toString(),permission:[{path:this.interfaceForm.path,method:this.interfaceForm.method}]}).then(e=>{e!=null&&e.success&&(this.$message({type:"success",message:"接口配置创建成功！"}),this.$refs.interfaceForm.resetFields(),this.interfaceModal=!1,this.getTableData())});break}case"edit":{const e={ID:this.interfaceForm.id,role:this.interfaceForm.roleType.toString(),path:this.interfaceForm.path,method:this.interfaceForm.method};this.$api.postUserApi("permission/access/update",e).then(o=>{o!=null&&o.success&&(this.$message({type:"success",message:"接口更新成功！"}),this.interfaceModal=!1,this.getTableData())});break}}}))},onFormRegex(a){a in this.interfaceForm&&(this.interfaceForm[a]=this.interfaceForm[a].toString().replace(/[^\\*|\\/|\w$]/g,""))},onTablePageChange(a){this.tablePage=a,this.getTableData()},onDialogClose(){this.$refs.interfaceForm.resetFields()},getTableData(a){a&&(this.tablePage=1),this.tableLoad=!0,this.$api.getUserApi("permission/access",{limit:this.tableSize,offset:this.tableSize*(this.tablePage-1),path:this.tableForm.path,role:this.tableForm.roleType,method:this.tableForm.method}).then(e=>{var o;if(!((o=e==null?void 0:e.data)!=null&&o.length)){this.tableData=[],this.tableTotal=0;return}this.tableData=e.data.map((c,l)=>E(C({},c),{index:(this.tablePage-1)*this.tableSize+l+1,roleType:this.roleTypeMap[c.role]||"-"})),this.tableTotal=e.count}).finally(()=>{this.tableLoad=!1})},resetTableData(){this.tableForm={id:void 0,path:void 0,roleType:void 0,method:void 0},this.getTableData(!0)}}};function fe(a,e,o,c,l,i){const u=ie,d=ne,s=de,f=pe,b=K,M=_("SyEmpty"),x=se,P=re,w=oe,A=ae,U=_("FilterTable"),z=ee,R=_("SyInput"),I=le,q=te,L=Y;return p(),m(q,{id:"role_manage",class:"sy-row sy-col-vertical",gutter:10},{default:r(()=>[n(z,{class:"sy-col",span:24},{default:r(()=>[n(U,{"table-name":"接口管理",expand:!0,"table-load":l.tableLoad,onChange:e[7]||(e[7]=t=>i.getTableData(!0)),onReset:e[8]||(e[8]=t=>i.resetTableData())},{filterForm:r(()=>[n(f,{ref:"filterFormRef",model:l.tableForm,inline:""},{default:r(()=>[n(s,{prop:"roleType",label:"角色类型",class:"sy-query-condition__item"},{default:r(()=>[n(d,{modelValue:l.tableForm.roleType,"onUpdate:modelValue":e[0]||(e[0]=t=>l.tableForm.roleType=t),"popper-class":"sy-popper",placeholder:"请选择角色类型",clearable:"",onChange:e[1]||(e[1]=t=>i.getTableData(!0))},{default:r(()=>[(p(!0),h(g,null,y(i.roleTypes,t=>(p(),m(u,{key:t.key,label:t.value,value:t.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(s,{prop:"method",label:"请求方法",class:"sy-query-condition__item"},{default:r(()=>[n(d,{modelValue:l.tableForm.method,"onUpdate:modelValue":e[2]||(e[2]=t=>l.tableForm.method=t),"popper-class":"sy-popper",placeholder:"请选择请求方法",clearable:"",onChange:e[3]||(e[3]=t=>i.getTableData(!0))},{default:r(()=>[(p(!0),h(g,null,y(i.requestMethods,t=>(p(),m(u,{key:t.key,label:t.value,value:t.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),tableAction:r(()=>[n(b,{class:"sy-btn-default",type:"success",onClick:e[4]||(e[4]=t=>i.handleTableAction("create"))},{default:r(()=>e[15]||(e[15]=[T(" 新增 ")])),_:1,__:[15]})]),table:r(()=>[S((p(),m(w,{class:"sy-table",data:l.tableData,border:"",stripe:"","highlight-current-row":""},{empty:r(()=>[S(n(M,null,null,512),[[Q,!l.tableLoad]])]),default:r(()=>[(p(!0),h(g,null,y(i.tableColumns,t=>(p(),m(P,X({ref_for:!0},t,{key:t.prop,align:t.align||"center","show-overflow-tooltip":""}),H({_:2},[t.prop==="operation"?{name:"default",fn:r(({row:F})=>[n(b,{class:"sy-btn-default",icon:"Edit",type:"warning",size:"small",plain:"",link:"",onClick:B=>i.handleTableAction("edit",F)},{default:r(()=>e[16]||(e[16]=[T(" 编辑 ")])),_:2,__:[16]},1032,["onClick"]),n(x,{title:"确认删除？","popper-class":"sy-popper","cancel-button-type":"text","confirm-button-type":"text",onConfirm:B=>i.handleTableAction("delete",F)},{reference:r(()=>[n(b,{icon:"Delete",class:"sy-btn-default",type:"danger",size:"small",plain:"",text:""},{default:r(()=>e[17]||(e[17]=[T(" 删除 ")])),_:1,__:[17]})]),_:2},1032,["onConfirm"])]),key:"0"}:void 0]),1040,["align"]))),128))]),_:1},8,["data"])),[[L,l.tableLoad]]),n(A,{"current-page":l.tablePage,"onUpdate:currentPage":e[5]||(e[5]=t=>l.tablePage=t),"page-size":l.tableSize,"onUpdate:pageSize":e[6]||(e[6]=t=>l.tableSize=t),class:"sy-pagination",layout:"total,prev,pager,next,jumper",total:l.tableTotal,background:"",onCurrentChange:i.onTablePageChange},null,8,["current-page","page-size","total","onCurrentChange"])]),_:1},8,["table-load"])]),_:1}),n(I,{modelValue:l.interfaceModal,"onUpdate:modelValue":e[14]||(e[14]=t=>l.interfaceModal=t),class:"sy-dialog",width:"30vw",height:"20vh",title:l.interfaceTitle,"close-on-click-modal":!1,center:"","append-to-body":"",onClose:i.onDialogClose},{footer:r(()=>[n(b,{class:"sy-btn-default",type:"warning",onClick:e[13]||(e[13]=t=>l.interfaceModal=!1)},{default:r(()=>e[18]||(e[18]=[T("取消")])),_:1,__:[18]}),n(b,{class:"sy-btn-default",type:"primary",onClick:i.handleModalAction},{default:r(()=>e[19]||(e[19]=[T("确定")])),_:1,__:[19]},8,["onClick"])]),default:r(()=>[n(f,{ref:"interfaceForm",class:"sy-form interface-form","label-suffix":"：","label-width":"auto",model:l.interfaceForm,rules:i.interfaceRules},{default:r(()=>[n(s,{prop:"path",label:"请求路径"},{default:r(()=>[n(R,{modelValue:l.interfaceForm.path,"onUpdate:modelValue":e[9]||(e[9]=t=>l.interfaceForm.path=t),placeholder:"请输入请求路径",maxlength:40,onInput:e[10]||(e[10]=t=>i.onFormRegex("path",t))},null,8,["modelValue"])]),_:1}),n(s,{prop:"method",label:"请求方法"},{default:r(()=>[n(d,{modelValue:l.interfaceForm.method,"onUpdate:modelValue":e[11]||(e[11]=t=>l.interfaceForm.method=t),"popper-class":"sy-popper",placeholder:"请选择请求方法"},{default:r(()=>[(p(!0),h(g,null,y(i.requestMethods,t=>(p(),m(u,{key:t.key,label:t.value,value:t.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(s,{prop:"roleType",label:"角色类型"},{default:r(()=>[n(d,{modelValue:l.interfaceForm.roleType,"onUpdate:modelValue":e[12]||(e[12]=t=>l.interfaceForm.roleType=t),"popper-class":"sy-popper",placeholder:"请选择角色类型"},{default:r(()=>[(p(!0),h(g,null,y(i.roleTypes,t=>(p(),m(u,{key:t.key,label:t.value,value:t.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","onClose"])]),_:1})}const we=J(ue,[["render",fe],["__scopeId","data-v-bbd21032"]]);export{we as default};
